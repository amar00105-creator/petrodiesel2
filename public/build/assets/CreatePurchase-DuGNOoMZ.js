import{j as e,m as r,f as V,_ as y,F as S,ai as J,a2 as U,P as k,aj as H,T as M,t as i}from"./ui-BNY7rm5N.js";import{r as t}from"./vendor-BdFMDtQB.js";import{b as _,m as Q,h as f,c}from"./main-CfCXs3Ia.js";import{A as G}from"./AddSupplierModal-B0pvIlWU.js";function ee({suppliers:C=[],tanks:K=[],drivers:m=[],fuelTypes:D=[],invoiceNumber:j,canAddSupplier:A=!1,canAddDriver:E=!1}){var N;const[T,x]=t.useState(!1),[F,w]=t.useState(!1),[O,P]=t.useState(!1),[u,q]=t.useState(""),[h,B]=t.useState(""),[p,I]=t.useState(0),[n,v]=t.useState(""),[b,d]=t.useState(""),[L,g]=t.useState(!1);t.useEffect(()=>{const s=parseFloat(u)||0,a=parseFloat(h)||0;I(s*a)},[u,h]);const R=s=>{const a=s.target.value;v(a);const o=m.find(l=>l.id==a);d(o&&o.truck_number||"")},$=async s=>{if(s.preventDefault(),!n){i.error("يجب تحديد السائق");return}if(!b){i.error("يجب إدخال رقم الشاحنة");return}if(!s.target.checkValidity()){s.target.reportValidity();return}x(!0);try{const a=new FormData(s.target);a.set("total_cost",p);const o=await fetch(`${window.BASE_URL}/purchases/store`,{method:"POST",body:a,headers:{Accept:"application/json"}});let l;try{l=await o.json()}catch(z){throw console.error("JSON Parse Error:",z),new Error("Invalid Server Response (Not JSON)")}l.success?(P(!0),setTimeout(()=>{window.location.href=`${window.BASE_URL}/purchases`},2500)):(i.error(l.message||"حدث خطأ غير معروف"),x(!1))}catch(a){console.error(a),i.error("خطأ: "+a.message),x(!1)}};return e.jsxs(r.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"p-6 max-w-5xl mx-auto space-y-6 relative",children:[e.jsx(V,{children:O&&e.jsxs(r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[100] bg-navy-900/90 backdrop-blur-md flex flex-col items-center justify-center p-4",children:[e.jsx(r.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",duration:.5,bounce:.5},className:"bg-white rounded-full p-8 shadow-2xl shadow-emerald-500/50 mb-8",children:e.jsx(r.div,{initial:{pathLength:0},animate:{pathLength:1},transition:{duration:.5,delay:.2},children:e.jsx(y,{className:"w-24 h-24 text-emerald-500"})})}),e.jsx(r.h2,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"text-4xl font-black text-white font-cairo text-center",children:"تم حفظ الفاتورة بنجاج"}),e.jsx(r.p,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},className:"text-emerald-200 mt-4 text-xl font-bold",children:"جاري التوجيه إلى القائمة..."})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 bg-white p-4 rounded-3xl shadow-sm border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-600 rounded-2xl shadow-lg shadow-blue-200",children:e.jsx(S,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx(_,{className:"text-2xl font-bold text-navy-900 font-cairo",children:"فاتورة مشتريات جديدة"}),e.jsx(Q,{className:"text-slate-500",children:"تسجيل شحنة وقود واردة جديدة"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[e.jsxs("div",{className:"hidden md:flex items-center gap-2 bg-amber-50 px-4 py-2 rounded-xl border border-amber-100",children:[e.jsx(J,{className:"w-5 h-5 text-amber-600"}),e.jsx("span",{className:"text-lg font-mono font-bold text-navy-900",children:j})]}),e.jsxs(f,{type:"submit",form:"createForm",loading:T,className:"flex-1 md:flex-none py-3 px-6 rounded-xl bg-navy-900 hover:bg-navy-800 text-white font-bold shadow-lg shadow-blue-900/20 border-none",children:[e.jsx(y,{className:"w-5 h-5 mr-2"}),"حفظ الفاتورة"]})]})]}),e.jsxs("form",{id:"createForm",onSubmit:$,className:"space-y-6",children:[e.jsx("input",{type:"hidden",name:"invoice_number",value:j}),e.jsx("input",{type:"hidden",name:"status",value:"in_transit"}),e.jsx("input",{type:"hidden",name:"total_cost",value:p}),e.jsx("input",{type:"hidden",name:"driver_name",value:((N=m.find(s=>s.id==n))==null?void 0:N.name)||""}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(c,{className:"rounded-3xl shadow-sm ring-1 ring-amber-100 bg-amber-50/30 overflow-visible relative z-20",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("label",{className:"flex items-center gap-2 font-bold text-slate-700",children:[e.jsx(U,{className:"w-5 h-5 text-amber-500"})," المورد"]}),A&&e.jsxs("button",{type:"button",onClick:()=>w(!0),className:"text-xs bg-white text-amber-600 px-3 py-1.5 rounded-lg font-bold shadow-sm hover:shadow-md transition-shadow border border-amber-100 flex items-center gap-1",children:[e.jsx(k,{className:"w-3 h-3"})," جديد"]})]}),e.jsxs("select",{name:"supplier_id",className:"w-full p-3.5 rounded-xl border border-amber-200 focus:ring-2 focus:ring-amber-500 outline-none bg-white font-bold text-slate-700",required:!0,children:[e.jsx("option",{value:"",children:"اختر المورد..."}),e.jsx("option",{value:"new_supplier_trigger",className:"font-bold text-amber-600 bg-amber-50",children:"+ إضافة مورد جديد"}),C.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsx(c,{className:"rounded-3xl shadow-sm ring-1 ring-blue-100 bg-blue-50/30",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 font-bold text-slate-700 mb-2",children:[e.jsx(S,{className:"w-5 h-5 text-blue-500"})," نوع الوقود ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"fuel_type_id",className:"w-full p-3.5 rounded-xl border border-blue-200 focus:ring-2 focus:ring-blue-500 outline-none bg-white font-bold text-slate-700",required:!0,children:[e.jsx("option",{value:"",children:"اختر نوع الوقود..."}),D.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(c,{className:"rounded-3xl shadow-sm ring-1 ring-emerald-100 bg-emerald-50/30",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"الكمية (لتر)"}),e.jsx("input",{type:"number",step:"0.01",name:"volume_ordered",value:u,onChange:s=>q(s.target.value),className:"w-full p-3 rounded-xl border border-emerald-200 focus:ring-2 focus:ring-emerald-500 outline-none",placeholder:"0.00",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"السعر / لتر"}),e.jsx("input",{type:"number",step:"0.01",name:"price_per_liter",value:h,onChange:s=>B(s.target.value),className:"w-full p-3 rounded-xl border border-emerald-200 focus:ring-2 focus:ring-emerald-500 outline-none",placeholder:"0.00",required:!0})]})]}),e.jsxs("div",{className:"bg-emerald-600 p-4 rounded-2xl text-white flex justify-between items-center shadow-lg shadow-emerald-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(H,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs opacity-80",children:"الإجمالي النهائي"}),e.jsx("div",{className:"font-bold text-lg",children:"Total Cost"})]})]}),e.jsxs("div",{className:"text-3xl font-black font-mono tracking-tighter",children:[p.toLocaleString(void 0,{minimumFractionDigits:2})," ",e.jsx("span",{className:"text-base font-normal opacity-70",children:"IQD"})]})]})]}),e.jsxs(c,{className:"rounded-3xl shadow-sm ring-1 ring-indigo-100 bg-indigo-50/30 relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("label",{className:"flex items-center gap-2 font-bold text-slate-700",children:[e.jsx(M,{className:"w-5 h-5 text-indigo-500"})," السائق والشاحنة ",e.jsx("span",{className:"text-red-500",children:"*"})]}),E&&e.jsxs("button",{type:"button",onClick:()=>g(!0),className:"text-xs bg-white text-indigo-600 px-3 py-1.5 rounded-lg font-bold shadow-sm hover:shadow-md transition-shadow border border-indigo-100 flex items-center gap-1",children:[e.jsx(k,{className:"w-3 h-3"})," جديد"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsxs("select",{name:"driver_id",value:n,onChange:R,className:`w-full p-3.5 rounded-xl border ${n?"border-indigo-200":"border-red-300 ring-2 ring-red-100"} focus:ring-2 focus:ring-indigo-500 outline-none bg-white font-bold text-slate-700`,required:!0,children:[e.jsx("option",{value:"",children:"اختر السائق..."}),m.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})}),e.jsx("input",{type:"text",name:"truck_number",value:b,onChange:s=>d(s.target.value),className:`w-full p-3 rounded-xl border ${b?"border-indigo-200":"border-red-300 ring-2 ring-red-100"} focus:ring-2 focus:ring-indigo-500 outline-none bg-white`,placeholder:"رقم الشاحنة",required:!0})]})]})]})]})]}),e.jsx(G,{isOpen:F,onClose:()=>w(!1),onSuccess:()=>window.location.reload()}),L&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm",children:e.jsxs(r.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-2xl w-full max-w-md p-6 shadow-2xl",children:[e.jsx(_,{children:"إضافة سائق جديد"}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsx("input",{id:"newDriverName",className:"w-full p-3 border rounded-xl",placeholder:"اسم السائق"}),e.jsx("input",{id:"newDriverTruck",className:"w-full p-3 border rounded-xl",placeholder:"رقم الشاحنة"}),e.jsx(f,{onClick:()=>{v(document.getElementById("newDriverName").value),d(document.getElementById("newDriverTruck").value),g(!1),i.success("تم تحديد السائق (محلياً)")},className:"w-full mt-2",children:"حفظ"}),e.jsx(f,{variant:"secondary",onClick:()=>g(!1),className:"w-full",children:"إلغاء"})]})]})})]})}export{ee as default};
