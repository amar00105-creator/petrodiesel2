import{j as e,c as N,X as k,aj as S,J as C,N as A,i as F,t as f,p as R,o as L,T as U,U as q,f as z,m as v}from"./ui-Cx9d0ciQ.js";import{r as i,R as G}from"./vendor-BdFMDtQB.js";import{n as B,l as J,D as X,G as $,h as H,j as K,k as y}from"./main-BJa5vRrN.js";import{A as Q,S as V}from"./SupplierList-B68mAQjF.js";import"./AddSupplierModal-BfIKkmck.js";function W({isOpen:c,onClose:a,customer:l,onSuccess:m}){const[t,o]=i.useState({id:"",name:"",phone:"",address:"",notes:""}),[h,u]=i.useState(!1);i.useEffect(()=>{l&&o({id:l.id||"",name:l.name||"",phone:l.phone||"",address:l.address||"",notes:l.notes||""})},[l]);const x=r=>{const{name:n,value:p}=r.target;o(d=>({...d,[n]:p}))},j=async r=>{r.preventDefault(),u(!0);const n=new FormData;n.append("id",t.id),n.append("name",t.name),n.append("phone",t.phone),n.append("address",t.address),n.append("notes",t.notes);let p=!1;try{const g=await(await fetch("/PETRODIESEL2/public/hr/api?entity=customer&action=update",{method:"POST",body:n})).json();g.success?(f.success("تم تحديث العميل بنجاح"),p=!0):f.error(g.message||"حدث خطأ أثناء التحديث")}catch(d){console.error("Update Request Error:",d),f.error("فشل الاتصال بالخادم")}finally{u(!1)}if(p)try{m({...l,name:t.name,phone:t.phone,address:t.address,notes:t.notes}),a()}catch(d){console.error("Error updating UI state:",d)}};return e.jsx(B,{open:c,onClose:a,static:!0,className:"z-[100]",children:e.jsxs(J,{className:"max-w-md w-full bg-white rounded-2xl shadow-2xl ring-1 ring-slate-900/5 p-0 overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-50 border-b border-slate-100 p-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(N,{className:"w-5 h-5 text-indigo-600"}),"تعديل بيانات العميل"]}),e.jsx("p",{className:"text-slate-500 text-sm",children:"تعديل معلومات العميل"})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-slate-200 rounded-full transition-colors text-slate-500",children:e.jsx(k,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"اسم العميل"}),e.jsxs("div",{className:"relative",children:[e.jsx(N,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("input",{type:"text",name:"name",value:t.name,onChange:x,placeholder:"الاسم الكامل",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"رقم الهاتف"}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("input",{type:"text",name:"phone",value:t.phone,onChange:x,placeholder:"05xxxxxxxx",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"العنوان"}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("input",{type:"text",name:"address",value:t.address,onChange:x,placeholder:"المدينة، الحي...",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"ملاحظات"}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("textarea",{name:"notes",value:t.notes,onChange:x,placeholder:"ملاحظات إضافية...",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all min-h-[80px]"})]})]}),e.jsxs("div",{className:"flex justify-end pt-4",children:[e.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-50 rounded-lg transition-colors ml-2",children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:h,className:"px-6 py-2 text-sm font-bold text-white bg-navy-900 hover:bg-navy-800 rounded-lg shadow-lg hover:shadow-xl transition-all flex items-center gap-2",children:h?"جاري الحفظ...":e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4"}),"حفظ التغييرات"]})})]})]})]})})}function Y({customers:c=[],onUpdate:a}){const[l,m]=i.useState(!1),[t,o]=i.useState(!1),[h,u]=i.useState(null),[x,j]=i.useState(!1),[r,n]=i.useState(null),[p,d]=i.useState(!1),g=s=>{u(s),o(!0)},E=s=>{n(s),j(!0)},D=async()=>{if(!r)return;d(!0);const s=new FormData;s.append("id",r.id);try{const w=await(await fetch("/PETRODIESEL2/public/hr/api?entity=customer&action=delete",{method:"POST",body:s})).json();w.success?(f.success("تم حذف العميل بنجاح"),a?a(c.filter(T=>T.id!==r.id)):window.location.reload()):f.error(w.message||"فشل الحذف")}catch{f.error("خطأ في الاتصال")}finally{d(!1),j(!1),n(null)}},O=s=>{a?a([...c,s]):window.location.reload()},I=s=>{a?a(c.map(b=>b.id==s.id?{...b,...s}:b)):window.location.reload()},M=[{header:"اسم العميل",accessor:"name",render:s=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg text-indigo-600",children:e.jsx(N,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-bold text-navy-900",children:s.name})]})},{header:"رقم الهاتف",accessor:"phone",className:"font-mono text-slate-600",render:s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-3 h-3 text-slate-400"})," ",s.phone||"-"]})},{header:"العنوان",accessor:"address",className:"text-sm text-slate-500",render:s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-3 h-3 text-slate-400"})," ",s.address||"-"]})},{header:"الملاحظات",accessor:"notes",className:"max-w-xs truncate text-slate-500",render:s=>s.notes||"-"}],P=s=>e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>g(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",children:e.jsx(R,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>E(s),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(L,{className:"w-4 h-4"})})]});return e.jsxs("div",{className:"p-6 max-w-[1800px] mx-auto space-y-6",children:[e.jsx(X,{isOpen:x,onClose:()=>j(!1),onConfirm:D,title:"تحذير: حذف عميل",message:`سيتم حذف العميل "${r==null?void 0:r.name}". هل أنت متأكد؟`,isDeleting:p}),e.jsx($,{title:"قائمة العملاء",subtitle:"إدارة سجلات العملاء والديون",data:c,columns:M,actions:P,onAdd:()=>m(!0),addButtonLabel:"إضافة عميل",searchPlaceholder:"بحث عن عميل...",exportName:"customers"}),e.jsx(Q,{isOpen:l,onClose:()=>m(!1),onSuccess:O}),e.jsx(W,{isOpen:t,onClose:()=>o(!1),customer:h,onSuccess:I})]})}function ae(c){const{suppliers:a=[],customers:l=[]}=c,[m,t]=i.useState(l),[o,h]=i.useState(0);G.useEffect(()=>{t(l)},[l]);const u=x=>{t(x)};return e.jsxs("div",{className:"p-6 max-w-[1800px] mx-auto min-h-screen space-y-8 animate-fade-in",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-3xl bg-gradient-to-br from-blue-900 to-slate-800 p-8 text-white shadow-2xl",children:[e.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row justify-between items-center gap-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black font-cairo mb-2",children:"العملاء والموردون"}),e.jsx("p",{className:"text-blue-100 text-lg opacity-90 max-w-2xl leading-relaxed",children:"إدارة متكاملة للأطراف المالية (موردين وزبائن) ومتابعة الأرصدة والديون."})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-4 flex gap-8 border border-white/20",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold",children:a.length}),e.jsx("div",{className:"text-xs text-blue-200",children:"مورد"})]}),e.jsx("div",{className:"w-px bg-white/20"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold",children:m.length}),e.jsx("div",{className:"text-xs text-blue-200",children:"عميل"})]})]})]}),e.jsx("div",{className:"absolute top-0 right-0 -mr-20 -mt-20 w-80 h-80 bg-white/5 rounded-full blur-3xl pointer-events-none"}),e.jsx("div",{className:"absolute bottom-0 left-0 -ml-20 -mb-20 w-60 h-60 bg-blue-500/10 rounded-full blur-2xl pointer-events-none"})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(H,{index:o,onIndexChange:h,children:[e.jsxs(K,{variant:"solid",className:"bg-white p-1 rounded-2xl shadow-sm border border-slate-100 max-w-2xl mx-auto",children:[e.jsx(y,{className:"px-6 py-2.5 rounded-xl font-bold text-slate-500 ui-selected:bg-blue-800 ui-selected:text-white ui-selected:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5"}),e.jsx("span",{children:"الموردين"})]})}),e.jsx(y,{className:"px-6 py-2.5 rounded-xl font-bold text-slate-500 ui-selected:bg-indigo-600 ui-selected:text-white ui-selected:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),e.jsx("span",{children:"العملاء (الزبائن)"})]})})]}),e.jsx("div",{className:"mt-8",children:e.jsxs(z,{mode:"wait",children:[o===0&&e.jsx(v.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.2},children:e.jsx(V,{suppliers:a})},"suppliers"),o===1&&e.jsx(v.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.2},children:e.jsx(Y,{customers:m,onUpdate:u})},"customers")]})})]})})]})}export{ae as default};
