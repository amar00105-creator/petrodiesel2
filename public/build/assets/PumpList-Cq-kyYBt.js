import{c as V,r as i,R as $,j as e,S as R,F as O,t as d,m as P,b as G}from"./main-BZye3MWh.js";import{n as U,d as q,c as M,b as F,m as E,e as J,a as L,g as X}from"./Tracker-B3Wsk5ua.js";import{D as z}from"./DeleteConfirmationModal-CGMvXUfk.js";import{X as Z}from"./x-CpP_tiue.js";import{G as I}from"./gauge-DQTYN_kb.js";import{T as A}from"./trash-2-D_DkLkqJ.js";import{P as T}from"./plus-CeiUBWS7.js";import{S as H}from"./save-C_qR2yBp.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Q=V("zap",K);function W({isOpen:g,onClose:p,pump:n,tanks:j,workers:w}){const[r,x]=i.useState({id:n.id,name:n.name,tank_id:n.tank_id,counters:n.counters||[]});$.useEffect(()=>{x({id:n.id,name:n.name,tank_id:n.tank_id,counters:n.counters||[]})},[n]);const[N,v]=i.useState(!1),m=(s,l)=>{x(t=>({...t,[s]:l}))},c=(s,l,t)=>{const f=[...r.counters];f[s]={...f[s],[l]:t},x(C=>({...C,counters:f}))},y=async()=>{v(!0);try{const l=await(await fetch("/PETRODIESEL2/public/pumps/updateBulk",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).json();l.success?(d.success("تم حفظ التغييرات بنجاح"),setTimeout(()=>window.location.reload(),800)):d.error(l.message||"حدث خطأ أثناء الحفظ")}catch{d.error("خطأ في الاتصال")}finally{v(!1)}},[D,b]=i.useState(!1),[u,S]=i.useState(null),[k,_]=i.useState(!1),a=s=>{S(s),b(!0)},o=async()=>{if(!u)return;_(!0);const s=new FormData;s.append("id",u),s.append("pump_id",r.id);try{await fetch("/PETRODIESEL2/public/pumps/deleteCounter",{method:"POST",body:s}),d.success("تم الحذف بنجاح"),x(l=>({...l,counters:l.counters.filter(t=>t.id!==u)}))}catch{d.error("فشل عملية الحذف")}finally{_(!1),b(!1),S(null)}},h=s=>{a(s)},B=async(s,l)=>{if(!s||l===""){d.error("يرجى ملء جميع الحقول");return}const t=new FormData;t.append("pump_id",r.id),t.append("name",s),t.append("initial_reading",l);try{const C=await(await fetch("/PETRODIESEL2/public/pumps/addCounter",{method:"POST",body:t})).json();C.success?(d.success("تمت إضافة العداد بنجاح"),setTimeout(()=>window.location.reload(),1e3)):d.error("فشل إضافة العداد: "+(C.error||"خطأ غير معروف"))}catch{d.error("خطأ في الاتصال")}};return e.jsxs(U,{open:g,onClose:p,static:!0,className:"z-[100]",children:[e.jsx(z,{isOpen:D,onClose:()=>b(!1),onConfirm:o,title:"حذف عداد",message:"هل أنت متأكد من حذف هذا العداد؟",isDeleting:k}),e.jsxs(q,{className:"max-w-4xl p-0 overflow-hidden bg-white rounded-2xl shadow-2xl ring-1 ring-slate-900/5",children:[e.jsxs("div",{className:"bg-slate-50 border-b border-slate-100 p-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-blue-600"}),"إدارة الماكينة: ",n.name]}),e.jsx("p",{className:"text-slate-500 text-sm",children:"تعديل البيانات والعدادات والعمال"})]}),e.jsx("button",{onClick:p,className:"p-2 hover:bg-slate-200 rounded-full transition-colors text-slate-500",children:e.jsx(Z,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[70vh] space-y-8",children:[e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-800 font-bold border-r-4 border-blue-500 pr-3",children:[e.jsx(O,{className:"w-5 h-5 text-blue-500"}),e.jsx("h3",{children:"بيانات الماكينة"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 bg-slate-50/50 p-6 rounded-xl border border-slate-100",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"اسم الماكينة"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-slate-700",value:r.name,onChange:s=>m("name",s.target.value),placeholder:"مثال: ماكينة 1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"الخزان المرتبط"}),e.jsx("select",{className:"w-full px-3 py-2 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-slate-700",value:String(r.tank_id),onChange:s=>m("tank_id",s.target.value),children:j.map(s=>e.jsxs("option",{value:String(s.id),children:[s.name," (",s.product_type,")"]},s.id))})]}),e.jsx("div",{className:"sm:col-span-2 flex justify-end"})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-800 font-bold border-r-4 border-emerald-500 pr-3",children:[e.jsx(I,{className:"w-5 h-5 text-emerald-500"}),e.jsx("h3",{children:"العدادات والعمال"})]}),e.jsxs("div",{className:"space-y-4",children:[r.counters.map((s,l)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-4 shadow-sm hover:border-blue-300 transition-colors flex flex-col md:flex-row gap-4 items-end md:items-center",children:[e.jsxs("div",{className:"flex-1 w-full space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400",children:"اسم العداد"}),e.jsx("input",{type:"text",className:"w-full px-2 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-slate-700",value:s.name,onChange:t=>c(l,"name",t.target.value)})]}),e.jsxs("div",{className:"w-full md:w-32 space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400",children:"القراءة الحالية"}),e.jsx("input",{type:"number",className:"w-full px-2 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-slate-700",value:s.current_reading,onChange:t=>c(l,"current_reading",t.target.value),min:0})]}),e.jsxs("div",{className:"flex-1 w-full space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400",children:"العامل المسؤول"}),e.jsxs("select",{className:"w-full px-2 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-slate-700",value:String(s.current_worker_id||""),onChange:t=>c(l,"current_worker_id",t.target.value),children:[e.jsx("option",{value:"",children:"خالي (بدون عامل)"}),w.map(t=>e.jsx("option",{value:String(t.id),children:t.name},t.id))]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:()=>h(s.id),className:"p-1.5 rounded-lg bg-red-50 text-red-600 hover:bg-red-100 transition-colors",title:"حذف العداد",children:e.jsx(A,{className:"w-4 h-4"})})})]},s.id)),r.counters.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400 italic bg-slate-50 rounded-xl border border-dashed border-slate-200",children:"لا توجد عدادات لهذه الماكينة"})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100",children:[e.jsxs("h4",{className:"text-sm font-bold text-slate-600 mb-3 flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4"})," إضافة عداد جديد"]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 items-end",children:[e.jsxs("div",{className:"flex-1 w-full space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400",children:"اسم العداد"}),e.jsx("input",{type:"text",className:"w-full px-2 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-slate-700",placeholder:"مثال: مسدس 3",id:"new_counter_name"})]}),e.jsxs("div",{className:"w-full md:w-32 space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400",children:"القراءة الأولية"}),e.jsx("input",{type:"number",className:"w-full px-2 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-slate-700",defaultValue:0,min:0,step:"0.01",id:"new_counter_reading"})]}),e.jsxs("button",{className:"inline-flex items-center gap-2 px-3 py-1.5 text-xs font-semibold text-blue-700 bg-blue-100/50 hover:bg-blue-100 rounded-lg transition-colors",onClick:()=>B(document.getElementById("new_counter_name").value,document.getElementById("new_counter_reading").value),children:[e.jsx(T,{className:"w-4 h-4"}),"إضافة"]})]})]})]})]}),e.jsxs("div",{className:"bg-slate-50 p-4 border-t border-slate-100 flex justify-end gap-3",children:[e.jsx("button",{onClick:p,className:"px-4 py-2 text-sm font-medium text-slate-700 bg-white border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors",children:"إلغاء"}),e.jsx("button",{onClick:y,disabled:N,className:"px-4 py-2 text-sm font-bold text-white bg-blue-600 rounded-lg hover:bg-blue-700 shadow-lg shadow-blue-500/30 transition-all flex items-center gap-2",children:N?"جاري الحفظ...":e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-4 h-4"}),"حفظ التعديلات"]})})]})]})]})}function oe({pumps:g=[],tanks:p=[],workers:n=[]}){const[j,w]=i.useState(null),[r,x]=i.useState(!1),N=a=>{w(a),x(!0)},[v,m]=i.useState(!1),[c,y]=i.useState(null),D=a=>{y(a),m(!0)},[b,u]=i.useState(!1),S=async()=>{if(!c)return;u(!0);const a=new FormData;a.append("id",c.id);try{const h=await(await fetch("/PETRODIESEL2/public/pumps/delete_ajax",{method:"POST",body:a})).json();h.success?window.location.reload():alert(h.message||"فشل عملية الحذف")}catch(o){console.error(o),alert("خطأ في الاتصال")}finally{u(!1),m(!1),y(null)}},k={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},_={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}};return e.jsxs(P.div,{initial:"hidden",animate:"visible",variants:k,className:"p-6 max-w-7xl mx-auto",children:[e.jsx(z,{isOpen:v,onClose:()=>m(!1),onConfirm:S,title:"تحذير: حذف ماكينة وقود",isDeleting:b,message:`سيتم حذف الماكينة "${c==null?void 0:c.name}" وجميع عداداتها المرتبطة. هل أنت متأكد؟`}),e.jsx("div",{className:"flex justify-end mb-6",children:e.jsxs("a",{href:"/PETRODIESEL2/public/pumps/create",className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl shadow-lg hover:shadow-blue-500/30 transition-all flex items-center gap-2 font-bold",children:[e.jsx(T,{className:"w-5 h-5"})," إضافة ماكينة"]})}),g.length===0?e.jsxs(M,{className:"text-center py-20 bg-slate-50 border-dashed border-2 border-slate-200",children:[e.jsx("div",{className:"inline-flex p-4 bg-slate-100 rounded-full mb-4 text-slate-400",children:e.jsx(O,{className:"w-12 h-12"})}),e.jsx(F,{className:"text-slate-600",children:"لا توجد مكائن مضافة"}),e.jsx(E,{className:"mt-2 text-slate-400",children:"ابدأ بإضافة أول ماكينة وقود للنظام"})]}):e.jsx(J,{numItems:1,numItemsMd:2,numItemsLg:3,className:"gap-6",children:g.map(a=>e.jsx(P.div,{variants:_,children:e.jsxs(M,{className:"h-full flex flex-col hover:shadow-xl transition-shadow border-t-4 border-t-blue-500 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-5 group-hover:opacity-10 transition-opacity",children:e.jsx(O,{className:"w-24 h-24"})}),e.jsxs(L,{className:"mb-4 items-start",children:[e.jsxs("div",{children:[e.jsx(E,{className:"text-xs font-bold text-blue-500 uppercase tracking-wider mb-1",children:a.tank_name||"خزان غير محدد"}),e.jsx(F,{className:"text-2xl font-black text-slate-800",children:a.name})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx(X,{icon:Q,color:"emerald",size:"xs",className:"animate-pulse-slow shadow-emerald-500/20 shadow-lg",children:"نشط"}),e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest px-2 py-0.5 bg-slate-100 rounded-full",children:a.product_type||"وقود"})]})]}),e.jsxs("div",{className:"bg-slate-50/50 rounded-xl p-4 mb-4 flex-grow space-y-3 border border-slate-100",children:[e.jsxs(E,{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 flex items-center gap-2",children:[e.jsx(I,{className:"w-3 h-3"})," العدادات والقراءات"]}),a.counters&&a.counters.length>0?a.counters.map((o,h)=>e.jsxs("div",{className:"group/counter relative flex justify-between items-center bg-white p-3 rounded-lg shadow-sm border border-slate-100 hover:border-blue-200 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2.5 bg-blue-50 text-blue-600 rounded-lg group-hover/counter:bg-blue-600 group-hover/counter:text-white transition-colors",children:e.jsx(I,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-mono text-lg font-black text-slate-700 leading-none mb-1",children:parseFloat(o.current_reading).toLocaleString("en-US",{minimumFractionDigits:2})}),o.worker_name?e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-slate-500 font-bold bg-slate-100 px-2 py-0.5 rounded-md w-fit mt-1",children:[e.jsx(G,{className:"w-3 h-3 text-slate-400"}),e.jsx("span",{className:"pt-0.5",children:o.worker_name})]}):e.jsx("div",{className:"text-[10px] text-slate-400 italic mt-1",children:"غير مخصص"})]})]}),e.jsx("div",{className:"absolute top-2 left-2 text-[10px] font-black text-slate-200 group-hover/counter:text-blue-100 transition-colors max-w-[50%] truncate",children:o.name||`#${String(h+1).padStart(2,"0")}`})]},o.id)):e.jsx("div",{className:"text-center py-4 text-slate-400 text-sm italic",children:"لا توجد عدادات مرتبطة"})]}),e.jsxs(L,{className:"mt-auto pt-4 border-t border-slate-100 gap-2",children:[e.jsxs("button",{onClick:()=>N(a),className:"flex-1 py-2 px-3 rounded-lg bg-slate-50 hover:bg-blue-50 text-slate-600 hover:text-blue-600 font-medium text-sm transition-colors flex items-center justify-center gap-2",children:[e.jsx(R,{className:"w-4 h-4"})," إدارة"]}),e.jsx("button",{onClick:()=>D(a),className:"py-2 px-3 rounded-lg bg-slate-50 hover:bg-red-50 text-slate-600 hover:text-red-500 transition-colors",children:e.jsx(A,{className:"w-4 h-4"})})]})]})},a.id))}),j&&e.jsx(W,{isOpen:r,onClose:()=>{x(!1),w(null)},pump:j,tanks:p,workers:n})]})}export{oe as default};
