import{j as e,m as i,A as O,Q as f,F as w,f as _,k as E,R,U as z,h as L,t as x}from"./ui-DtuMUTb1.js";import{r as u}from"./vendor-BdFMDtQB.js";import{c as p,a as D,m as h,s as $,i as q,b as H,y as U,g as V}from"./main-D8tG-o71.js";function M(o){const{stats:S,tanks:b,workers:C}=o,[l,d]=u.useState({name:"",tank_id:"",counter_count:1,readings:[""],workers:[""],counter_names:[""],counter_ids:[]}),[m,j]=u.useState(null),k=o.initialData&&o.initialData.pump&&o.initialData.pump.id;u.useEffect(()=>{if(k){const{pump:r,counters:t}=o.initialData;d({name:r.name,tank_id:r.tank_id,counter_count:t.length,readings:t.map(s=>s.current_reading),workers:t.map(s=>s.current_worker_id||""),counter_names:t.map(s=>s.name),counter_ids:t.map(s=>s.id)});const a=b.find(s=>s.id==r.tank_id);a&&j(a)}},[o.initialData]);const v=r=>{const{name:t,value:a}=r.target;if(d(s=>({...s,[t]:a})),t==="tank_id"){const s=b.find(n=>n.id==a);j(s)}},g=(r,t,a)=>{const s=[...l[t]];s[r]=a,d(n=>({...n,[t]:s}))};u.useEffect(()=>{const r=parseInt(l.counter_count);l.counter_names.length===r&&l.readings.length===r&&l.workers.length===r||d(t=>({...t,readings:Array(r).fill("").map((a,s)=>t.readings[s]||""),workers:Array(r).fill("").map((a,s)=>t.workers[s]||""),counter_names:Array(r).fill("").map((a,s)=>t.counter_names[s]||`العداد رقم (${s+1})`),counter_ids:Array(r).fill(null).map((a,s)=>t.counter_ids[s]||null)}))},[l.counter_count]);const[T,A]=u.useState([]),I=r=>{const t=l.counter_ids[r];t&&A(a=>[...a,t]),d(a=>{const s=[...a.readings],n=[...a.workers],c=[...a.counter_names],y=[...a.counter_ids];return s.splice(r,1),n.splice(r,1),c.splice(r,1),y.splice(r,1),{...a,counter_count:a.counter_count-1,readings:s,workers:n,counter_names:c,counter_ids:y}}),x.success("تم حذف العداد",{description:"تمت إزالة العداد من القائمة بنجاح",icon:e.jsx(E,{className:"w-4 h-4 text-red-500"}),duration:3e3})},P=async r=>{r.preventDefault();try{if(k){const t={id:o.initialData.pump.id,name:l.name,tank_id:l.tank_id,counters:l.counter_names.map((n,c)=>({id:l.counter_ids[c]||null,name:n,current_reading:l.readings[c],current_worker_id:l.workers[c]})),deleted_counters:T},a=await fetch("/PETRODIESEL2/public/pumps/updateBulk",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),s=await a.json().catch(()=>({}));a.ok&&s.success?(x.success("تم تحديث البيانات بنجاح",{description:"جاري إعادة التوجيه..."}),setTimeout(()=>window.location.href="/PETRODIESEL2/public/pumps",1e3)):x.error(s.message||"فشل التحديث")}else{const t=new FormData;t.append("name",l.name),t.append("tank_id",l.tank_id),t.append("counter_count",l.counter_count),l.readings.forEach(s=>t.append("readings[]",s)),l.workers.forEach(s=>t.append("workers[]",s)),l.counter_names.forEach(s=>t.append("counter_names[]",s));const a=await fetch("/PETRODIESEL2/public/pumps/store",{method:"POST",body:t});a.redirected||a.ok?(x.success("تمت إضافة الماكينة بنجاح!",{description:"جاري حفظ البيانات وإعادة التوجيه..."}),setTimeout(()=>window.location.href="/PETRODIESEL2/public/pumps",1500)):x.error("حدث خطأ أثناء الحفظ")}}catch(t){console.error(t),x.error("فشل الاتصال بالخادم")}},F={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.15,delayChildren:.2}}},N={hidden:{y:30,opacity:0},visible:{y:0,opacity:1,transition:{type:"spring",stiffness:50,damping:20}}};return e.jsx(i.div,{initial:"hidden",animate:"visible",variants:F,className:"p-6 max-w-[1600px] mx-auto bg-slate-50 dark:bg-[#0F172A]",children:e.jsxs("div",{className:"grid grid-cols-12 gap-6 h-full",children:[e.jsxs(i.div,{variants:N,className:"col-span-12 lg:col-span-4 flex flex-col gap-6 sticky top-6 h-fit",children:[e.jsxs(p,{className:"relative overflow-hidden border-0 ring-1 ring-slate-200 shadow-sm bg-white p-6 dark:bg-white/5 dark:ring-white/10",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-[#E0F2FE] rounded-full blur-3xl -mr-16 -mt-16 opacity-50"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs(D,{alignItems:"start",className:"mb-4",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-slate-500 mb-1 dark:text-slate-400",children:"إجمالي الماكينات"}),e.jsx($,{className:"text-3xl font-bold text-slate-900 font-mono dark:text-white",children:S.totalPumps})]}),e.jsx("div",{className:"p-3 bg-[#E0F2FE] text-blue-600 rounded-xl",children:e.jsx(O,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"space-y-4 pt-2",children:e.jsxs("div",{children:[e.jsxs(D,{className:"mb-2",children:[e.jsx(h,{className:"text-slate-500 text-xs",children:"حالة النظام"}),e.jsx(h,{className:"text-emerald-600 text-xs font-bold bg-emerald-50 px-2 py-0.5 rounded",children:"ممتاز"})]}),e.jsx(q,{value:85,color:"emerald",className:"h-1.5"})]})})]})]}),e.jsxs(p,{className:"border-0 ring-1 ring-slate-200 shadow-sm bg-white p-6 rounded-2xl dark:bg-white/5 dark:ring-white/10",children:[e.jsx(H,{className:"text-center mb-2 text-navy-900 font-cairo dark:text-white",children:"المحاكاة الحية"}),e.jsx(h,{className:"text-center text-slate-400 text-xs mb-8",children:"معاينة فورية للبيانات المدخلة"}),e.jsx("div",{className:"relative flex justify-center mb-8",children:m?e.jsxs("div",{className:"flex flex-col items-center animate-in fade-in zoom-in duration-500",children:[e.jsxs("div",{className:"relative w-48 h-48",children:[e.jsx(U,{className:"h-48 w-48",data:[{name:"مستخدم",value:40},{name:"متاح",value:60}],category:"value",index:"name",colors:["slate-100","emerald-500"],showLabel:!1,variant:"pie"}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsx(f,{className:"w-8 h-8 text-emerald-500 mb-1"}),e.jsx("span",{className:"text-2xl font-bold text-navy-900",children:"40%"})]})]}),e.jsx(h,{className:"mt-4 font-bold text-lg text-navy-800",children:m.name}),e.jsx(V,{size:"xs",color:"emerald",className:"mt-2",children:m.product_type})]}):e.jsxs("div",{className:"w-48 h-48 rounded-full border-4 border-dashed border-slate-100 flex flex-col items-center justify-center text-slate-300",children:[e.jsx(w,{className:"w-12 h-12 mb-2 opacity-50"}),e.jsx("span",{className:"text-xs font-medium",children:"اختر خزاناً"})]})}),e.jsx(i.div,{className:"bg-slate-50 rounded-2xl p-5 border border-slate-200/60 shadow-sm dark:bg-slate-800 dark:border-slate-700",whileHover:{scale:1.02},transition:{type:"spring",stiffness:400,damping:17},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center shadow-lg transform rotate-3 ${l.name?"bg-gradient-to-br from-emerald-500 to-emerald-600 text-white shadow-emerald-500/30":"bg-white text-slate-300 shadow-slate-200 dark:bg-slate-800 dark:text-slate-600 dark:shadow-none"}`,children:e.jsx(w,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-navy-900 text-lg leading-tight dark:text-white",children:l.name||"اسم الماكينة"}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1 flex items-center gap-1 dark:text-slate-400",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${l.tank_id?"bg-emerald-500":"bg-slate-300"}`}),l.tank_id?"جاهزة للربط":"بانتظار الإعداد"]})]})]})})]})]}),e.jsx(i.div,{variants:N,className:"col-span-12 lg:col-span-8",children:e.jsxs("form",{onSubmit:P,className:"space-y-8",children:[e.jsxs(p,{className:"border-0 ring-1 ring-slate-200 shadow-sm bg-white p-6 rounded-2xl dark:bg-white/5 dark:ring-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-blue-50 text-blue-600 font-bold text-lg ring-4 ring-blue-50/50 dark:bg-blue-500/20 dark:text-blue-400 dark:ring-blue-500/10",children:"1"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-navy-900 dark:text-white",children:"بيانات التكوين الأساسية"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"اربط الماكينة بخزان الوقود المناسب"})]})]}),e.jsx(_,{children:m&&e.jsxs(i.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,scale:.9},className:"hidden sm:flex items-center gap-2 px-4 py-2 bg-emerald-50 rounded-2xl border border-emerald-100 text-emerald-700 font-bold shadow-sm",children:[e.jsx(f,{className:"w-5 h-5 fill-emerald-500/20"}),e.jsx("span",{children:m.product_type})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-3 group-focus-within:text-blue-600 transition-colors dark:text-slate-300 dark:group-focus-within:text-blue-400",children:"اسم الماكينة"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"name",value:l.name,onChange:v,className:"w-full h-14 bg-slate-50/50 border-2 border-slate-100 rounded-2xl px-5 pl-12 font-bold text-navy-900 placeholder:text-slate-300 focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 outline-none transition-all duration-300 dark:bg-slate-800 dark:border-slate-700 dark:text-white dark:focus:bg-slate-700",placeholder:"مثال: الطلمبة الرئيسية",required:!0}),e.jsx(w,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-6 h-6 text-slate-300 group-focus-within:text-blue-500 transition-colors"})]})]}),e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-3 group-focus-within:text-emerald-600 transition-colors dark:text-slate-300 dark:group-focus-within:text-emerald-400",children:"الخزان المصدر"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{name:"tank_id",value:l.tank_id,onChange:v,className:"w-full h-14 bg-slate-50/50 border-2 border-slate-100 rounded-2xl px-5 pl-12 font-bold text-navy-900 focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 outline-none transition-all duration-300 appearance-none cursor-pointer dark:bg-slate-800 dark:border-slate-700 dark:text-white dark:focus:bg-slate-700",required:!0,children:[e.jsx("option",{value:"",children:"اختر الخزان..."}),b.map(r=>e.jsxs("option",{value:r.id,children:[r.name," (",r.product_type,")"]},r.id))]}),e.jsx(f,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-6 h-6 text-slate-300 group-focus-within:text-emerald-500 transition-colors"}),e.jsx("div",{className:"absolute top-1/2 left-4 -translate-y-1/2 pointer-events-none"})]})]})]})]}),e.jsxs(p,{className:"border-0 ring-1 ring-slate-200 shadow-sm bg-white p-6 rounded-2xl relative overflow-hidden dark:bg-white/5 dark:ring-white/10",children:[e.jsx("div",{className:"absolute top-0 right-0 w-2 h-full bg-gradient-to-b from-blue-500 to-indigo-600"}),e.jsxs("div",{className:"flex justify-between items-start mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-indigo-50 text-indigo-600 font-bold text-lg ring-4 ring-indigo-50/50 dark:bg-indigo-500/20 dark:text-indigo-400 dark:ring-indigo-500/10",children:"2"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-navy-900 dark:text-white",children:"تكوين المسدسات"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"حدد عدد المسدسات والعدادات لكل ماكينة"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-50 p-2 rounded-2xl border border-slate-100 dark:bg-slate-800 dark:border-slate-700",children:[e.jsx("span",{className:"text-sm font-bold text-slate-600 px-2 dark:text-slate-300",children:"عدد المسدسات:"}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4].map(r=>e.jsx("button",{type:"button",onClick:()=>d(t=>({...t,counter_count:r})),className:`w-10 h-10 rounded-xl font-bold transition-all duration-300 ${l.counter_count==r?"bg-indigo-600 text-white shadow-lg shadow-indigo-500/30 scale-105":"bg-white text-slate-400 hover:bg-indigo-50 dark:bg-slate-700 dark:text-slate-400 dark:hover:bg-slate-600"}`,children:r},r))})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx(_,{mode:"popLayout",children:Array.from({length:parseInt(l.counter_count)}).map((r,t)=>e.jsxs(i.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,scale:.9},className:"group relative bg-slate-50/50 hover:bg-white rounded-2xl p-6 border-2 border-slate-100 hover:border-indigo-100 transition-all duration-300 hover:shadow-lg hover:shadow-indigo-900/5 dark:bg-white/5 dark:border-white/5 dark:hover:bg-white/10 dark:hover:border-indigo-500/30",children:[e.jsx("button",{type:"button",onClick:()=>I(t),className:"absolute top-2 left-2 p-2 rounded-xl bg-slate-100 text-slate-400 hover:bg-red-50 hover:text-red-500 transition-colors z-20",title:"حذف العداد",children:e.jsx(E,{size:16})}),e.jsxs("div",{className:"absolute -left-3 top-6 bg-white border border-slate-200 text-slate-400 font-mono text-xs px-2 py-1 rounded-lg shadow-sm group-hover:border-indigo-200 group-hover:text-indigo-500 transition-colors",children:["Nozzle #",String(t+1).padStart(2,"0")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 pl-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider dark:text-slate-400",children:"اسم العداد"}),e.jsx("input",{type:"text",value:l.counter_names[t]||"",onChange:a=>g(t,"counter_names",a.target.value),className:"w-full bg-white border border-slate-200 rounded-xl px-4 py-3 text-sm font-bold text-navy-900 outline-none focus:border-indigo-500 transition-colors dark:bg-slate-800 dark:border-slate-700 dark:text-white",placeholder:`مثال: عداد ${t+1}`,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider dark:text-slate-400",children:"قراءة العداد الحالية"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",value:l.readings[t]||"",onChange:a=>g(t,"readings",a.target.value),className:"w-full bg-white border border-slate-200 rounded-xl px-4 py-3 pl-10 text-sm font-mono font-bold text-navy-900 outline-none focus:border-indigo-500 transition-colors dark:bg-slate-800 dark:border-slate-700 dark:text-white",placeholder:"000000.00",required:!0}),e.jsx(R,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-300"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider dark:text-slate-400",children:"تعيين لعامل"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:l.workers[t]||"",onChange:a=>g(t,"workers",a.target.value),className:"w-full bg-white border border-slate-200 rounded-xl px-4 py-3 pl-10 text-sm font-bold text-navy-900 outline-none focus:border-indigo-500 transition-colors appearance-none cursor-pointer dark:bg-slate-800 dark:border-slate-700 dark:text-white",required:!0,children:[e.jsx("option",{value:"",children:"-- اختر عامل --"}),C.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),e.jsx(z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-300"})]})]})]})]},t))})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 pt-4",children:[e.jsx(i.button,{whileHover:{scale:1.02},whileTap:{scale:.98},type:"button",onClick:()=>window.location.href="/PETRODIESEL2/public/pumps",className:"px-8 py-4 rounded-2xl bg-white text-slate-500 font-bold border border-slate-200 hover:bg-slate-50 hover:text-slate-700 transition-colors dark:bg-slate-800 dark:border-slate-700 dark:text-slate-400 dark:hover:bg-slate-700 dark:hover:text-white",children:"إلغاء"}),e.jsxs(i.button,{whileHover:{scale:1.02,boxShadow:"0 20px 25px -5px rgb(16 185 129 / 0.15), 0 8px 10px -6px rgb(16 185 129 / 0.15)"},whileTap:{scale:.98},type:"submit",className:"flex-1 lg:flex-none px-12 py-4 rounded-2xl bg-gradient-to-r from-emerald-500 to-teal-600 text-white font-bold text-lg shadow-xl shadow-emerald-500/20 hover:from-emerald-400 hover:to-teal-500 transition-all flex items-center justify-center gap-3",children:[e.jsx(L,{className:"w-6 h-6"}),e.jsx("span",{children:"حفظ بيانات الماكينة"})]})]})]})})]})})}export{M as default};
