import{j as e,m as v,y as W,N as b,q as J,F as u,C as g,o as D,ak as K,r as Q,l as X,z as Y,E as Z,t as m}from"./ui-DpPGrQoH.js";import{r as l}from"./vendor-BdFMDtQB.js";import{D as ee,b as te,m as S,h as C,c as _,p as L,v as P,f as h,g as se}from"./main-i_nKCBsx.js";function ce({sales:i=[]}){const[a,s]=l.useState(""),[n,o]=l.useState(""),[c,j]=l.useState(""),[p,M]=l.useState(i),F=(p||[]).map(t=>{let r="-";const d=(t.payment_method||t.method||"cash").toLowerCase();return d==="cash"?t.bank_name?r=`بنك: ${t.bank_name}`:t.safe_name?r=`خزنة: ${t.safe_name}`:r="نقدي (غير محدد)":d==="credit"&&(r=t.customer_name||"عميل غير محدد"),{id:t.id||t.sale_id,date:t.created_at||t.date,pump:t.pump_name||t.pump||"Unknown Pump",fuel:t.product_type||t.fuel||"General",liters:t.volume_sold||t.liters||0,amount:t.total_amount||t.amount||0,unit_price:t.unit_price||0,method:d==="cash"?"نقدي":"آجل",account:r,raw_method:d}}),[O,f]=l.useState(!1),[x,w]=l.useState(null),[$,y]=l.useState(!1),[z,B]=l.useState(!1),[R,ne]=l.useState(null),[T,V]=l.useState(!1),[A,re]=l.useState(null),H=t=>{window.location.href=`${window.BASE_URL}/sales/edit?id=${t.id}`},I=t=>{window.open(`${window.BASE_URL}/sales/invoice?id=${t.id}`,"_blank")},U=t=>{w(t),f(!0)},q=async()=>{if(!x)return;y(!0);const t=new FormData;t.append("id",x.id);try{const d=await(await fetch(`${window.BASE_URL}/sales/delete_ajax`,{method:"POST",body:t})).json();d.success?(m.success("تم حذف عملية البيع بنجاح"),M(G=>G.filter(k=>(k.id||k.sale_id)!==x.id))):m.error(d.message||"فشل عملية الحذف")}catch(r){console.error(r),m.error("خطأ في الاتصال بالخادم")}finally{y(!1),f(!1),w(null)}},N=F.filter(t=>(t.id.toString().includes(a)||t.pump.toLowerCase().includes(a.toLowerCase()))&&(n?t.pump===n:!0)&&(c?t.method.toLowerCase()===c.toLowerCase():!0));return e.jsxs(v.div,{initial:{opacity:0},animate:{opacity:1},className:"p-6 max-w-[1800px] mx-auto space-y-6",children:[e.jsx(ee,{isOpen:O,onClose:()=>f(!1),onConfirm:q,title:"تحذير: حذف عملية بيع",message:`سيتم حذف عملية البيع رقم #${(x==null?void 0:x.id)||""}. هل أنت متأكد؟ لا يمكن التراجع عن هذا الإجراء.`,isDeleting:$}),e.jsx(le,{isOpen:z,onClose:()=>B(!1),sale:R}),e.jsx(ae,{isOpen:T,onClose:()=>V(!1),sale:A}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx(te,{className:"text-3xl font-bold text-navy-900 font-cairo",children:"سجل المبيعات"}),e.jsx(S,{className:"text-slate-500",children:"استعراض وإدارة جميع عمليات بيع الوقود"})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("button",{onClick:()=>window.location.href=`${window.BASE_URL}/sales/create`,className:"button",children:[e.jsx("span",{className:"text_button",children:"فاتورة جديدة"}),e.jsx("div",{className:"dots_border"}),e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",height:"24",width:"24",xmlns:"http://www.w3.org/2000/svg",className:"sparkle",children:e.jsx("path",{className:"path",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M12 4.5v15m7.5-7.5h-15"})})]}),e.jsx(C,{variant:"secondary",icon:W,className:"rounded-xl font-bold",children:"تصدير Excel"}),e.jsx(C,{variant:"primary",icon:b,className:"rounded-xl font-bold bg-navy-900 hover:bg-navy-800",children:"تقرير يومي"})]})]}),e.jsx(_,{className:"rounded-2xl shadow-sm ring-1 ring-slate-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx(L,{placeholder:"بحث برقم العملية...",className:"pl-4 pr-10 py-2 rounded-xl",value:a,onChange:t=>s(t.target.value)})]}),e.jsxs(P,{placeholder:"فلتر الماكينة",value:n,onValueChange:o,className:"rounded-xl",children:[e.jsx(h,{value:"Pump 1",icon:u,children:"Pump 1"}),e.jsx(h,{value:"Pump 2",icon:u,children:"Pump 2"}),e.jsx(h,{value:"Pump 3",icon:u,children:"Pump 3"})]}),e.jsxs(P,{placeholder:"طريقة الدفع",value:c,onValueChange:j,className:"rounded-xl",children:[e.jsx(h,{value:"Cash",icon:E,children:"نقدي (Cash)"}),e.jsx(h,{value:"Credit",icon:g,children:"آجل (Credit)"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"relative w-full",children:[e.jsx(D,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx(L,{type:"date",className:"pl-4 pr-10 py-2 rounded-xl"})]})})]})}),e.jsxs(_,{className:"rounded-2xl shadow-lg ring-1 ring-slate-200 overflow-hidden p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-right",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 text-sm font-bold text-slate-600",children:"رقم #"}),e.jsx("th",{className:"p-4 text-sm font-bold text-slate-600",children:"التاريخ والوقت"}),e.jsx("th",{className:"p-4 text-sm font-bold text-slate-600",children:"الماكينة / الصنف"}),e.jsx("th",{className:"p-4 text-sm font-bold text-slate-600",children:"الكمية (L)"}),e.jsx("th",{className:"p-4 text-sm font-bold text-slate-600",children:"المبلغ (SDG)"}),e.jsx("th",{className:"p-4 text-sm font-bold text-slate-600",children:"طريقة الدفع"}),e.jsx("th",{className:"p-4 text-sm font-bold text-slate-600",children:"الحساب / العميل"}),e.jsx("th",{className:"p-4 text-sm font-bold text-slate-600 text-center",children:"إجراءات"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100",children:[N.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"p-8 text-center text-slate-400",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(b,{className:"w-8 h-8 opacity-50"}),e.jsx("p",{children:"لا توجد سجلات مبيعات"})]})})}),N.map(t=>e.jsxs("tr",{className:"hover:bg-blue-50/30 transition-colors group",children:[e.jsxs("td",{className:"p-4 font-mono font-bold text-slate-700",children:["#",t.id]}),e.jsx("td",{className:"p-4 text-sm text-slate-600 ltr:text-left direction-ltr",children:t.date}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-bold text-navy-900",children:t.pump}),e.jsx("span",{className:"text-xs text-slate-500",children:t.fuel})]})}),e.jsx("td",{className:"p-4 font-mono",children:Number(t.liters).toFixed(2)}),e.jsx("td",{className:"p-4 font-mono font-bold text-emerald-600",children:Number(t.amount).toFixed(2)}),e.jsx("td",{className:"p-4",children:e.jsx(se,{size:"xs",color:t.raw_method==="cash"?"emerald":"blue",icon:t.raw_method==="cash"?E:g,children:t.method})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-lg text-xs font-bold ${t.raw_method==="cash"?"bg-slate-100 text-slate-700":"bg-blue-50 text-blue-700"}`,children:t.account})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex justify-center gap-1",children:[e.jsx("button",{onClick:()=>I(t),className:"p-1.5 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",title:"معاينة",children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>H(t),className:"p-1.5 hover:bg-slate-100 rounded-lg text-slate-600 transition-colors",title:"تعديل",children:e.jsx(Q,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>U(t),className:"p-1.5 hover:bg-red-50 rounded-lg text-red-600 transition-colors",title:"حذف",children:e.jsx(X,{className:"w-4 h-4"})})]})})]},t.id))]})]})}),e.jsxs("div",{className:"p-4 border-t border-slate-100 flex justify-between items-center bg-slate-50/50",children:[e.jsxs(S,{className:"text-sm text-slate-500",children:["عرض ",N.length," سجل"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"p-2 border border-slate-200 rounded-lg hover:bg-white disabled:opacity-50",children:e.jsx(Y,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 border border-slate-200 rounded-lg hover:bg-white",children:e.jsx(Z,{className:"w-4 h-4"})})]})]})]})]})}function le({isOpen:i,onClose:a,sale:s}){if(!i)return null;const n=async o=>{o.preventDefault();const c=new FormData(o.target);c.append("id",s.id);try{const p=await(await fetch(`${window.BASE_URL}/sales/update_ajax`,{method:"POST",body:c})).json();p.success?(m.success("تم التحديث بنجاح"),window.location.reload()):m.error(p.message||"حدث خطأ أثناء التحديث")}catch{m.error("خطأ في الاتصال")}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs(v.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-50 p-4 border-b border-slate-100 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold text-lg text-navy-900",children:["تعديل عملية بيع #",s==null?void 0:s.id]}),e.jsx("button",{onClick:a,className:"text-slate-400 hover:text-red-500 transition-colors text-xl font-bold",children:"×"})]}),e.jsxs("form",{onSubmit:n,className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"الكمية (لتر)"}),e.jsx("input",{type:"number",step:"0.01",name:"liters",required:!0,defaultValue:s==null?void 0:s.liters,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"سعر اللتر"}),e.jsx("input",{type:"number",step:"0.01",name:"price",required:!0,defaultValue:s==null?void 0:s.unit_price,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"المبلغ الإجمالي"}),e.jsx("input",{type:"number",step:"0.01",name:"amount",required:!0,defaultValue:s==null?void 0:s.amount,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"طريقة الدفع"}),e.jsxs("select",{name:"method",defaultValue:s==null?void 0:s.method,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white",children:[e.jsx("option",{value:"Cash",children:"نقدي (Cash)"}),e.jsx("option",{value:"Credit",children:"آجل (Credit)"})]})]}),e.jsxs("div",{className:"pt-4 flex justify-end gap-2 text-sm font-bold",children:[e.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 rounded-xl text-slate-600 hover:bg-slate-100 transition-colors",children:"إلغاء"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-xl bg-blue-600 text-white hover:bg-blue-700 transition-colors shadow-lg shadow-blue-200",children:"حفظ التغييرات"})]})]})]})})}function ae({isOpen:i,onClose:a,sale:s}){if(!i||!s)return null;const n=()=>{window.print()};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 print:p-0 print:bg-white",onClick:a,children:e.jsxs(v.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},onClick:o=>o.stopPropagation(),className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl overflow-hidden print:rounded-none print:shadow-none print:max-w-none",children:[e.jsx("style",{children:`
                    @media print {
                        body * {
                            visibility: hidden;
                        }
                        .invoice-container, .invoice-container * {
                            visibility: visible;
                        }
                        .invoice-container {
                            position: absolute;
                            left: 0;
                            top: 0;
                            width: 100%;
                        }
                        .print-hidden {
                            display: none !important;
                        }
                        @page {
                            size: A4;
                            margin: 1cm;
                        }
                    }
                `}),e.jsxs("div",{className:"invoice-container",children:[e.jsx("div",{className:"hidden print:block border-b-4 border-blue-600 pb-4 mb-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-black text-slate-800",children:"PETRODIESEL"}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"شركة بترودیزل لتجارة المحروقات"}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"هاتف: +249 123 456 789"}),e.jsx("p",{className:"text-xs text-slate-500",children:"العنوان: الخرطوم، السودان"})]}),e.jsx("div",{className:"text-left",children:e.jsxs("div",{className:"bg-blue-600 text-white px-4 py-2 rounded-lg",children:[e.jsx("p",{className:"text-xs",children:"Invoice / فاتورة"}),e.jsxs("p",{className:"text-lg font-bold",children:["#",s.id]})]})})]})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 p-6 text-white print-hidden",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-2xl flex items-center gap-2",children:[e.jsx(b,{className:"w-6 h-6"}),"فاتورة بيع"]}),e.jsxs("p",{className:"text-blue-100 mt-1",children:["رقم الفاتورة: #",s.id]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:n,className:"flex items-center gap-2 bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"طباعة"]}),e.jsx("button",{onClick:a,className:"text-white/80 hover:text-white hover:bg-white/20 rounded-lg p-2 transition-colors",children:e.jsx("span",{className:"text-2xl font-bold",children:"×"})})]})]})}),e.jsx("div",{className:"hidden print:block mb-6",children:e.jsx("h2",{className:"text-2xl font-bold text-center text-slate-800 mb-4",children:"فاتورة بيع محروقات"})}),e.jsxs("div",{className:"p-6 space-y-6 print:p-8",children:[e.jsxs("div",{className:"flex justify-between items-center pb-4 border-b-2 border-slate-200 print:border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"w-5 h-5 text-slate-400 print-hidden"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 print:text-slate-700",children:"التاريخ والوقت"}),e.jsx("p",{className:"font-bold text-slate-800 print:text-lg",children:s.date})]})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-xs text-slate-500 print:text-slate-700",children:"رقم الفاتورة"}),e.jsxs("p",{className:"font-mono font-bold text-xl text-blue-600 print:text-slate-800",children:["#",s.id]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 print:gap-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl print:bg-white print:border-2 print:border-slate-300",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(u,{className:"w-5 h-5 text-blue-600 print-hidden"}),e.jsx("p",{className:"text-xs text-blue-700 font-bold print:text-slate-800",children:"الماكينة والصنف"})]}),e.jsx("p",{className:"font-bold text-lg text-blue-900 print:text-slate-900 print:text-xl",children:s.pump}),e.jsx("p",{className:"text-sm text-blue-700 mt-1 print:text-slate-600",children:s.fuel})]}),e.jsxs("div",{className:"bg-emerald-50 p-4 rounded-xl print:bg-white print:border-2 print:border-slate-300",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(g,{className:"w-5 h-5 text-emerald-600 print-hidden"}),e.jsx("p",{className:"text-xs text-emerald-700 font-bold print:text-slate-800",children:"طريقة الدفع"})]}),e.jsx("p",{className:"font-bold text-lg text-emerald-900 print:text-slate-900 print:text-xl",children:s.method}),e.jsx("p",{className:"text-sm text-emerald-700 mt-1 print:text-slate-600",children:s.account})]})]}),e.jsxs("div",{className:"bg-slate-50 p-6 rounded-xl print:bg-white print:border-2 print:border-slate-800",children:[e.jsxs("h4",{className:"font-bold text-slate-700 mb-4 flex items-center gap-2 print:text-lg print:text-slate-900 print:mb-6",children:[e.jsx(b,{className:"w-4 h-4 print-hidden"}),"تفاصيل الفاتورة"]}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b-2 border-slate-300 print:border-slate-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-right pb-3 text-sm text-slate-600 print:text-slate-900 print:text-base",children:"البند"}),e.jsx("th",{className:"text-center pb-3 text-sm text-slate-600 print:text-slate-900 print:text-base",children:"الكمية"}),e.jsx("th",{className:"text-center pb-3 text-sm text-slate-600 print:text-slate-900 print:text-base",children:"السعر"}),e.jsx("th",{className:"text-left pb-3 text-sm text-slate-600 print:text-slate-900 print:text-base",children:"المجموع"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{className:"border-b border-slate-200 print:border-slate-400",children:[e.jsx("td",{className:"py-4 text-slate-700 print:text-slate-900 print:text-lg",children:s.fuel}),e.jsxs("td",{className:"py-4 text-center font-mono text-blue-600 print:text-slate-900 print:text-lg",children:[Number(s.liters).toFixed(2)," لتر"]}),e.jsxs("td",{className:"py-4 text-center font-mono text-slate-700 print:text-slate-900 print:text-lg",children:[Number(s.unit_price).toFixed(2)," SDG"]}),e.jsxs("td",{className:"py-4 text-left font-mono font-bold text-emerald-600 print:text-slate-900 print:text-lg",children:[Number(s.amount).toFixed(2)," SDG"]})]})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-slate-800",children:[e.jsx("td",{colSpan:"3",className:"pt-4 text-right font-bold text-slate-800 print:text-xl",children:"المبلغ الإجمالي:"}),e.jsxs("td",{className:"pt-4 text-left font-mono font-black text-2xl text-emerald-600 print:text-slate-900 print:text-3xl",children:[Number(s.amount).toFixed(2)," SDG"]})]})})]})]}),e.jsxs("div",{className:"hidden print:block mt-12 pt-6 border-t border-slate-300 text-center text-sm text-slate-600",children:[e.jsx("p",{className:"font-bold mb-2",children:"شكراً لتعاملكم معنا"}),e.jsx("p",{children:"هذه فاتورة إلكترونية صادرة من نظام PETRODIESEL"})]})]}),e.jsxs("div",{className:"p-4 bg-slate-50 border-t border-slate-200 flex justify-end gap-2 print-hidden",children:[e.jsxs("button",{onClick:n,className:"px-6 py-2.5 rounded-xl bg-blue-600 hover:bg-blue-700 text-white font-bold transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"طباعة الفاتورة"]}),e.jsx("button",{onClick:a,className:"px-6 py-2.5 rounded-xl bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold transition-colors",children:"إغلاق"})]})]})]})})}const E=i=>e.jsxs("svg",{...i,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{width:"20",height:"12",x:"2",y:"6",rx:"2"}),e.jsx("circle",{cx:"12",cy:"12",r:"2"}),e.jsx("path",{d:"M6 12h.01M18 12h.01"})]});export{ce as default};
