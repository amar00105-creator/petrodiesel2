import{c as H,r,j as e,a as M,m as w,U as ye,b as Se,t as u,e as ke,R as _e,W as De}from"./main-BZye3MWh.js";import{b as Ce,m as Ee}from"./Tracker-B3Wsk5ua.js";import{X as L}from"./x-CpP_tiue.js";import{D as Fe}from"./dollar-sign-Cqk2oubE.js";import{T as K}from"./tag-BP6_gIm2.js";import{S as W}from"./save-C_qR2yBp.js";import{T as le}from"./triangle-alert-BhxvaoUt.js";import{A as Le}from"./AddAssetModal-3aAhbOHV.js";import{C as Q}from"./calendar-qByBJSBc.js";import{P as Re}from"./printer-yTjQXX8F.js";import{S as Te}from"./search-CFPY5UOd.js";import{D as ne}from"./DeleteConfirmationModal-CGMvXUfk.js";import{L as O,V as P}from"./vault-rYfJ9mF1.js";import{S as re}from"./square-pen-DTQcLPwn.js";import{T as I}from"./trash-2-D_DkLkqJ.js";import{A as ie}from"./arrow-up-right-_m6SMph8.js";import{P as Me}from"./plus-CeiUBWS7.js";import{M as qe}from"./minus-BNYzu2jm.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],oe=H("arrow-down-right",$e);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],R=H("arrow-right-left",Ae);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],Pe=H("circle-plus",Oe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],ae=H("pen",Be);function Ue({isOpen:f,onClose:i,type:l,categories:N,safes:c,banks:g,suppliers:h=[],customers:p=[],baseUrl:d="/PETRODIESEL2/public"}){const[a,b]=r.useState({amount:"",description:"",category_id:"",account_type:"safe",account_id:"",related_entity_type:"general",related_entity_id:"",reference_number:"",date:new Date().toISOString().split("T")[0]}),o=l==="income",x=m=>{const{name:k,value:_}=m.target;b(D=>({...D,[k]:_}))},v=async m=>{m.preventDefault();try{const k=new FormData;k.append("type",l),Object.keys(a).forEach(s=>k.append(s,a[s]));const _=await fetch(`${d}/finance/storeTransaction`,{method:"POST",body:k,headers:{"X-Requested-With":"XMLHttpRequest"}}),D=await _.text();let n;try{n=JSON.parse(D)}catch{if(_.redirected||_.status===200){u.success(o?"تم تسجيل الإيراد بنجاح":"تم تسجيل المصروف بنجاح"),setTimeout(()=>window.location.reload(),500);return}throw new Error("Invalid server response")}n.success?(u.success(o?"تم تسجيل الإيراد بنجاح":"تم تسجيل المصروف بنجاح"),i(),setTimeout(()=>window.location.reload(),500)):u.error(n.message||"حدث خطأ ما")}catch(k){console.error(k),u.error("خطأ في الاتصال بالخادم")}};return e.jsx(M,{children:f&&e.jsxs(e.Fragment,{children:[e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:i,className:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 transition-opacity"}),e.jsx(w.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none",children:e.jsxs("div",{className:"bg-white pointer-events-auto rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:`p-6 border-b flex justify-between items-center ${o?"bg-emerald-50":"bg-rose-50"}`,children:[e.jsxs("div",{children:[e.jsx("h2",{className:`text-xl font-bold ${o?"text-emerald-800":"text-rose-800"}`,children:o?"تسجيل إيراد جديد":"تسجيل مصروف جديد"}),e.jsx("p",{className:`text-sm ${o?"text-emerald-600":"text-rose-600"}`,children:"أدخل تفاصيل العملية المالية"})]}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-white/50 rounded-full transition-colors",children:e.jsx(L,{className:"w-5 h-5 text-slate-500"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:e.jsxs("form",{id:"transaction-form",onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"المبلغ"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",name:"amount",value:a.amount,onChange:x,className:"w-full pl-4 pr-10 py-3 text-lg font-bold border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 transition-all outline-none",placeholder:"0.00",required:!0}),e.jsx("div",{className:"absolute right-3 top-3.5 text-slate-400",children:e.jsx(Fe,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-100 space-y-3",children:[e.jsxs("label",{className:"block text-sm font-bold text-slate-700",children:["الجهة المرتبطة ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded-lg hover:bg-white transition-colors",children:[e.jsx("input",{type:"radio",name:"related_entity_type",value:"general",checked:a.related_entity_type==="general",onChange:x,className:"w-4 h-4 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-bold text-slate-700",children:"عام"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded-lg hover:bg-white transition-colors",children:[e.jsx("input",{type:"radio",name:"related_entity_type",value:"supplier",checked:a.related_entity_type==="supplier",onChange:x,className:"w-4 h-4 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-bold text-slate-700",children:"مورد"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded-lg hover:bg-white transition-colors",children:[e.jsx("input",{type:"radio",name:"related_entity_type",value:"customer",checked:a.related_entity_type==="customer",onChange:x,className:"w-4 h-4 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-bold text-slate-700",children:"عميل"})]})]}),e.jsxs("div",{className:"relative animate-in fade-in slide-in-from-top-2",children:[e.jsxs("select",{name:"related_entity_id",value:a.related_entity_id,onChange:x,className:"w-full pl-4 pr-10 py-2.5 bg-white border border-slate-200 rounded-lg outline-none focus:ring-2 focus:ring-blue-500/20 font-bold",required:!0,children:[e.jsx("option",{value:"",children:a.related_entity_type==="general"?"اختر بند المصروف...":a.related_entity_type==="supplier"?"اختر المورد...":"اختر العميل..."}),a.related_entity_type==="general"&&N.map(m=>e.jsx("option",{value:m.id,children:m.name},m.id)),a.related_entity_type==="supplier"&&(Array.isArray(h)&&h.length>0?h.map(m=>e.jsx("option",{value:m.id,children:m.name},m.id)):e.jsx("option",{value:"",disabled:!0,children:"لا يوجد موردين مسجلين"})),a.related_entity_type==="customer"&&(Array.isArray(p)&&p.length>0?p.map(m=>e.jsx("option",{value:m.id,children:m.name},m.id)):e.jsx("option",{value:"",disabled:!0,children:"لا يوجد عملاء مسجلين"}))]}),e.jsx("div",{className:"absolute right-3 top-3 text-slate-400",children:a.related_entity_type==="general"?e.jsx(K,{className:"w-4 h-4"}):a.related_entity_type==="supplier"?e.jsx(ye,{className:"w-4 h-4"}):e.jsx(Se,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"نوع الحساب"}),e.jsxs("select",{name:"account_type",value:a.account_type,onChange:x,className:"w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500/20",children:[e.jsx("option",{value:"safe",children:"خزنة نقدية"}),e.jsx("option",{value:"bank",children:"حساب بنكي"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"اختر الحساب"}),e.jsxs("select",{name:"account_id",value:a.account_id,onChange:x,className:"w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500/20",required:!0,children:[e.jsx("option",{value:"",children:"-- اختر --"}),(a.account_type==="safe"?c:g).map(m=>e.jsx("option",{value:m.id,children:m.name},m.id))]})]})]}),a.account_type==="bank"&&e.jsxs(w.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-blue-50/50 p-3 rounded-xl border border-blue-100",children:[e.jsx("label",{className:"block text-xs font-bold text-blue-700 mb-2",children:"رقم العملية (اختياري)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"reference_number",value:a.reference_number,onChange:x,className:"w-full pl-4 pr-10 py-2 bg-white border border-blue-200 rounded-lg outline-none focus:ring-2 focus:ring-blue-500/20 font-bold text-sm",placeholder:"أدخل رقم التحويل أو الشيك..."}),e.jsx("div",{className:"absolute right-3 top-2.5 text-blue-400",children:e.jsx(K,{className:"w-4 h-4"})})]})]}),a.related_entity_type==="general"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"التصنيف"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{name:"category_id",value:a.category_id,onChange:x,className:"w-full pl-4 pr-10 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500/20",required:!0,children:[e.jsx("option",{value:"",children:"اختر تصنيف العملية..."}),N.map(m=>e.jsx("option",{value:m.id,children:m.name},m.id))]}),e.jsx("div",{className:"absolute right-3 top-3.5 text-slate-400",children:e.jsx(K,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"الوصف / البيان"}),e.jsx("textarea",{name:"description",value:a.description,onChange:x,rows:"3",className:"w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500/20",placeholder:"اكتب تفاصيل العملية هنا...",required:!0})]})]})}),e.jsxs("div",{className:"p-6 border-t bg-slate-50 flex gap-3",children:[e.jsx("button",{onClick:i,className:"flex-1 px-6 py-3 bg-white border border-slate-200 text-slate-700 rounded-xl font-bold hover:bg-slate-100 transition-colors",children:"إلغاء"}),e.jsxs("button",{type:"submit",form:"transaction-form",className:`flex-1 px-6 py-3 text-white rounded-xl font-bold shadow-lg shadow-blue-500/30 hover:-translate-y-1 transition-all flex items-center justify-center gap-2 ${o?"bg-gradient-to-r from-emerald-500 to-emerald-600":"bg-gradient-to-r from-rose-500 to-rose-600"}`,children:[e.jsx(W,{className:"w-5 h-5"})," حفظ العملية"]})]})]})})]})})}function Xe({isOpen:f,onClose:i,transaction:l,onSuccess:N}){const[c,g]=r.useState({id:"",amount:"",description:"",date:""}),[h,p]=r.useState(!1);if(r.useEffect(()=>{l&&g({id:l.id,amount:l.amount,description:l.description,date:l.date})},[l]),!f)return null;const d=async a=>{a.preventDefault(),p(!0);try{const b=new FormData;b.append("id",c.id),b.append("amount",c.amount),b.append("description",c.description),b.append("date",c.date);const x=await(await fetch("/PETRODIESEL2/public/finance/updateTransaction",{method:"POST",body:b,headers:{"X-Requested-With":"XMLHttpRequest"}})).json();x.success?(u.success("تم تحديث العملية بنجاح"),N(),i()):u.error(x.message||"حدث خطأ أثناء التحديث")}catch(b){console.error(b),u.error("خطأ في الاتصال بالخادم")}finally{p(!1)}};return e.jsx(M,{children:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm",children:e.jsxs(w.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50",children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800",children:"تعديل العملية"}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-slate-200 rounded-full transition-colors text-slate-500",children:e.jsx(L,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:d,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-xl flex items-start gap-3",children:[e.jsx(le,{className:"w-5 h-5 text-amber-600 shrink-0 mt-0.5"}),e.jsx("p",{className:"text-xs text-amber-800",children:"تنبيه: تعديل المبلغ سيؤثر تلقائياً على رصيد الخزنة أو البنك المرتبط بهذه العملية."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"وصف العملية"}),e.jsx("input",{type:"text",className:"w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 outline-none font-bold text-slate-700",value:c.description,onChange:a=>g({...c,description:a.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"المبلغ"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 outline-none font-bold text-slate-700",value:c.amount,onChange:a=>g({...c,amount:a.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"التاريخ"}),e.jsx("input",{type:"date",className:"w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 outline-none font-bold text-slate-700",value:c.date,onChange:a=>g({...c,date:a.target.value}),required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:i,className:"px-6 py-2.5 rounded-xl text-slate-500 hover:bg-slate-100 font-bold transition-all",children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:h,className:"px-6 py-2.5 bg-blue-600 text-white rounded-xl shadow-lg hover:shadow-blue-500/30 font-bold flex items-center gap-2",children:h?"جاري الحفظ...":e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4"})," حفظ التعديلات"]})})]})]})]})})})}function ze({isOpen:f,onClose:i,safes:l,banks:N}){const[c,g]=r.useState({amount:"",from_type:"safe",from_id:"",to_type:"bank",to_id:"",description:"تحويل مالي"}),h=d=>{const{name:a,value:b}=d.target;g(o=>({...o,[a]:b}))},p=async d=>{d.preventDefault();try{const a=new FormData;Object.keys(c).forEach(v=>a.append(v,c[v]));const b=await fetch("/PETRODIESEL2/public/finance/transfer",{method:"POST",body:a,headers:{"X-Requested-With":"XMLHttpRequest"}}),o=await b.text();let x;try{x=JSON.parse(o)}catch{if(b.redirected||b.status===200){u.success("تم التحويل بنجاح"),i(),setTimeout(()=>window.location.reload(),500);return}throw new Error("Invalid server response")}x.success?(u.success("تم التحويل بنجاح"),i(),setTimeout(()=>window.location.reload(),500)):u.error(x.message||"حدث خطأ ما")}catch(a){console.error(a),u.error("خطأ في الاتصال بالخادم")}};return e.jsx(M,{children:f&&e.jsxs(e.Fragment,{children:[e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:i,className:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 transition-opacity"}),e.jsx(w.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none",children:e.jsxs("div",{className:"bg-white pointer-events-auto rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b flex justify-between items-center bg-blue-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 text-blue-600",children:e.jsx(R,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"تحويل رصيد"}),e.jsx("p",{className:"text-sm text-blue-600",children:"نقل الأموال بين الحسابات"})]})]}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-white/50 rounded-full transition-colors",children:e.jsx(L,{className:"w-5 h-5 text-slate-500"})})]}),e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("form",{id:"transfer-form",onSubmit:p,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"المبلغ المراد تحويله"}),e.jsx("input",{type:"number",step:"0.01",name:"amount",value:c.amount,onChange:h,className:"w-full text-center p-4 text-2xl font-bold bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500/20",placeholder:"0.00",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-[1fr,auto,1fr] gap-2 items-center",children:[e.jsxs("div",{className:"bg-rose-50 p-4 rounded-xl border border-rose-100",children:[e.jsxs("div",{className:"text-xs font-bold text-rose-600 mb-2 flex items-center gap-1",children:[e.jsx(R,{className:"w-3 h-3 rotate-180"})," من حساب"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{name:"from_type",value:c.from_type,onChange:h,className:"w-full p-2 bg-white text-sm border-none rounded-lg shadow-sm outline-none",children:[e.jsx("option",{value:"safe",children:"خزينة"}),e.jsx("option",{value:"bank",children:"بنك"})]}),e.jsxs("select",{name:"from_id",value:c.from_id,onChange:h,className:"w-full p-2 bg-white text-sm border-none rounded-lg shadow-sm outline-none",required:!0,children:[e.jsx("option",{value:"",children:"-- اختر --"}),(c.from_type==="safe"?l:N).map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]})]})]}),e.jsx(R,{className:"w-5 h-5 text-slate-300"}),e.jsxs("div",{className:"bg-emerald-50 p-4 rounded-xl border border-emerald-100",children:[e.jsxs("div",{className:"text-xs font-bold text-emerald-600 mb-2 flex items-center gap-1",children:[e.jsx(R,{className:"w-3 h-3"})," إلى حساب"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{name:"to_type",value:c.to_type,onChange:h,className:"w-full p-2 bg-white text-sm border-none rounded-lg shadow-sm outline-none",children:[e.jsx("option",{value:"safe",children:"خزينة"}),e.jsx("option",{value:"bank",children:"بنك"})]}),e.jsxs("select",{name:"to_id",value:c.to_id,onChange:h,className:"w-full p-2 bg-white text-sm border-none rounded-lg shadow-sm outline-none",required:!0,children:[e.jsx("option",{value:"",children:"-- اختر --"}),(c.to_type==="safe"?l:N).map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"ملاحظات التحويل"}),e.jsx("input",{type:"text",name:"description",value:c.description,onChange:h,className:"w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500/20",placeholder:"سبب التحويل..."})]})]})}),e.jsxs("div",{className:"p-5 border-t bg-slate-50 flex gap-3",children:[e.jsx("button",{onClick:i,className:"flex-1 px-4 py-2.5 bg-white border border-slate-200 text-slate-700 rounded-xl font-bold hover:bg-slate-100 transition-colors",children:"إلغاء"}),e.jsxs("button",{type:"submit",form:"transfer-form",className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 shadow-lg shadow-blue-500/30 transition-all flex items-center justify-center gap-2",children:[e.jsx(W,{className:"w-5 h-5"})," إتمام التحويل"]})]})]})})]})})}function Ie({isOpen:f,onClose:i}){const[l,N]=r.useState({start_date:new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString().split("T")[0],end_date:new Date().toISOString().split("T")[0],type:""}),[c,g]=r.useState(!1),[h,p]=r.useState({transactions:[],totals:{income:0,expense:0}}),d=async()=>{g(!0);try{const o=new URLSearchParams(l).toString(),v=await(await fetch(`/PETRODIESEL2/public/finance/reports?${o}`,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json();v.success?p({transactions:v.transactions,totals:v.totals}):u.error("فشل تحميل التقرير")}catch(o){console.error(o),u.error("خطأ في الاتصال")}finally{g(!1)}};r.useEffect(()=>{f&&d()},[f,l]);const a=()=>{window.print()},b=o=>{const{name:x,value:v}=o.target;N(m=>({...m,[x]:v}))};return e.jsx(M,{children:f&&e.jsxs(e.Fragment,{children:[e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:i,className:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 printable-hidden"}),e.jsx(w.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none",children:e.jsxs("div",{className:"bg-white pointer-events-auto rounded-3xl shadow-2xl w-full max-w-5xl h-[90vh] flex flex-col overflow-hidden printable-content",children:[e.jsxs("div",{className:"p-6 border-b flex justify-between items-center bg-slate-50 printable-header",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"التقارير المالية"}),e.jsxs("div",{className:"text-sm text-slate-500 mt-1 flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),l.start_date," - ",l.end_date]})]}),e.jsxs("div",{className:"flex gap-2 printable-hidden",children:[e.jsx("button",{onClick:a,className:"p-2 bg-white border border-slate-200 text-slate-600 rounded-xl hover:bg-slate-100 transition-colors",children:e.jsx(Re,{className:"w-5 h-5"})}),e.jsx("button",{onClick:i,className:"p-2 bg-white border border-slate-200 text-slate-600 rounded-xl hover:bg-red-50 hover:text-red-600 hover:border-red-100 transition-colors",children:e.jsx(L,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"p-4 border-b bg-white flex flex-wrap gap-4 items-end printable-hidden",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1 block",children:"من تاريخ"}),e.jsx("input",{type:"date",name:"start_date",value:l.start_date,onChange:b,className:"w-full p-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-500/20 outline-none"})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1 block",children:"إلى تاريخ"}),e.jsx("input",{type:"date",name:"end_date",value:l.end_date,onChange:b,className:"w-full p-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-500/20 outline-none"})]}),e.jsxs("div",{className:"flex-1 min-w-[150px]",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1 block",children:"النوع"}),e.jsxs("select",{name:"type",value:l.type,onChange:b,className:"w-full p-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-500/20 outline-none",children:[e.jsx("option",{value:"",children:"الكل"}),e.jsx("option",{value:"income",children:"إيرادات"}),e.jsx("option",{value:"expense",children:"مصروفات"})]})]}),e.jsxs("button",{onClick:d,className:"px-6 py-2.5 bg-blue-600 text-white rounded-xl text-sm font-bold hover:bg-blue-700 transition-colors shadow-lg shadow-blue-500/30",children:[e.jsx(Te,{className:"w-4 h-4 inline-block ml-2"})," بحث"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-50/50",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"p-6 bg-emerald-500 text-white rounded-2xl shadow-lg shadow-emerald-500/20",children:[e.jsx("div",{className:"text-emerald-100 text-sm mb-1",children:"إجمالي الإيرادات"}),e.jsx("div",{className:"text-3xl font-bold font-mono",children:h.totals.income.toLocaleString("en-US",{minimumFractionDigits:2})})]}),e.jsxs("div",{className:"p-6 bg-rose-500 text-white rounded-2xl shadow-lg shadow-rose-500/20",children:[e.jsx("div",{className:"text-rose-100 text-sm mb-1",children:"إجمالي المنصرفات"}),e.jsx("div",{className:"text-3xl font-bold font-mono",children:h.totals.expense.toLocaleString("en-US",{minimumFractionDigits:2})})]}),e.jsxs("div",{className:"p-6 bg-blue-500 text-white rounded-2xl shadow-lg shadow-blue-500/20",children:[e.jsx("div",{className:"text-blue-100 text-sm mb-1",children:"صافي التدفق"}),e.jsx("div",{className:"text-3xl font-bold font-mono",children:(h.totals.income-h.totals.expense).toLocaleString("en-US",{minimumFractionDigits:2})})]})]}),e.jsx("div",{className:"bg-white border boundary-slate-200 rounded-2xl overflow-hidden shadow-sm",children:e.jsxs("table",{className:"w-full text-right",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-100 text-slate-500 text-xs uppercase font-bold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"التاريخ"}),e.jsx("th",{className:"p-4",children:"البيان / الوصف"}),e.jsx("th",{className:"p-4",children:"النوع"}),e.jsx("th",{className:"p-4",children:"التصنيف"}),e.jsx("th",{className:"p-4 text-left",children:"المبلغ"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 text-sm text-slate-700",children:c?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"p-8 text-center text-slate-400",children:"جاري التحميل..."})}):h.transactions.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"p-8 text-center text-slate-400",children:"لا توجد سجلات في هذه الفترة"})}):h.transactions.map((o,x)=>e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"p-4 text-slate-500 font-mono",children:o.date}),e.jsx("td",{className:"p-4 font-medium",children:o.description}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-bold ${o.type==="income"?"bg-emerald-50 text-emerald-600":o.type==="expense"?"bg-rose-50 text-rose-600":"bg-blue-50 text-blue-600"}`,children:o.type==="income"?"إيراد":o.type==="expense"?"منصرف":"تحويل"})}),e.jsx("td",{className:"p-4 text-slate-500",children:o.category_name||"-"}),e.jsx("td",{className:`p-4 font-mono font-bold text-left ${o.type==="income"?"text-emerald-600":"text-rose-600"}`,children:parseFloat(o.amount).toLocaleString("en-US")})]},x))}),h.transactions.length>0&&e.jsx("tfoot",{className:"bg-slate-50 font-bold border-t",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"p-4 text-left",children:"المجموع"}),e.jsx("td",{className:"p-4 font-mono text-left dir-ltr",children:(h.totals.income-h.totals.expense).toLocaleString("en-US")})]})})]})})]})]})})]})})}function He({isOpen:f,onClose:i,bankId:l}){var _,D,n;const[N,c]=r.useState(!1),[g,h]=r.useState({bank:null,transactions:[]}),[p,d]=r.useState(!1),[a,b]=r.useState({name:"",account_number:""}),[o,x]=r.useState(!1),v=async()=>{if(l){c(!0);try{const y=await(await fetch(`/PETRODIESEL2/public/finance/getBankDetails?id=${l}`,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json();y.success?(h({bank:y.bank,transactions:y.transactions}),b({name:y.bank.name,account_number:y.bank.account_number})):(u.error(y.message||"فشل تحميل بيانات البنك"),i())}catch(s){console.error(s),u.error("خطأ في الاتصال"),i()}finally{c(!1)}}};r.useEffect(()=>{f&&l&&(v(),d(!1))},[f,l]);const m=async s=>{s.preventDefault();try{const y=new FormData;y.append("id",l),y.append("name",a.name),y.append("account_number",a.account_number),(await(await fetch("/PETRODIESEL2/public/finance/updateBank",{method:"POST",body:y,headers:{"X-Requested-With":"XMLHttpRequest"}})).json()).success?(u.success("تم تحديث بيانات البنك بنجاح"),d(!1),v(),setTimeout(()=>window.location.reload(),1e3)):u.error("فشل التحديث")}catch{u.error("خطأ في الاتصال")}},k=async()=>{try{const s=new FormData;s.append("id",l),(await(await fetch("/PETRODIESEL2/public/finance/deleteBank",{method:"POST",body:s,headers:{"X-Requested-With":"XMLHttpRequest"}})).json()).success?(u.success("تم حذف البنك بنجاح"),x(!1),i(),setTimeout(()=>window.location.reload(),500)):u.error("فشل الحذف")}catch{u.error("خطأ في الاتصال")}};return f?e.jsx(M,{children:f&&e.jsxs(e.Fragment,{children:[e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:i,className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50"}),e.jsx(ne,{isOpen:o,onClose:()=>x(!1),onConfirm:k,title:"حذف البنك",message:"هل أنت متأكد من حذف هذا البنك؟ سيتم حذف جميع السجلات المرتبطة به."}),e.jsx(w.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none",children:e.jsxs("div",{className:"bg-white pointer-events-auto rounded-[2rem] shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden ring-1 ring-slate-900/5",children:[e.jsxs("div",{className:"relative bg-gradient-to-br from-indigo-600 to-indigo-800 p-8 text-white overflow-hidden shrink-0",children:[e.jsx("div",{className:"absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-white/10 rounded-full blur-2xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 -mb-10 -ml-10 w-40 h-40 bg-indigo-500/30 rounded-full blur-2xl"}),e.jsxs("div",{className:"relative z-10 flex justify-between items-start",children:[e.jsxs("div",{className:"flex gap-4 items-center w-full",children:[e.jsx("div",{className:"p-3 bg-white/20 backdrop-blur-md rounded-2xl shadow-inner",children:e.jsx(O,{className:"w-8 h-8 text-white"})}),p?e.jsxs("div",{className:"flex-1 ml-8 space-y-2",children:[e.jsx("input",{value:a.name,onChange:s=>b({...a,name:s.target.value}),className:"w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/50 outline-none focus:bg-white/20",placeholder:"اسم البنك"}),e.jsx("input",{value:a.account_number,onChange:s=>b({...a,account_number:s.target.value}),className:"w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/50 outline-none focus:bg-white/20 font-mono",placeholder:"رقم الحساب"})]}):e.jsxs("div",{children:[N?e.jsx("div",{className:"h-8 w-48 bg-white/20 rounded animate-pulse mb-2"}):e.jsx("h2",{className:"text-3xl font-bold",children:(_=g.bank)==null?void 0:_.name}),e.jsxs("div",{className:"flex items-center gap-2 text-indigo-100 opacity-90",children:[e.jsx(ke,{className:"w-4 h-4"}),e.jsx("span",{className:"font-mono tracking-wider",children:((D=g.bank)==null?void 0:D.account_number)||"...."})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[p?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:m,className:"px-3 py-1 bg-emerald-500 hover:bg-emerald-600 rounded-lg text-white font-bold text-sm transition-colors",children:"حفظ"}),e.jsx("button",{onClick:()=>d(!1),className:"px-3 py-1 bg-white/10 hover:bg-white/20 rounded-lg text-white text-sm transition-colors",children:"إلغاء"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>d(!0),className:"p-2 bg-white/10 hover:bg-white/20 rounded-full transition-colors backdrop-blur-md group",title:"تعديل",children:e.jsx(re,{className:"w-5 h-5 text-white group-hover:scale-110 transition-transform"})}),e.jsx("button",{onClick:()=>x(!0),className:"p-2 bg-rose-500/20 hover:bg-rose-500/40 rounded-full transition-colors backdrop-blur-md group",title:"حذف",children:e.jsx(I,{className:"w-5 h-5 text-rose-200 group-hover:text-white transition-colors"})})]}),e.jsx("button",{onClick:i,className:"p-2 bg-white/10 hover:bg-white/20 rounded-full transition-colors backdrop-blur-md mr-2",children:e.jsx(L,{className:"w-6 h-6 text-white"})})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("div",{className:"text-indigo-200 text-sm mb-1 uppercase tracking-wider font-semibold",children:"الرصيد الحالي"}),N?e.jsx("div",{className:"h-12 w-64 bg-white/20 rounded animate-pulse"}):e.jsxs("div",{className:"text-5xl font-bold font-mono tracking-tight",children:[parseFloat(((n=g.bank)==null?void 0:n.balance)||0).toLocaleString("en-US")," ",e.jsx("span",{className:"text-2xl opacity-60",children:"ر.س"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-slate-50",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-indigo-600"}),"سجل العمليات"]}),e.jsx("div",{className:"space-y-3",children:N?[1,2,3].map(s=>e.jsx("div",{className:"h-20 bg-white rounded-xl animate-pulse shadow-sm"},s)):g.transactions.length===0?e.jsxs("div",{className:"p-12 text-center text-slate-400",children:[e.jsx("div",{className:"bg-slate-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(O,{className:"w-8 h-8 text-slate-300"})}),e.jsx("p",{children:"لا توجد عمليات مسجلة لهذا الحساب"})]}):g.transactions.map((s,y)=>e.jsxs(w.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:y*.05},className:"bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex justify-between items-center hover:shadow-md transition-shadow group",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${s.type==="income"?"bg-emerald-50 text-emerald-600":s.type==="expense"?"bg-rose-50 text-rose-600":"bg-blue-50 text-blue-600"}`,children:s.type==="income"?e.jsx(oe,{className:"w-5 h-5"}):s.type==="expense"?e.jsx(ie,{className:"w-5 h-5"}):e.jsx(R,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-slate-800 text-lg",children:s.description}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500 mt-1",children:[e.jsx("span",{className:"font-mono text-xs bg-slate-100 px-2 py-0.5 rounded text-slate-600",children:s.created_at}),e.jsx("span",{children:"•"}),e.jsx("span",{className:`${s.type==="income"?"text-emerald-600":"text-slate-500"}`,children:s.category_name}),s.user_name&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{className:"text-slate-400 text-xs",children:["بواسطة: ",s.user_name]})]})]})]})]}),e.jsxs("div",{className:`text-xl font-bold font-mono ${s.type==="income"||s.type==="transfer"&&s.to_id==l?"text-emerald-600":"text-rose-600"}`,children:[s.type==="expense"||s.type==="transfer"&&s.from_id==l?"-":"+",parseFloat(s.amount).toLocaleString("en-US")]})]},y))})]})}),e.jsxs("div",{className:"p-4 bg-white border-t text-center text-xs text-slate-400",children:["عرض آخر ",g.transactions.length," عملية"]})]})})]})}):null}function We({isOpen:f,onClose:i,safeId:l}){var _,D;const[N,c]=r.useState(!1),[g,h]=r.useState({safe:null,transactions:[]}),[p,d]=r.useState(!1),[a,b]=r.useState({name:""}),[o,x]=r.useState(!1),v=async()=>{if(l){c(!0);try{const s=await(await fetch(`/PETRODIESEL2/public/finance/getSafeDetails?id=${l}`,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json();s.success?(h({safe:s.safe,transactions:s.transactions}),b({name:s.safe.name})):(u.error(s.message||"فشل تحميل بيانات الخزينة"),i())}catch(n){console.error(n),u.error("خطأ في الاتصال"),i()}finally{c(!1)}}};r.useEffect(()=>{f&&l&&(v(),d(!1))},[f,l]);const m=async n=>{n.preventDefault();try{const s=new FormData;s.append("id",l),s.append("name",a.name),(await(await fetch("/PETRODIESEL2/public/finance/updateSafe",{method:"POST",body:s,headers:{"X-Requested-With":"XMLHttpRequest"}})).json()).success?(u.success("تم تحديث بيانات الخزينة بنجاح"),d(!1),v(),setTimeout(()=>window.location.reload(),1e3)):u.error("فشل التحديث")}catch{u.error("خطأ في الاتصال")}},k=async()=>{try{const n=new FormData;n.append("id",l),(await(await fetch("/PETRODIESEL2/public/finance/deleteSafe",{method:"POST",body:n,headers:{"X-Requested-With":"XMLHttpRequest"}})).json()).success?(u.success("تم حذف الخزينة بنجاح"),x(!1),i(),setTimeout(()=>window.location.reload(),500)):u.error("فشل الحذف")}catch{u.error("خطأ في الاتصال")}};return f?e.jsx(M,{children:f&&e.jsxs(e.Fragment,{children:[e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:i,className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50"}),e.jsx(ne,{isOpen:o,onClose:()=>x(!1),onConfirm:k,title:"حذف الخزينة",message:"هل أنت متأكد من حذف هذة الخزينة؟ سيتم حذف جميع السجلات المرتبطة بها."}),e.jsx(w.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none",children:e.jsxs("div",{className:"bg-white pointer-events-auto rounded-[2rem] shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden ring-1 ring-slate-900/5",children:[e.jsxs("div",{className:"relative bg-gradient-to-br from-blue-600 to-blue-800 p-8 text-white overflow-hidden shrink-0",children:[e.jsx("div",{className:"absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-white/10 rounded-full blur-2xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 -mb-10 -ml-10 w-40 h-40 bg-blue-500/30 rounded-full blur-2xl"}),e.jsxs("div",{className:"relative z-10 flex justify-between items-start",children:[e.jsxs("div",{className:"flex gap-4 items-center w-full",children:[e.jsx("div",{className:"p-3 bg-white/20 backdrop-blur-md rounded-2xl shadow-inner",children:e.jsx(P,{className:"w-8 h-8 text-white"})}),p?e.jsx("div",{className:"flex-1 ml-8 space-y-2",children:e.jsx("input",{value:a.name,onChange:n=>b({...a,name:n.target.value}),className:"w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/50 outline-none focus:bg-white/20",placeholder:"اسم الخزينة"})}):e.jsxs("div",{children:[N?e.jsx("div",{className:"h-8 w-48 bg-white/20 rounded animate-pulse mb-2"}):e.jsx("h2",{className:"text-3xl font-bold",children:(_=g.safe)==null?void 0:_.name}),e.jsx("div",{className:"flex items-center gap-2 text-blue-100 opacity-90",children:e.jsx("span",{className:"font-medium text-sm",children:"خزينة نقدية"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[p?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:m,className:"px-3 py-1 bg-emerald-500 hover:bg-emerald-600 rounded-lg text-white font-bold text-sm transition-colors",children:"حفظ"}),e.jsx("button",{onClick:()=>d(!1),className:"px-3 py-1 bg-white/10 hover:bg-white/20 rounded-lg text-white text-sm transition-colors",children:"إلغاء"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>d(!0),className:"p-2 bg-white/10 hover:bg-white/20 rounded-full transition-colors backdrop-blur-md group",title:"تعديل",children:e.jsx(re,{className:"w-5 h-5 text-white group-hover:scale-110 transition-transform"})}),e.jsx("button",{onClick:()=>x(!0),className:"p-2 bg-rose-500/20 hover:bg-rose-500/40 rounded-full transition-colors backdrop-blur-md group",title:"حذف",children:e.jsx(I,{className:"w-5 h-5 text-rose-200 group-hover:text-white transition-colors"})})]}),e.jsx("button",{onClick:i,className:"p-2 bg-white/10 hover:bg-white/20 rounded-full transition-colors backdrop-blur-md mr-2",children:e.jsx(L,{className:"w-6 h-6 text-white"})})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("div",{className:"text-blue-200 text-sm mb-1 uppercase tracking-wider font-semibold",children:"الرصيد الحالي"}),N?e.jsx("div",{className:"h-12 w-64 bg-white/20 rounded animate-pulse"}):e.jsxs("div",{className:"text-5xl font-bold font-mono tracking-tight",children:[parseFloat(((D=g.safe)==null?void 0:D.balance)||0).toLocaleString("en-US")," ",e.jsx("span",{className:"text-2xl opacity-60",children:"ر.س"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-slate-50",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-blue-600"}),"سجل العمليات"]}),e.jsx("div",{className:"space-y-3",children:N?[1,2,3].map(n=>e.jsx("div",{className:"h-20 bg-white rounded-xl animate-pulse shadow-sm"},n)):g.transactions.length===0?e.jsxs("div",{className:"p-12 text-center text-slate-400",children:[e.jsx("div",{className:"bg-slate-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(P,{className:"w-8 h-8 text-slate-300"})}),e.jsx("p",{children:"لا توجد عمليات مسجلة لهذة الخزينة"})]}):g.transactions.map((n,s)=>e.jsxs(w.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:s*.05},className:"bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex justify-between items-center hover:shadow-md transition-shadow group",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${n.type==="income"?"bg-emerald-50 text-emerald-600":n.type==="expense"?"bg-rose-50 text-rose-600":"bg-blue-50 text-blue-600"}`,children:n.type==="income"?e.jsx(oe,{className:"w-5 h-5"}):n.type==="expense"?e.jsx(ie,{className:"w-5 h-5"}):e.jsx(R,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-slate-800 text-lg",children:n.description}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500 mt-1",children:[e.jsx("span",{className:"font-mono text-xs bg-slate-100 px-2 py-0.5 rounded text-slate-600",children:n.created_at}),e.jsx("span",{children:"•"}),e.jsx("span",{className:`${n.type==="income"?"text-emerald-600":"text-slate-500"}`,children:n.category_name}),n.user_name&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{className:"text-slate-400 text-xs",children:["بواسطة: ",n.user_name]})]})]})]})]}),e.jsxs("div",{className:`text-xl font-bold font-mono ${n.type==="income"||n.type==="transfer"&&n.to_id==l?"text-emerald-600":"text-rose-600"}`,children:[n.type==="expense"||n.type==="transfer"&&n.from_id==l?"-":"+",parseFloat(n.amount).toLocaleString("en-US")]})]},s))})]})}),e.jsxs("div",{className:"p-4 bg-white border-t text-center text-xs text-slate-400",children:["عرض آخر ",g.transactions.length," عملية"]})]})})]})}):null}function ft({safes:f=[],banks:i=[],transactions:l=[],categories:N=[],suppliers:c=[],customers:g=[],baseUrl:h="/PETRODIESEL2/public"}){const[p,d]=r.useState(null),[a,b]=r.useState(null),[o,x]=r.useState(null),[v,m]=r.useState(null),[k,_]=r.useState("all"),[D,n]=r.useState("all"),[s,y]=r.useState("all"),[V,ce]=r.useState("all"),[Ve,Je]=r.useState(""),[Ye,Ge]=r.useState(""),[S,de]=r.useState({open:!1,type:null}),[B,J]=r.useState(null),[q,U]=r.useState(!1),[E,$]=r.useState({name:"",account_number:"",balance:0}),xe=t=>{J(t),U(!1),$({name:t.name,account_number:t.account_number||"",balance:t.balance})},me=async t=>{t.preventDefault();const j=S.type==="banks",F=q?j?`${window.BASE_URL||""}/finance/createBank`:`${window.BASE_URL||""}/finance/createSafe`:j?`${window.BASE_URL||""}/finance/updateBank`:`${window.BASE_URL||""}/finance/updateSafe`,C=new FormData;C.append("id",(B==null?void 0:B.id)||""),C.append("name",E.name),j&&C.append("account_number",E.account_number),q&&C.append("balance",E.balance);try{const G=await(await fetch(F,{method:"POST",body:C,headers:{"X-Requested-With":"XMLHttpRequest"}})).json();G.success?window.location.reload():alert("فشلت العملية: "+G.message)}catch(z){console.error(z),alert("حدث خطأ في الاتصال")}},he=async t=>{if(!confirm("هل أنت متأكد من الحذف؟ لا يمكن التراجع عن هذا الإجراء."))return;const F=S.type==="banks"?`${window.BASE_URL||""}/finance/deleteBank`:`${window.BASE_URL||""}/finance/deleteSafe`,C=new FormData;C.append("id",t);try{(await(await fetch(F,{method:"POST",body:C,headers:{"X-Requested-With":"XMLHttpRequest"}})).json()).success?window.location.reload():alert("فشل الحذف")}catch{alert("حدث خطأ")}},T=()=>{d(null),b(null),x(null)},ue=t=>{if(t.related_entity_type==="sales"){window.location.href=`${window.BASE_URL||""}/sales/edit?id=${t.related_entity_id}`;return}m(t),d("edit_transaction")},pe=async t=>{if(confirm("هل أنت متأكد من حذف هذه العملية؟ سيتم عكس التأثير المالي على الخزنة/البنك."))try{const j=new FormData;j.append("id",t.id);const C=await(await fetch(`${window.BASE_URL||""}/finance/deleteTransaction`,{method:"POST",body:j,headers:{"X-Requested-With":"XMLHttpRequest"}})).json();C.success?window.location.reload():alert(C.message||"فشل الحذف")}catch(j){console.error(j),alert("حدث خطأ")}};f.reduce((t,j)=>t+parseFloat(j.balance||0),0),i.reduce((t,j)=>t+parseFloat(j.balance||0),0);const[Ke,X]=r.useState([]),[be,Z]=r.useState(!1),[Qe,Y]=r.useState(!1);_e.useEffect(()=>{s!=="all"?fe():(X([]),Y(!1))},[s,D]);const fe=async()=>{Z(!0),Y(!1);try{const t=D==="banks"?`${window.BASE_URL||""}/finance/getBankDetails?id=${s}`:`${window.BASE_URL||""}/finance/getSafeDetails?id=${s}`,F=await(await fetch(t)).json();F.success&&F.transactions?X(F.transactions):X([])}catch(t){console.error("Error fetching account details:",t),X([])}finally{Z(!1),Y(!0)}},ee=l,te=i.reduce((t,j)=>t+parseFloat(j.balance||0),0),se=f.reduce((t,j)=>t+parseFloat(j.balance||0),0),ge=te+se,je=te.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),we=se.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),Ne=ge.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),ve={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},A={hidden:{y:20,opacity:0},visible:{y:0,opacity:1,transition:{type:"spring",stiffness:300,damping:24}}};return e.jsxs(w.div,{initial:"hidden",animate:"visible",variants:ve,className:"w-full min-h-screen bg-slate-50 p-8 font-cairo space-y-10",style:{fontFamily:"'Cairo', sans-serif"},children:[e.jsx(Ue,{isOpen:p==="income"||p==="expense",onClose:T,type:p==="income"?"income":"expense",categories:N,safes:f,banks:i,suppliers:c,customers:g,baseUrl:h}),e.jsx(Le,{isOpen:p==="add-safe"||p==="add-bank",onClose:T,type:p==="add-safe"?"safe":"bank"}),e.jsx(ze,{isOpen:p==="transfer",onClose:T,safes:f,banks:i}),e.jsx(Ie,{isOpen:p==="reports",onClose:T}),e.jsx(He,{isOpen:p==="bank-details",onClose:T,bankId:a}),e.jsx(We,{isOpen:p==="safe-details",onClose:T,safeId:o}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(w.div,{variants:A,className:"relative rounded-2xl border bg-white border-slate-100 p-6 overflow-hidden",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 rounded-xl bg-indigo-50 text-indigo-600",children:e.jsx(O,{className:"w-5 h-5"})}),e.jsx("h3",{className:"text-slate-700 text-sm font-bold",children:"الأرصدة البنكية"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"text-xl font-bold font-mono text-slate-800",children:[je," ",e.jsx("span",{className:"text-xs text-slate-500 font-sans",children:"ر.س"})]})})]})}),e.jsx(w.div,{variants:A,className:"relative rounded-2xl border bg-white border-slate-100 p-6 overflow-hidden",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 rounded-xl bg-blue-50 text-blue-600",children:e.jsx(P,{className:"w-5 h-5"})}),e.jsx("h3",{className:"text-slate-700 text-sm font-bold",children:"النقد في الخزائن"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"text-xl font-bold font-mono text-slate-800",children:[we," ",e.jsx("span",{className:"text-xs text-slate-500 font-sans",children:"ر.س"})]})})]})}),e.jsxs(w.div,{variants:A,className:"rounded-2xl p-6 shadow-xl shadow-emerald-900/20 flex items-center justify-between bg-gradient-to-br from-emerald-600 via-emerald-700 to-emerald-900 text-white relative overflow-hidden",children:[e.jsx(w.div,{className:"absolute top-0 right-0 w-40 h-40 bg-white/20 rounded-full blur-3xl -mr-16 -mt-16",animate:{opacity:[.2,.4,.2]},transition:{duration:4,repeat:1/0}}),e.jsxs("div",{className:"relative z-10 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(De,{className:"w-5 h-5 text-emerald-50"})}),e.jsx("h3",{className:"text-emerald-50 text-sm font-medium opacity-90",children:"إجمالي الأصول المالية"})]}),e.jsxs("div",{className:"relative z-10 flex items-baseline gap-1.5",children:[e.jsx("div",{className:"text-2xl font-bold font-mono tracking-tight",children:Ne}),e.jsx("span",{className:"text-sm opacity-80 font-sans",children:"ر.س"})]})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{title:"إضافة إيراد",icon:Me,color:"emerald",action:"income",subtitle:"تسجيل مبيعات"},{title:"تسجيل منصرف",icon:qe,color:"rose",action:"expense",subtitle:"تسجيل مصروفات"},{title:"تحويل أرصدة",icon:R,color:"blue",action:"transfer",subtitle:"بين الخزائن والبنوك"}].map((t,j)=>e.jsxs(w.button,{variants:A,onClick:()=>d(t.action),className:`
                            bg-white p-4 rounded-xl shadow-sm border border-slate-100 
                            hover:shadow-lg hover:border-${t.color}-200 hover:-translate-y-1 
                            transition-all flex flex-col items-center justify-center gap-3 group cursor-pointer
                        `,children:[e.jsx("div",{className:`
                            p-2.5 rounded-full bg-${t.color}-50 text-${t.color}-600 
                            group-hover:bg-${t.color}-600 group-hover:text-white transition-colors
                        `,children:e.jsx(t.icon,{className:"w-4 h-4"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold text-slate-800 text-sm group-hover:text-${item.color}-700",children:t.title}),e.jsx("div",{className:"text-[10px] text-slate-400 mt-0.5",children:t.subtitle})]})]},j))}),e.jsx("div",{className:"w-full",children:e.jsxs(w.div,{variants:A,className:"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden flex flex-col",children:[e.jsx("div",{className:"p-5 border-b border-slate-50 flex justify-between items-center",children:e.jsx("h3",{className:"font-bold text-base text-slate-800",children:"العمليات الأخيرة"})}),e.jsxs("div",{className:"flex-1 overflow-x-auto relative min-h-[200px]",children:[be&&e.jsx("div",{className:"absolute inset-0 bg-white/60 backdrop-blur-[1px] z-10 flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin"}),e.jsx("span",{className:"text-xs font-bold text-indigo-600",children:"جاري تحميل المعاملات..."})]})}),e.jsxs("table",{className:"w-full text-right",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 text-xs font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 text-right",children:"التاريخ"}),e.jsx("th",{className:"p-4 text-right",children:"الوصف"}),e.jsx("th",{className:"p-4 text-right",children:"المستفيد"}),e.jsx("th",{className:"p-4 text-left text-emerald-600",children:"وارد"}),e.jsx("th",{className:"p-4 text-left text-rose-600",children:"منصرف"}),e.jsx("th",{className:"p-4 text-left",children:"الإجمالي"}),e.jsx("th",{className:"p-4 text-center",children:"الإجراء"})]})}),e.jsxs("tbody",{children:[ee.map((t,j)=>e.jsxs("tr",{className:"border-b border-slate-50 hover:bg-slate-50/50 transition-colors",children:[e.jsx("td",{className:"p-4 text-slate-500 font-mono text-sm",children:t.date}),e.jsxs("td",{className:"p-4 font-medium text-slate-700",children:[e.jsx("div",{children:t.description}),t.reference_number&&e.jsxs("div",{className:"text-[10px] text-blue-500 font-bold mt-0.5 px-1.5 py-0.5 bg-blue-50 rounded inline-block",children:["رقم العملية: ",t.reference_number]})]}),e.jsx("td",{className:"p-4 text-slate-600 text-sm",children:t.user_name||t.related_entity_type||"-"}),e.jsx("td",{className:"p-4 text-left font-mono font-bold text-emerald-600",dir:"ltr",children:t.type==="income"?parseFloat(t.amount).toLocaleString("en-US",{minimumFractionDigits:2}):"-"}),e.jsx("td",{className:"p-4 text-left font-mono font-bold text-rose-600",dir:"ltr",children:t.type==="expense"?parseFloat(t.amount).toLocaleString("en-US",{minimumFractionDigits:2}):"-"}),e.jsx("td",{className:"p-4 text-left font-mono font-bold text-slate-700",dir:"ltr",children:parseFloat(t.amount).toLocaleString("en-US",{minimumFractionDigits:2})}),e.jsxs("td",{className:"p-4 flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>ue(t),className:"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"تعديل",children:e.jsx(ae,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>pe(t),className:"p-2 text-slate-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"حذف",children:e.jsx(I,{className:"w-4 h-4"})})]})]},j)),ee.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-12 text-center text-slate-400",children:"لا توجد عمليات مسجلة"})})]})]})]})]})}),S.open&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${S.type==="banks"?"bg-indigo-100 text-indigo-600":"bg-blue-100 text-blue-600"}`,children:S.type==="banks"?e.jsx(O,{className:"w-6 h-6"}):e.jsx(P,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsxs(Ce,{children:["إدارة ",S.type==="banks"?"البنوك والمصارف":"الخزائن النقدية"]}),e.jsx(Ee,{className:"text-xs",children:"إضافة وتعديل وحذف الحسابات"})]})]}),e.jsx("button",{onClick:()=>de({open:!1,type:null}),className:"p-2 hover:bg-slate-200 rounded-full transition-colors text-slate-500",children:e.jsx(L,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto flex-1",children:q||B?e.jsxs("form",{onSubmit:me,className:"space-y-4 bg-slate-50 p-6 rounded-xl border border-slate-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"font-bold text-slate-800",children:q?"إضافة حساب جديد":"تعديل الحساب"}),e.jsx("button",{type:"button",onClick:()=>{U(!1),J(null)},className:"text-slate-400 hover:text-slate-600",children:e.jsx(L,{className:"w-4 h-4"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["اسم الحساب ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,className:"w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none",value:E.name,onChange:t=>$({...E,name:t.target.value}),placeholder:"مثلاً: بنك الراجحي"})]}),S.type==="banks"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"رقم الحساب / IBAN"}),e.jsx("input",{type:"text",className:"w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-mono",value:E.account_number,onChange:t=>$({...E,account_number:t.target.value}),placeholder:"SA..."})]}),q&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"الرصيد الافتتاحي"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none",value:E.balance,onChange:t=>$({...E,balance:t.target.value})})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx("button",{type:"button",onClick:()=>{U(!1),J(null)},className:"px-4 py-2 text-slate-600 font-bold hover:bg-slate-200 rounded-lg",children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"px-6 py-2 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 shadow-lg shadow-indigo-200",children:[e.jsx(W,{className:"w-4 h-4 inline-block ml-2"}),"حفظ"]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"text-sm text-slate-500 font-bold",children:["عدد الحسابات: ",(S.type==="banks"?i:f).length]}),e.jsxs("button",{onClick:()=>{U(!0),$({name:"",account_number:"",balance:0})},className:"flex items-center gap-2 text-sm font-bold text-white bg-indigo-600 px-4 py-2 rounded-lg hover:bg-indigo-700 shadow-lg shadow-indigo-200 transition-all hover:-translate-y-0.5",children:[e.jsx(Pe,{className:"w-4 h-4"})," إضافة حساب جديد"]})]}),e.jsx("div",{className:"border rounded-xl overflow-hidden",children:e.jsxs("table",{className:"w-full text-right",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 text-xs font-bold uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-5 py-3",children:"الاسم"}),S.type==="banks"&&e.jsx("th",{className:"px-5 py-3",children:"رقم الحساب"}),e.jsx("th",{className:"px-5 py-3",children:"الرصيد الحالي"}),e.jsx("th",{className:"px-5 py-3 text-left",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 bg-white",children:(S.type==="banks"?i:f).length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center py-8 text-slate-400",children:"لا توجد حسابات مضافة حالياً"})}):(S.type==="banks"?i:f).map(t=>e.jsxs("tr",{className:"group hover:bg-slate-50 transition-colors",children:[e.jsxs("td",{className:"px-5 py-3 font-bold text-slate-700 flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${S.type==="banks"?"bg-indigo-100 text-indigo-600":"bg-blue-100 text-blue-600"}`,children:S.type==="banks"?e.jsx(O,{className:"w-4 h-4"}):e.jsx(P,{className:"w-4 h-4"})}),t.name]}),S.type==="banks"&&e.jsx("td",{className:"px-5 py-3 text-sm font-mono text-slate-500",children:t.account_number||"-"}),e.jsxs("td",{className:"px-5 py-3 font-mono font-bold text-emerald-600",dir:"ltr",children:[parseFloat(t.balance).toLocaleString("en-US",{minimumFractionDigits:2})," ",e.jsx("span",{className:"text-xs text-slate-400",children:"SAR"})]}),e.jsx("td",{className:"px-5 py-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2 opacity-50 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>xe(t),className:"p-1.5 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors border border-transparent hover:border-blue-100",title:"تعديل",children:e.jsx(ae,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>he(t.id),className:"p-1.5 text-rose-600 hover:bg-rose-50 rounded-lg transition-colors border border-transparent hover:border-rose-100",title:"حذف",children:e.jsx(I,{className:"w-4 h-4"})})]})})]},t.id))})]})}),e.jsxs("div",{className:"mt-4 p-3 bg-amber-50 border border-amber-100 rounded-lg flex gap-3 text-amber-800 text-sm",children:[e.jsx(le,{className:"w-5 h-5 shrink-0"}),e.jsx("p",{children:"تنبيه: حذف الحساب سيؤدي إلى فقدان سجله، ولكن المعاملات المرتبطة به قد تبقى في السجلات التاريخية. يفضل تعطيل الحساب بدلاً من حذفه إذا كان يحتوي على حركات مالية سابقة."})]})]})})]})}),p==="edit_transaction"&&e.jsx(Xe,{isOpen:!0,onClose:()=>d(null),transaction:v,onSuccess:()=>window.location.reload()})]})}export{ft as default};
