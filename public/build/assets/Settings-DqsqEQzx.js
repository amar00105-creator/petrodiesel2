import{c as W,r as p,j as e,a as A,m as _,t as c,b as V,S as re,F as G,G as B}from"./main-BZye3MWh.js";import{c as C,b as y,g as L,p as N,m as $,w as ne,o as ie,v as X,f as j,j as ce,k as de,l as E,q as oe,r as O,t as H}from"./Tracker-B3Wsk5ua.js";import xe from"./StationList-DKh-ET9X.js";import{P as K}from"./plus-CeiUBWS7.js";import{S as F}from"./shield-BA8HrkPo.js";import{S as z}from"./square-pen-DTQcLPwn.js";import{T as P}from"./trash-2-D_DkLkqJ.js";import{X as Y}from"./x-CpP_tiue.js";import{C as me}from"./check-CTS_TuQ9.js";import{S as q}from"./save-C_qR2yBp.js";import{C as he}from"./circle-alert-CMgrqVIW.js";import{B as Z}from"./building-2-B4W4HkxD.js";import{D as be}from"./database-Cd_PbMGh.js";import{D as pe}from"./download-CUXfZPiX.js";import"./DeleteConfirmationModal-CGMvXUfk.js";import"./search-CFPY5UOd.js";import"./map-pin-B-WJpv1d.js";import"./phone-s6QPuMec.js";import"./circle-check-big-CfJJ_WJ_.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],Q=W("server",ue);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],M=W("shield-check",je);function ge({roles:g=[],onSave:k,onDelete:h}){const[r,x]=p.useState(null),[l,i]=p.useState(!1),v=[{id:"sales.view",label:"عرض المبيعات"},{id:"sales.create",label:"إضافة مبيعات"},{id:"sales.edit",label:"تعديل المبيعات"},{id:"sales.delete",label:"حذف المبيعات"},{id:"purchases.view",label:"عرض المشتريات"},{id:"purchases.create",label:"إضافة مشتريات"},{id:"purchases.edit",label:"تعديل المشتريات"},{id:"purchases.delete",label:"حذف المشتريات"},{id:"inventory.view",label:"عرض المخزون"},{id:"inventory.create",label:"إضافة مخزون"},{id:"inventory.edit",label:"تعديل المخزون"},{id:"inventory.delete",label:"حذف المخزون"},{id:"finance.view",label:"عرض المالية"},{id:"finance.create",label:"إضافة مالية"},{id:"finance.edit",label:"تعديل المالية"},{id:"finance.delete",label:"حذف المالية"},{id:"hr.view",label:"عرض الموظفين"},{id:"hr.create",label:"إضافة موظفين"},{id:"hr.edit",label:"تعديل الموظفين"},{id:"hr.delete",label:"حذف الموظفين"},{id:"settings.view",label:"عرض الإعدادات"},{id:"settings.edit",label:"تعديل الإعدادات"},{id:"reports.view",label:"عرض التقارير"},{id:"reports.export",label:"تصدير التقارير"}],u=s=>{let b=[];try{b=typeof s.permissions=="string"?JSON.parse(s.permissions):s.permissions}catch{b=[]}const I=b.includes("*");x({...s,_permissions:new Set(b),isSuper:I}),i(!0)},d=()=>{x({id:null,name:"",description:"",_permissions:new Set,isSuper:!1}),i(!0)},S=s=>{if(r.isSuper)return;const b=new Set(r._permissions);b.has(s)?b.delete(s):b.add(s),x({...r,_permissions:b})},m=()=>{x(s=>({...s,isSuper:!s.isSuper,_permissions:s.isSuper?new Set:new Set(["*"])}))},a=()=>{if(!r.name){c.error("اسم الدور مطلوب");return}const s=r.isSuper?["*"]:Array.from(r._permissions);k({id:r.id,name:r.name,description:r.description,permissions:s}),i(!1)},[w,f]=p.useState({isOpen:!1,roleId:null,roleName:""}),T=s=>{f({isOpen:!0,roleId:s.id,roleName:s.name})},D=()=>{h&&w.roleId&&(h(w.roleId),f({isOpen:!1,roleId:null,roleName:""}),i(!1))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(C,{className:"rounded-2xl shadow-md ring-1 ring-slate-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx(y,{children:"أدوار النظام والصلاحيات"}),e.jsxs("button",{onClick:d,className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-bold text-sm hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"})," دور جديد"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:g.map(s=>e.jsxs("div",{className:"p-4 border border-slate-200 rounded-xl hover:shadow-md transition-shadow bg-white relative group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:`w-5 h-5 ${s.is_system==1?"text-amber-500":"text-blue-500"}`}),e.jsx("h3",{className:"font-bold text-lg text-slate-800",children:s.name})]}),e.jsxs("div",{className:"flex gap-2 opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>u(s),className:"p-1.5 text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors",title:"تعديل",children:e.jsx(z,{className:"w-4 h-4"})}),s.is_system!=1&&e.jsx("button",{onClick:()=>T(s),className:"p-1.5 text-red-600 bg-red-50 hover:bg-red-100 rounded-lg transition-colors",title:"حذف",children:e.jsx(P,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-sm text-slate-500 mb-4 h-10 line-clamp-2",children:s.description||"لا يوجد وصف"}),e.jsxs("div",{className:"flex justify-between items-center mt-2 pt-2 border-t border-slate-50",children:[e.jsx(L,{size:"xs",color:s.is_system==1?"amber":"slate",children:s.is_system==1?"نظام":"مخصص"}),e.jsxs("span",{className:"text-xs text-slate-400 font-mono",children:["ID: ",s.id]})]})]},s.id))})]}),e.jsx(A,{children:l&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm",children:e.jsxs(_.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-2xl shadow-xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50",children:[e.jsx(y,{children:r.id?"تعديل الدور":"إنشاء دور جديد"}),e.jsx("button",{onClick:()=>i(!1),className:"text-slate-400 hover:text-slate-600",children:e.jsx(Y,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"اسم الدور"}),e.jsx(N,{value:r.name,onChange:s=>x({...r,name:s.target.value}),placeholder:"مثال: مدير مبيعات"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"الوصف"}),e.jsx(N,{value:r.description,onChange:s=>x({...r,description:s.target.value}),placeholder:"وصف مختصر..."})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-amber-50 rounded-xl border border-amber-100",children:[e.jsx(F,{className:"w-6 h-6 text-amber-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-amber-900",children:"صلاحيات كاملة (Super Admin)"}),e.jsx("p",{className:"text-xs text-amber-700",children:"منح هذا الدور جميع الصلاحيات في النظام دون استثناء."})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:r.isSuper,onChange:m}),e.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-amber-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-amber-600"})]})]}),!r.isSuper&&e.jsxs("div",{className:"border border-slate-200 rounded-xl p-4 bg-slate-50/50",children:[e.jsxs("h4",{className:"font-bold text-slate-700 mb-3 flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4 text-slate-500"})," تحديد الصلاحيات الدقيقة"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:v.map(s=>{const b=r._permissions.has(s.id);return e.jsxs("div",{onClick:()=>S(s.id),className:`
                                                            cursor-pointer select-none px-3 py-2 rounded-lg border text-xs font-bold flex items-center gap-2 transition-all
                                                            ${b?"bg-blue-600 border-blue-600 text-white shadow-sm":"bg-white border-slate-200 text-slate-600 hover:border-blue-300 hover:bg-white"}
                                                        `,children:[e.jsx("div",{className:`w-4 h-4 rounded border flex items-center justify-center ${b?"bg-white/20 border-transparent":"border-slate-300"}`,children:b&&e.jsx(me,{className:"w-3 h-3 text-white"})}),s.label]},s.id)})})]})]}),e.jsxs("div",{className:"p-6 border-t border-slate-100 bg-slate-50 flex justify-between gap-3",children:[e.jsx("div",{children:r.id&&r.is_system!=1&&e.jsxs("button",{onClick:()=>T(r),className:"px-4 py-2 rounded-xl font-bold text-red-600 bg-red-50 hover:bg-red-100 transition-colors flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"})," حذف الدور"]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>i(!1),className:"px-6 py-2 rounded-xl font-bold text-slate-500 hover:bg-slate-200 transition-colors",children:"إلغاء"}),e.jsxs("button",{onClick:a,className:"px-8 py-2 rounded-xl font-bold bg-blue-600 text-white shadow-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"})," حفظ الدور"]})]})]})]})})}),e.jsx(A,{children:w.isOpen&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm",children:e.jsxs(_.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"p-6 text-center space-y-4",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(he,{className:"w-8 h-8 text-red-600"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800",children:"حذف الدور"}),e.jsxs("p",{className:"text-slate-500",children:["هل أنت متأكد من حذف الدور ",e.jsxs("span",{className:"font-bold text-slate-800",children:['"',w.roleName,'"']}),"؟",e.jsx("br",{}),"لا يمكن التراجع عن هذا الإجراء، وسيتم إزالة الصلاحيات من جميع المستخدمين المرتبطين به."]})]}),e.jsxs("div",{className:"p-6 bg-slate-50 flex gap-3 justify-center border-t border-slate-100",children:[e.jsx("button",{onClick:()=>f({isOpen:!1,roleId:null,roleName:""}),className:"px-6 py-2 rounded-xl font-bold text-slate-500 hover:bg-slate-200 transition-colors",children:"إلغاء"}),e.jsxs("button",{onClick:D,className:"px-6 py-2 rounded-xl font-bold bg-red-600 text-white shadow-lg hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"})," نعم، حذف"]})]})]})})})]})}function fe({users:g=[],roles:k=[],stations:h=[],onSave:r,onCreate:x}){const[l,i]=p.useState(null),[v,u]=p.useState(!1),d=a=>{const w=a.stations?a.stations.map(f=>String(f.id)):a.station_id?[String(a.station_id)]:[];i({...a,station_ids:w,mode:"edit"}),u(!0)},S=()=>{i({id:null,name:"",email:"",password:"",role_id:"",station_ids:[],status:"active",mode:"create"}),u(!0)},m=()=>{if(l){if(l.mode==="create"){if(!l.name||!l.email||!l.password){c.error("الاسم، البريد الإلكتروني، وكلمة المرور مطلوبة");return}x&&x(l)}else r(l);u(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(C,{className:"rounded-2xl shadow-md ring-1 ring-slate-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{children:"إدارة المستخدمين وتعيين الأدوار"}),e.jsxs(L,{color:"blue",children:[g.length," مستخدم"]})]}),e.jsxs("button",{onClick:S,className:"px-4 py-2 bg-emerald-600 text-white rounded-lg font-bold text-sm hover:bg-emerald-700 flex items-center gap-2 shadow-sm transition-all",children:[e.jsx(V,{className:"w-4 h-4"})," إضافة مستخدم جديد"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-right",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 text-xs uppercase font-bold border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"المستخدم"}),e.jsx("th",{className:"p-4",children:"البريد الإلكتروني"}),e.jsx("th",{className:"p-4",children:"المحطة (مكان العمل)"}),e.jsx("th",{className:"p-4",children:"الدور (الصلاحية)"}),e.jsx("th",{className:"p-4",children:"الحالة"}),e.jsx("th",{className:"p-4",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 text-sm",children:g.map(a=>{const w=a.role_name||(a.role==="super_admin"?"مدير عام (Legacy)":a.role),f=a.station_name||"عام / جميع المحطات";return e.jsxs("tr",{className:"hover:bg-slate-50/50 transition-colors",children:[e.jsxs("td",{className:"p-4 font-bold text-slate-800 flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold",children:a.name.charAt(0).toUpperCase()}),a.name]}),e.jsx("td",{className:"p-4 text-slate-500 font-mono",children:a.email}),e.jsx("td",{className:"p-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-lg text-xs font-bold ${a.station_id?"bg-sky-50 text-sky-700":"bg-purple-50 text-purple-700"}`,children:[e.jsx(Z,{className:"w-3 h-3"}),f]})}),e.jsx("td",{className:"p-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-lg text-xs font-bold ${a.role_id?"bg-emerald-50 text-emerald-700":"bg-slate-100 text-slate-600"}`,children:[e.jsx(M,{className:"w-3 h-3"}),w]})}),e.jsx("td",{className:"p-4",children:e.jsx(L,{size:"xs",color:a.status==="active"?"emerald":"red",children:a.status==="active"?"نشط":"غير نشط"})}),e.jsx("td",{className:"p-4",children:e.jsx("button",{onClick:()=>d(a),className:"p-2 text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors",children:e.jsx(z,{className:"w-4 h-4"})})})]},a.id)})})]})})]}),e.jsx(A,{children:v&&l&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm",children:e.jsxs(_.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-2xl shadow-xl w-full max-w-lg overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center",children:e.jsx(V,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(y,{children:l.mode==="create"?"إضافة مستخدم جديد":l.name}),e.jsx($,{className:"text-xs",children:l.mode==="create"?"أدخل بيانات المستخدم الجديد":l.email})]})]}),e.jsx("button",{onClick:()=>u(!1),className:"text-slate-400 hover:text-slate-600",children:e.jsx(Y,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[l.mode==="create"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"اسم المستخدم"}),e.jsx(N,{value:l.name,onChange:a=>i({...l,name:a.target.value}),placeholder:"الاسم الكامل"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"البريد الإلكتروني"}),e.jsx(N,{value:l.email,onChange:a=>i({...l,email:a.target.value}),placeholder:"example@email.com"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"كلمة المرور (Secret)"}),e.jsx(N,{type:"password",value:l.password,onChange:a=>i({...l,password:a.target.value}),placeholder:"********"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"مناطق العمل (المحطات)"}),e.jsx(ne,{value:l.station_ids||[],onValueChange:a=>i({...l,station_ids:a}),placeholder:"اختر المحطات...",children:h.map(a=>e.jsx(ie,{value:String(a.id),children:a.name},a.id))}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"تحديد المحطة يقيد وصول المستخدم لبيانات هذه المحطة فقط. تركه فارغاً يعني الوصول لجميع المحطات (إدارة مركزية)."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"الدور الوظيفي (الصلاحيات)"}),e.jsxs(X,{value:String(l.role_id||"0"),onValueChange:a=>i({...l,role_id:a==="0"?null:a}),children:[e.jsx(j,{value:"0",children:"غير محدد (صلاحيات افتراضية)"}),k.map(a=>e.jsx(j,{value:String(a.id),icon:M,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"حالة الحساب"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-3 border rounded-xl flex-1 hover:bg-emerald-50 peer-checked:border-emerald-500",children:[e.jsx("input",{type:"radio",name:"status",checked:l.status==="active",onChange:()=>i({...l,status:"active"}),className:"w-4 h-4 text-emerald-600"}),e.jsx("span",{className:"font-bold text-emerald-700",children:"نشط (Active)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-3 border rounded-xl flex-1 hover:bg-red-50",children:[e.jsx("input",{type:"radio",name:"status",checked:l.status==="inactive",onChange:()=>i({...l,status:"inactive"}),className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"font-bold text-red-700",children:"موقوف (Inactive)"})]})]})]})]}),e.jsxs("div",{className:"p-6 border-t border-slate-100 bg-slate-50 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>u(!1),className:"px-6 py-2 rounded-xl font-bold text-slate-500 hover:bg-slate-200 transition-colors",children:"إلغاء"}),e.jsxs("button",{onClick:m,className:"px-8 py-2 rounded-xl font-bold bg-blue-600 text-white shadow-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"})," حفظ التعديلات"]})]})]})})})]})}function Me({general:g={},fuel:k={},alerts:h={},roles:r=[],fuelTypes:x=[],stations:l=[],users:i=[]}){const[v,u]=p.useState(!1),[d,S]=p.useState(g),[m,a]=p.useState(x),[w,f]=p.useState(!1),[T,D]=p.useState(null);p.useEffect(()=>{S(g),a(x)},[g,x]);const s=(t,n)=>{S({...d,[t]:n})},b=async()=>{u(!0);try{const t=new FormData;t.append("section","general"),Object.entries(d).forEach(([n,o])=>t.append(n,o)),await fetch("/PETRODIESEL2/public/settings/update",{method:"POST",body:t}),c.success("تم حفظ الإعدادات العامة بنجاح"),setTimeout(()=>window.location.reload(),1e3)}catch{c.error("حدث خطأ أثناء الحفظ")}finally{u(!1)}},I=async t=>{try{const n=await fetch("/PETRODIESEL2/public/settings/save_fuel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok){const R=await n.text();throw console.error("Server Error:",R),new Error(`Server responded with ${n.status}`)}const o=await n.json();o.success?(c.success("تم حفظ نوع الوقود"),setTimeout(()=>window.location.reload(),500)):c.error(o.message)}catch(n){console.error(n),c.error("فشل حفظ البيانات: "+n.message)}},J=async t=>{if(confirm("هل أنت متأكد من حذف هذا النوع؟"))try{const n=await fetch("/PETRODIESEL2/public/settings/delete_fuel",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({id:t})});let o;const R=await n.text();try{o=JSON.parse(R)}catch{throw new Error("Server returned invalid JSON: "+R.substring(0,100))}if(!n.ok)throw new Error(o.message||`Server Error (${n.status})`);o.success?(c.success("تم الحذف بنجاح"),a(U=>U.filter(le=>le.id!==t))):c.error(o.message)}catch(n){console.error(n),c.error("فشل الحذف: "+n.message)}},ee=async t=>{try{const o=await(await fetch("/PETRODIESEL2/public/settings/save_role",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();o.success?(c.success("تم حفظ الدور بنجاح"),setTimeout(()=>window.location.reload(),500)):c.error(o.message)}catch{c.error("فشل حفظ الدور")}},se=async t=>{try{const o=await(await fetch("/PETRODIESEL2/public/settings/delete_role",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t})})).json();o.success?(c.success("تم حذف الدور بنجاح"),setTimeout(()=>window.location.reload(),500)):c.error(o.message)}catch{c.error("فشل حذف الدور")}},te=async t=>{try{const o=await(await fetch("/PETRODIESEL2/public/settings/save_user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();o.success?(c.success("تم تحديث بيانات المستخدم"),setTimeout(()=>window.location.reload(),500)):c.error(o.message)}catch{c.error("فشل تحديث المستخدم")}},ae=async t=>{try{const o=await(await fetch("/PETRODIESEL2/public/settings/create_user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();o.success?(c.success("تم إنشاء المستخدم بنجاح"),setTimeout(()=>window.location.reload(),500)):c.error(o.message)}catch{c.error("فشل إنشاء المستخدم")}};return e.jsxs(_.div,{initial:{opacity:0},animate:{opacity:1},className:"p-6 max-w-[1800px] mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-end mb-4",children:[e.jsx("div",{}),e.jsx("button",{onClick:b,disabled:v,className:"px-8 py-3 bg-emerald-600 text-white font-bold rounded-xl shadow-lg hover:bg-emerald-700 transition-all flex items-center gap-2",children:v?"جاري الحفظ...":e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-5 h-5"})," حفظ التغييرات"]})})]}),e.jsxs(ce,{children:[e.jsxs(de,{className:"mt-4 bg-white p-1 rounded-2xl shadow-sm ring-1 ring-slate-200 w-fit overflow-x-auto",children:[e.jsx(E,{icon:re,children:"عام"}),e.jsx(E,{icon:Z,children:"إدارة المحطات"}),e.jsx(E,{icon:G,children:"الوقود والأسعار"}),e.jsx(E,{icon:F,children:"الصلاحيات والأمان"}),e.jsx(E,{icon:Q,children:"النسخ الاحتياطي"})]}),e.jsxs(oe,{children:[e.jsx(O,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6",children:[e.jsxs(C,{className:"rounded-2xl shadow-md ring-1 ring-slate-100 p-6 space-y-6",children:[e.jsxs(y,{className:"mb-4 font-bold flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"})," بيانات المؤسسة"]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-bold text-slate-700 mb-1 block",children:"اسم المحطة"}),e.jsx(N,{value:d.station_name||"",onChange:t=>s("station_name",t.target.value),placeholder:"مثال: محطة بتروديزل",className:"rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-bold text-slate-700 mb-1 block",children:"رقم السجل التجاري"}),e.jsx(N,{value:d.cr_number||"",onChange:t=>s("cr_number",t.target.value),placeholder:"70XXXXXXXX",className:"rounded-xl font-mono"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-bold text-slate-700 mb-1 block",children:"الرقم الضريبي VAT"}),e.jsx(N,{value:d.vat_number||"",onChange:t=>s("vat_number",t.target.value),placeholder:"3XXXXXXXXXXXXX",className:"rounded-xl font-mono"})]})]}),e.jsxs(C,{className:"rounded-2xl shadow-md ring-1 ring-slate-100 p-6 space-y-6",children:[e.jsxs(y,{className:"mb-4 font-bold flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"})," اللغة والعملة"]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-bold text-slate-700 mb-1 block",children:"لغة النظام"}),e.jsxs(X,{value:d.language||"ar",onValueChange:t=>s("language",t),className:"rounded-xl",children:[e.jsx(j,{value:"ar",children:"العربية (Arabic)"}),e.jsx(j,{value:"en",children:"English (الإنجليزية)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-bold text-slate-700 mb-1 block",children:"العملة الأساسية"}),e.jsxs(X,{value:d.currency||"SAR",onValueChange:t=>s("currency",t),className:"rounded-xl",children:[e.jsx(j,{value:"SAR",children:"ريال سعودي (SAR)"}),e.jsx(j,{value:"USD",children:"دولار أمريكي (USD)"}),e.jsx(j,{value:"SDG",children:"جنيه سوداني (SDG)"})]})]}),d.currency!=="SAR"&&e.jsxs(_.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},children:[e.jsx("label",{className:"text-sm font-bold text-slate-700 mb-1 block",children:"سعر الصرف (مقابل SAR)"}),e.jsx(N,{type:"number",value:d.exchange_rate||"1.0",onChange:t=>s("exchange_rate",t.target.value),className:"rounded-xl font-mono"}),e.jsx($,{className:"text-xs text-slate-400 mt-1",children:"يستخدم للتقارير المحاسبية"})]})]}),e.jsxs(C,{className:"rounded-2xl shadow-md ring-1 ring-slate-100 p-6 space-y-6",children:[e.jsxs(y,{className:"mb-4 font-bold flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"})," إعدادات التشغيل"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-bold text-slate-700",children:"وضع الصيانة"}),e.jsx(H,{checked:d.maintenance_mode==="1",onChange:t=>s("maintenance_mode",t?"1":"0")})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-bold text-slate-700",children:"تفعيل الإشعارات"}),e.jsx(H,{checked:d.enable_notifications==="1",onChange:t=>s("enable_notifications",t?"1":"0")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-bold text-slate-700 mb-1 block",children:"القفل التلقائي (Auto Lock)"}),e.jsxs(X,{value:d.auto_lock_minutes||"0",onValueChange:t=>s("auto_lock_minutes",t),className:"rounded-xl",children:[e.jsx(j,{value:"0",children:"معطل (Disabled)"}),e.jsx(j,{value:"1",children:"دقيقة واحدة"}),e.jsx(j,{value:"2",children:"دقيقتان"}),e.jsx(j,{value:"5",children:"5 دقائق"}),e.jsx(j,{value:"10",children:"10 دقائق"})]})]})]})]})}),e.jsx(O,{children:e.jsx("div",{className:"mt-6",children:e.jsx(xe,{stations:l,users:i})})}),e.jsx(O,{children:e.jsx("div",{className:"mt-6 grid grid-cols-1 gap-6",children:e.jsxs(C,{className:"rounded-2xl shadow-md ring-1 ring-slate-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx(y,{children:"قائمة أنواع الوقود"}),e.jsxs("button",{onClick:()=>{D(null),f(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-bold text-sm hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"})," نوع جديد"]})]}),e.jsx("div",{className:"space-y-4",children:m.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 rounded-xl border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:t.color_hex+"20",color:t.color_hex},children:e.jsx(G,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-lg text-slate-700 block",children:t.name}),e.jsx("span",{className:"text-xs text-slate-400 font-sans",children:t.code})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-slate-400",children:"السعر الحالي"}),e.jsxs("p",{className:"font-bold font-mono text-lg text-navy-900",children:[t.price_per_liter," ",e.jsx("span",{className:"text-xs",children:d.currency||"SAR"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{D(t),f(!0)},className:"p-2 bg-white border border-slate-200 rounded-lg text-blue-600 hover:bg-blue-50 transition-all",children:e.jsx(z,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>J(t.id),className:"p-2 bg-white border border-slate-200 rounded-lg text-red-600 hover:bg-red-50 transition-all",children:e.jsx(P,{className:"w-4 h-4"})})]})]})]},t.id))})]})})}),e.jsx(O,{children:e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-8",children:[e.jsx(ge,{roles:r,onSave:ee,onDelete:se}),e.jsx(fe,{users:i,roles:r,stations:l,onSave:te,onCreate:ae})]})}),e.jsx(O,{children:e.jsx("div",{className:"mt-6 grid grid-cols-1 gap-6 text-center",children:e.jsxs(C,{className:"rounded-2xl shadow-md ring-1 ring-slate-100 py-12 flex flex-col items-center justify-center space-y-6 bg-slate-50/50",children:[e.jsx(be,{className:"w-20 h-20 text-slate-300"}),e.jsxs("div",{children:[e.jsx(y,{children:"النسخ الاحتياطي للنظام"}),e.jsx($,{className:"mt-2",children:"قم بتحميل نسخة كاملة من قاعدة البيانات للحفاظ على أمان بياناتك"})]}),e.jsxs("a",{href:"/PETRODIESEL2/public/settings/backup",target:"_blank",className:"px-6 py-3 bg-navy-900 text-white font-bold rounded-xl shadow-lg hover:bg-navy-800 transition-all flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5"}),"تحميل نسخة احتياطية (SQL)"]})]})})})]})]}),e.jsx(Ne,{isOpen:w,onClose:()=>f(!1),fuel:T,onSave:I})]})}function Ne({isOpen:g,onClose:k,fuel:h,onSave:r}){const[x,l]=p.useState(""),[i,v]=p.useState(""),[u,d]=p.useState("#64748b");p.useEffect(()=>{h?(l(h.name),v(h.price_per_liter),d(h.color_hex)):(l(""),v(""),d("#64748b"))},[h,g]);const S=m=>{m.preventDefault(),r({id:h==null?void 0:h.id,name:x,price_per_liter:i,color_hex:u}),k()};return g?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm",children:e.jsxs(_.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-2xl shadow-xl p-6 w-full max-w-md",children:[e.jsx(y,{className:"mb-4",children:h?"تعديل الوقود":"إضافة وقود جديد"}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"اسم الوقود"}),e.jsx(N,{value:x,onChange:m=>l(m.target.value),required:!0,placeholder:"مثال: بنزين 98"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"السعر (لكل لتر)"}),e.jsx(N,{type:"number",step:"0.01",value:i,onChange:m=>v(m.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"لون التمييز"}),e.jsx("div",{className:"flex gap-2",children:["#64748b","#ef4444","#f97316","#f59e0b","#10b981","#3b82f6","#8b5cf6","#ec4899"].map(m=>e.jsx("button",{type:"button",onClick:()=>d(m),className:`w-8 h-8 rounded-full border-2 ${u===m?"border-navy-900 scale-110":"border-transparent"}`,style:{backgroundColor:m}},m))})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:k,className:"flex-1 py-2 text-slate-500 font-bold hover:bg-slate-100 rounded-lg",children:"إلغاء"}),e.jsx("button",{type:"submit",className:"flex-1 py-2 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700",children:"حفظ"})]})]})]})}):null}export{Me as default};
