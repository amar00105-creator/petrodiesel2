import{j as e,a2 as v,X as O,ag as y,h as D,t as p,c as w,K as C,x as q,T as B,r as G,k as $}from"./ui-DtuMUTb1.js";import{r as l,R as K}from"./vendor-BdFMDtQB.js";import{n as A,d as M,D as X,G as H,g as E}from"./main-D8tG-o71.js";import{A as J}from"./AddSupplierModal-DTKhIRkU.js";function Q({isOpen:m,onClose:i,supplier:c,onSuccess:t}){const[n,f]=l.useState({id:"",name:"",phone:""}),[b,h]=l.useState(!1);l.useEffect(()=>{c&&f({id:c.id||"",name:c.name||"",phone:c.phone||""})},[c]);const g=a=>{const{name:r,value:o}=a.target;f(d=>({...d,[r]:o}))},u=async a=>{a.preventDefault(),h(!0);const r=new FormData;r.append("id",n.id),r.append("name",n.name),r.append("phone",n.phone);let o=!1;try{const x=await(await fetch("/PETRODIESEL2/public/suppliers/update_ajax",{method:"POST",headers:{Accept:"application/json"},body:r})).json();x.success?(p.success("تم تحديث المورد بنجاح"),o=!0):p.error(x.message||"حدث خطأ أثناء التحديث")}catch(d){console.error("Update Request Error:",d),p.error("فشل الاتصال بالخادم")}finally{h(!1)}if(o)try{t({...c,name:n.name,phone:n.phone}),i()}catch(d){console.error("Error updating UI state:",d)}};return e.jsx(A,{open:m,onClose:i,static:!0,className:"z-[100]",children:e.jsxs(M,{className:"max-w-md w-full bg-white rounded-2xl shadow-2xl ring-1 ring-slate-900/5 p-0 overflow-hidden dark:bg-[#1e293b] dark:ring-white/10 dark:shadow-none",children:[e.jsxs("div",{className:"bg-slate-50 border-b border-slate-100 p-6 flex justify-between items-center dark:bg-white/5 dark:border-white/10",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-800 flex items-center gap-2 dark:text-white",children:[e.jsx(v,{className:"w-5 h-5 text-navy-900 dark:text-blue-400"}),"تعديل بيانات المورد"]}),e.jsx("p",{className:"text-slate-500 text-sm dark:text-slate-400",children:"تعديل الاسم أو الهاتف"})]}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-slate-200 rounded-full transition-colors text-slate-500 dark:hover:bg-white/10 dark:text-slate-400",children:e.jsx(O,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:u,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"اسم المورد"}),e.jsxs("div",{className:"relative",children:[e.jsx(v,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("input",{type:"text",name:"name",value:n.name,onChange:g,placeholder:"اسم المورد",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-navy-500 transition-all dark:bg-slate-800 dark:border-slate-700 dark:text-white dark:placeholder-slate-500",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"رقم الهاتف"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("input",{type:"text",name:"phone",value:n.phone,onChange:g,placeholder:"05xxxxxxxx",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-navy-500 transition-all dark:bg-slate-800 dark:border-slate-700 dark:text-white dark:placeholder-slate-500"})]})]}),e.jsxs("div",{className:"flex justify-end pt-4",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-50 rounded-lg transition-colors ml-2 dark:text-slate-400 dark:hover:bg-white/5",children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:b,className:"px-6 py-2 text-sm font-bold text-white bg-navy-900 hover:bg-navy-800 rounded-lg shadow-lg hover:shadow-xl transition-all flex items-center gap-2",children:b?"جاري الحفظ...":e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4"}),"حفظ التغييرات"]})})]})]})]})})}function V({isOpen:m,onClose:i,onSuccess:c}){const[t,n]=l.useState({name:"",phone:"",address:"",notes:""}),[f,b]=l.useState(!1),h=u=>{const{name:a,value:r}=u.target;n(o=>({...o,[a]:r}))},g=async u=>{u.preventDefault(),b(!0);const a=new FormData;a.append("name",t.name),a.append("phone",t.phone),a.append("address",t.address),a.append("notes",t.notes);try{const o=await(await fetch("/PETRODIESEL2/public/hr/api?entity=customer&action=store",{method:"POST",body:a})).json();if(o.success){p.custom(x=>e.jsxs("div",{className:"flex items-center gap-4 bg-emerald-50 border border-emerald-100 p-4 rounded-2xl shadow-xl w-full",children:[e.jsx("div",{className:"p-2 bg-emerald-500 rounded-full text-white animate-pulse",children:e.jsx(w,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-emerald-900 font-bold",children:"تم حفظ العميل الجديد!"}),e.jsxs("p",{className:"text-emerald-700 text-sm",children:["تم إضافة ",t.name," إلى القائمة بنجاح"]})]})]}),{duration:4e3});const d={id:o.id,...t};c(d),i(),n({name:"",phone:"",address:"",notes:""})}else p.error(o.message||"حدث خطأ أثناء الإضافة")}catch{p.error("فشل الاتصال بالخادم")}finally{b(!1)}};return e.jsx(A,{open:m,onClose:i,static:!0,className:"z-[100]",children:e.jsxs(M,{className:"max-w-md w-full bg-white rounded-2xl shadow-2xl ring-1 ring-slate-900/5 p-0 overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-50 border-b border-slate-100 p-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5 text-indigo-600"}),"إضافة عميل جديد"]}),e.jsx("p",{className:"text-slate-500 text-sm",children:"أدخل بيانات العميل"})]}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-slate-200 rounded-full transition-colors text-slate-500",children:e.jsx(O,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:g,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"اسم العميل"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("input",{type:"text",name:"name",value:t.name,onChange:h,placeholder:"الاسم الكامل",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"رقم الهاتف"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("input",{type:"text",name:"phone",value:t.phone,onChange:h,placeholder:"05xxxxxxxx",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"العنوان"}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("input",{type:"text",name:"address",value:t.address,onChange:h,placeholder:"المدينة، الحي...",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"ملاحظات"}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("textarea",{name:"notes",value:t.notes,onChange:h,placeholder:"ملاحظات إضافية...",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all min-h-[80px]"})]})]}),e.jsxs("div",{className:"flex justify-end pt-4",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-50 rounded-lg transition-colors ml-2",children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:f,className:"px-6 py-2 text-sm font-bold text-white bg-navy-900 hover:bg-navy-800 rounded-lg shadow-lg hover:shadow-xl transition-all flex items-center gap-2",children:f?"جاري الحفظ...":e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4"}),"حفظ"]})})]})]})]})})}function W({suppliers:m=[],hideHeader:i=!1}){const[c,t]=l.useState(Array.isArray(m)?m:[]);K.useEffect(()=>{t(Array.isArray(m)?m:[])},[m]);const[n,f]=l.useState(!1),[b,h]=l.useState(!1),[g,u]=l.useState(!1),[a,r]=l.useState(null),[o,d]=l.useState(!1),[x,S]=l.useState(null),[I,k]=l.useState(!1),T=s=>{r(s),u(!0)},P=s=>{t(N=>N.map(j=>j.id==s.id?{...j,...s}:j)),u(!1)},F=s=>{S(s),d(!0)},L=async()=>{if(!x)return;k(!0);const s=new FormData;s.append("id",x.id);try{const j=await(await fetch("/PETRODIESEL2/public/suppliers/delete_ajax",{method:"POST",body:s})).json();j.success?(p.success("تم حذف المورد بنجاح"),t(z=>z.filter(U=>U.id!==x.id))):p.error(j.message||"فشل الحذف")}catch{p.error("خطأ في الاتصال")}finally{k(!1),d(!1),S(null)}},R=[{header:"اسم المنشأة / المورد",accessor:"name",render:s=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-slate-100 rounded-lg text-slate-500 dark:bg-white/10 dark:text-slate-400",children:e.jsx(v,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-bold text-navy-900 dark:text-white",children:s.name})]})},{header:"رقم الهاتف",accessor:"phone",className:"font-mono text-slate-600 dark:text-slate-300",render:s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-3 h-3 text-slate-400"})," ",s.phone]})},{header:"العنوان",accessor:"address",className:"text-sm text-slate-500 dark:text-slate-400",render:s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-3 h-3 text-slate-400"})," ",s.address]})},{header:"نوع الخدمة",accessor:"type",render:s=>e.jsx(E,{size:"xs",color:"blue",icon:B,children:s.type})},{header:"الحالة",accessor:"status",render:s=>e.jsx(E,{size:"xs",color:s.status==="Active"?"emerald":"gray",children:s.status==="Active"?"نشط":"غير نشط"})}],_=s=>e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>T(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>F(s),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx($,{className:"w-4 h-4"})})]});return e.jsxs("div",{className:"p-6 max-w-[1800px] mx-auto space-y-6",children:[e.jsx(X,{isOpen:o,onClose:()=>d(!1),onConfirm:L,title:"تحذير: حذف مورد",message:`سيتم حذف المورد "${x==null?void 0:x.name}". هل أنت متأكد؟`,isDeleting:I}),e.jsx(H,{title:"الموردين والشركات",subtitle:"قائمة شركات التوريد والخدمات اللوجستية",data:c,columns:R,actions:_,onAdd:()=>f(!0),addButtonLabel:"إضافة مورد",searchPlaceholder:"بحث عن مورد...",exportName:"suppliers",hideHeader:i,hideFilters:!0}),e.jsx(J,{isOpen:n,onClose:()=>f(!1),onSuccess:()=>window.location.reload()}),e.jsx(V,{isOpen:b,onClose:()=>h(!1),onSuccess:()=>{}}),e.jsx(Q,{isOpen:g,onClose:()=>u(!1),supplier:a,onSuccess:P})]})}const te=Object.freeze(Object.defineProperty({__proto__:null,default:W},Symbol.toStringTag,{value:"Module"}));export{V as A,W as S,te as a};
