import{j as e,af as k,X as E,c as D,ag as O,h as A,t as c,m as F,ae as T,r as q,k as z}from"./ui-DtuMUTb1.js";import{r as a,R as U}from"./vendor-BdFMDtQB.js";import{n as C,d as I,D as H,c as B,g as X}from"./main-D8tG-o71.js";function $({isOpen:d,onClose:l,onSuccess:i}){const[x,t]=a.useState({name:"",phone:""}),[u,m]=a.useState(!1),f=b=>{const{name:r,value:n}=b.target;t(o=>({...o,[r]:n}))},h=async b=>{b.preventDefault(),m(!0);const r=new FormData;r.append("name",x.name),r.append("phone",x.phone);try{const o=await(await fetch("/PETRODIESEL2/public/workers/create_ajax",{method:"POST",body:r})).json();o.success?(c.success("تم إضافة العامل بنجاح"),i(),l(),t({name:"",phone:""})):c.error(o.message||"حدث خطأ أثناء الإضافة")}catch{c.error("فشل الاتصال بالخادم")}finally{m(!1)}};return e.jsx(C,{open:d,onClose:l,static:!0,className:"z-[100]",children:e.jsxs(I,{className:"max-w-md w-full bg-white rounded-2xl shadow-2xl ring-1 ring-slate-900/5 p-0 overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-50 border-b border-slate-100 p-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-navy-900"}),"إضافة عامل جديد"]}),e.jsx("p",{className:"text-slate-500 text-sm",children:"أدخل بيانات العامل الجديد"})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-slate-200 rounded-full transition-colors text-slate-500",children:e.jsx(E,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:h,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"الاسم"}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("input",{type:"text",name:"name",value:x.name,onChange:f,placeholder:"اسم العامل",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-navy-500 transition-all",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"رقم الهاتف"}),e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("input",{type:"text",name:"phone",value:x.phone,onChange:f,placeholder:"05xxxxxxxx",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-navy-500 transition-all"})]})]}),e.jsxs("div",{className:"flex justify-end pt-4",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-50 rounded-lg transition-colors ml-2",children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:u,className:"px-6 py-2 text-sm font-bold text-white bg-navy-900 hover:bg-navy-800 rounded-lg shadow-lg hover:shadow-xl transition-all flex items-center gap-2",children:u?"جاري الحفظ...":e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4"}),"حفظ"]})})]})]})]})})}function G({isOpen:d,onClose:l,worker:i,onSuccess:x}){const[t,u]=a.useState({id:"",name:"",phone:""}),[m,f]=a.useState(!1);a.useEffect(()=>{i&&u({id:i.id||"",name:i.name||"",phone:i.phone||""})},[i]);const h=r=>{const{name:n,value:o}=r.target;u(p=>({...p,[n]:o}))},b=async r=>{r.preventDefault(),f(!0);const n=new FormData;n.append("id",t.id),n.append("name",t.name),n.append("phone",t.phone);let o=!1;try{const N=await(await fetch("/PETRODIESEL2/public/workers/update_ajax",{method:"POST",body:n})).json();N.success?(c.success("تم تحديث بيانات العامل بنجاح"),o=!0):c.error(N.message||"حدث خطأ أثناء التحديث")}catch(p){console.error("Update Request Error:",p),c.error("فشل الاتصال بالخادم")}finally{f(!1)}if(o)try{x({...i,name:t.name,phone:t.phone}),l()}catch(p){console.error("Error updating UI state:",p)}};return e.jsx(C,{open:d,onClose:l,static:!0,className:"z-[100]",children:e.jsxs(I,{className:"max-w-md w-full bg-white rounded-2xl shadow-2xl ring-1 ring-slate-900/5 p-0 overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-50 border-b border-slate-100 p-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-navy-900"}),"تعديل بيانات العامل"]}),e.jsx("p",{className:"text-slate-500 text-sm",children:"تعديل اسم أو رقم العامل"})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-slate-200 rounded-full transition-colors text-slate-500",children:e.jsx(E,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:b,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"الاسم"}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("input",{type:"text",name:"name",value:t.name,onChange:h,placeholder:"اسم العامل",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-navy-500 transition-all",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"رقم الهاتف"}),e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("input",{type:"text",name:"phone",value:t.phone,onChange:h,placeholder:"05xxxxxxxx",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-navy-500 transition-all"})]})]}),e.jsxs("div",{className:"flex justify-end pt-4",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-50 rounded-lg transition-colors ml-2",children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:m,className:"px-6 py-2 text-sm font-bold text-white bg-navy-900 hover:bg-navy-800 rounded-lg shadow-lg hover:shadow-xl transition-all flex items-center gap-2",children:m?"جاري الحفظ...":e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4"}),"حفظ التغييرات"]})})]})]})]})})}const Y=a.forwardRef(({workers:d=[],search:l=""},i)=>{const[x,t]=a.useState(Array.isArray(d)?d:[]);U.useEffect(()=>{t(Array.isArray(d)?d:[])},[d]);const[u,m]=a.useState(!1),[f,h]=a.useState(!1),[b,r]=a.useState(null);a.useImperativeHandle(i,()=>({openAddModal:()=>m(!0)}));const n=s=>{r(s),h(!0)},o=s=>{t(y=>y.map(g=>g.id==s.id?{...g,...s}:g)),h(!1)},p=()=>{window.location.reload()},[N,v]=a.useState(!1),[j,w]=a.useState(null),[M,S]=a.useState(!1),L=s=>{w(s),v(!0)},P=async()=>{if(!j)return;S(!0);const s=new FormData;s.append("id",j.id);try{const g=await(await fetch("/PETRODIESEL2/public/workers/delete_ajax",{method:"POST",body:s})).json();g.success?(c.success("تم حذف العامل بنجاح"),t(W=>W.filter(_=>_.id!==j.id))):c.error(g.message||"فشل الحذف")}catch{c.error("خطأ في الاتصال")}finally{S(!1),v(!1),w(null)}},R=(x||[]).map(s=>({id:s.id,name:s.name,phone:s.phone||"N/A",national_id:s.national_id||s.iqama_id||"N/A",status:s.status?"Active":"On Leave",station:s.station_name||"Main Station"})).filter(s=>s.name.toLowerCase().includes(l.toLowerCase())||s.phone.includes(l));return e.jsxs(F.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-6",children:[e.jsx(H,{isOpen:N,onClose:()=>v(!1),onConfirm:P,title:"تحذير: حذف عامل",message:`سيتم حذف العامل "${j==null?void 0:j.name}". هل أنت متأكد؟ لا يمكن التراجع عن هذا الإجراء.`,isDeleting:M}),e.jsx(B,{className:"rounded-2xl shadow-lg ring-1 ring-slate-200 overflow-hidden p-0 dark:bg-white/5 dark:backdrop-blur-md dark:border-white/10 dark:ring-white/10",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-right",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-200 dark:bg-white/5 dark:border-white/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 text-sm font-bold text-slate-600 dark:text-slate-300",children:"الاسم"}),e.jsx("th",{className:"p-4 text-sm font-bold text-slate-600 dark:text-slate-300",children:"رقم الجوال"}),e.jsx("th",{className:"p-4 text-sm font-bold text-slate-600 dark:text-slate-300",children:"الهوية الوطنية / الإقامة"}),e.jsx("th",{className:"p-4 text-sm font-bold text-slate-600 dark:text-slate-300",children:"الحالة"}),e.jsx("th",{className:"p-4 text-sm font-bold text-slate-600 dark:text-slate-300",children:"المحطة"}),e.jsx("th",{className:"p-4 text-sm font-bold text-slate-600 dark:text-slate-300 text-center",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-white/5",children:R.map(s=>e.jsxs("tr",{className:"hover:bg-blue-50/30 dark:hover:bg-white/5 transition-colors group",children:[e.jsxs("td",{className:"p-4 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-slate-100 dark:bg-white/10 rounded-full text-slate-500 dark:text-slate-300",children:e.jsx(T,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-bold text-navy-900 dark:text-white",children:s.name})]}),e.jsx("td",{className:"p-4 font-mono text-slate-600 dark:text-slate-400",children:s.phone}),e.jsx("td",{className:"p-4 font-mono text-slate-600 dark:text-slate-400",children:s.national_id}),e.jsx("td",{className:"p-4",children:e.jsx(X,{size:"xs",color:s.status==="Active"?"emerald":"amber",children:s.status==="Active"?"على رأس العمل":"إجازة"})}),e.jsx("td",{className:"p-4 text-slate-500 dark:text-slate-400",children:s.station}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex justify-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>n(s),className:"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-white/10 rounded-lg transition-colors",children:e.jsx(q,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>L(s),className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-500/10 rounded-lg transition-colors",children:e.jsx(z,{className:"w-4 h-4"})})]})})]},s.id))})]})})}),e.jsx($,{isOpen:u,onClose:()=>m(!1),onSuccess:p}),e.jsx(G,{isOpen:f,onClose:()=>h(!1),worker:b,onSuccess:o})]})});export{Y as default};
