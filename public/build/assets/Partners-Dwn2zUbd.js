import{j as e,c as A,X as F,ah as k,J as M,N as R,i as L,t as g,r as U,l as $,T as q,U as G,f as B,m as D}from"./ui-BNY7rm5N.js";import{r as o,R as H}from"./vendor-BdFMDtQB.js";import{n as z,d as J,D as X,G as _,j as K,k as Q,l as I}from"./main-CfCXs3Ia.js";import{A as P,S as V}from"./SupplierList-C_nPg_4H.js";import{A as W}from"./AddSupplierModal-B0pvIlWU.js";function Y({isOpen:x,onClose:n,customer:l,onSuccess:f}){const[t,r]=o.useState({id:"",name:"",phone:"",address:"",notes:""}),[p,j]=o.useState(!1);o.useEffect(()=>{l&&r({id:l.id||"",name:l.name||"",phone:l.phone||"",address:l.address||"",notes:l.notes||""})},[l]);const m=d=>{const{name:a,value:c}=d.target;r(i=>({...i,[a]:c}))},b=async d=>{d.preventDefault(),j(!0);const a=new FormData;a.append("id",t.id),a.append("name",t.name),a.append("phone",t.phone),a.append("address",t.address),a.append("notes",t.notes);let c=!1;try{const u=await(await fetch("/PETRODIESEL2/public/hr/api?entity=customer&action=update",{method:"POST",body:a})).json();u.success?(g.success("تم تحديث العميل بنجاح"),c=!0):g.error(u.message||"حدث خطأ أثناء التحديث")}catch(i){console.error("Update Request Error:",i),g.error("فشل الاتصال بالخادم")}finally{j(!1)}if(c)try{f({...l,name:t.name,phone:t.phone,address:t.address,notes:t.notes}),n()}catch(i){console.error("Error updating UI state:",i)}};return e.jsx(z,{open:x,onClose:n,static:!0,className:"z-[100]",children:e.jsxs(J,{className:"max-w-md w-full bg-white rounded-2xl shadow-2xl ring-1 ring-slate-900/5 p-0 overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-50 border-b border-slate-100 p-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-indigo-600"}),"تعديل بيانات العميل"]}),e.jsx("p",{className:"text-slate-500 text-sm",children:"تعديل معلومات العميل"})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-slate-200 rounded-full transition-colors text-slate-500",children:e.jsx(F,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:b,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"اسم العميل"}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("input",{type:"text",name:"name",value:t.name,onChange:m,placeholder:"الاسم الكامل",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"رقم الهاتف"}),e.jsxs("div",{className:"relative",children:[e.jsx(k,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("input",{type:"text",name:"phone",value:t.phone,onChange:m,placeholder:"05xxxxxxxx",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"العنوان"}),e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("input",{type:"text",name:"address",value:t.address,onChange:m,placeholder:"المدينة، الحي...",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"ملاحظات"}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("textarea",{name:"notes",value:t.notes,onChange:m,placeholder:"ملاحظات إضافية...",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all min-h-[80px]"})]})]}),e.jsxs("div",{className:"flex justify-end pt-4",children:[e.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-50 rounded-lg transition-colors ml-2",children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:p,className:"px-6 py-2 text-sm font-bold text-white bg-navy-900 hover:bg-navy-800 rounded-lg shadow-lg hover:shadow-xl transition-all flex items-center gap-2",children:p?"جاري الحفظ...":e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4"}),"حفظ التغييرات"]})})]})]})]})})}function Z({customers:x=[],onUpdate:n,hideHeader:l=!1}){const[f,t]=o.useState(!1),[r,p]=o.useState(!1),[j,m]=o.useState(null),[b,d]=o.useState(!1),[a,c]=o.useState(null),[i,u]=o.useState(!1),w=s=>{m(s),p(!0)},y=s=>{c(s),d(!0)},v=async()=>{if(!a)return;u(!0);const s=new FormData;s.append("id",a.id);try{const N=await(await fetch("/PETRODIESEL2/public/hr/api?entity=customer&action=delete",{method:"POST",body:s})).json();N.success?(g.success("تم حذف العميل بنجاح"),n?n(x.filter(T=>T.id!==a.id)):window.location.reload()):g.error(N.message||"فشل الحذف")}catch{g.error("خطأ في الاتصال")}finally{u(!1),d(!1),c(null)}},S=s=>{n?n([...x,s]):window.location.reload()},C=s=>{n?n(x.map(h=>h.id==s.id?{...h,...s}:h)):window.location.reload()},O=[{header:"اسم العميل",accessor:"name",render:s=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg text-indigo-600",children:e.jsx(A,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-bold text-navy-900",children:s.name})]})},{header:"رقم الهاتف",accessor:"phone",className:"font-mono text-slate-600",render:s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-3 h-3 text-slate-400"})," ",s.phone||"-"]})},{header:"العنوان",accessor:"address",className:"text-sm text-slate-500",render:s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-3 h-3 text-slate-400"})," ",s.address||"-"]})},{header:"الملاحظات",accessor:"notes",className:"max-w-xs truncate text-slate-500",render:s=>s.notes||"-"}],E=s=>e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>w(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>y(s),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx($,{className:"w-4 h-4"})})]});return e.jsxs("div",{className:"p-6 max-w-[1800px] mx-auto space-y-6",children:[e.jsx(X,{isOpen:b,onClose:()=>d(!1),onConfirm:v,title:"تحذير: حذف عميل",message:`سيتم حذف العميل "${a==null?void 0:a.name}". هل أنت متأكد؟`,isDeleting:i}),e.jsx(_,{title:"قائمة العملاء",subtitle:"إدارة سجلات العملاء والديون",data:x,columns:O,actions:E,onAdd:()=>t(!0),addButtonLabel:"إضافة عميل",searchPlaceholder:"بحث عن عميل...",exportName:"customers",hideHeader:l}),e.jsx(P,{isOpen:f,onClose:()=>t(!1),onSuccess:S}),e.jsx(Y,{isOpen:r,onClose:()=>p(!1),customer:j,onSuccess:C})]})}function le(x){const{suppliers:n=[],customers:l=[]}=x,[f,t]=o.useState(l),[r,p]=o.useState(0);H.useEffect(()=>{t(l)},[l]);const j=u=>{t(u)},[m,b]=o.useState(!1),[d,a]=o.useState(!1),c=()=>{r===0?b(!0):a(!0)},i=u=>{const w=r===0?n:f,y=r===0?"suppliers":"customers";if(w.length===0){alert("لا توجد بيانات للتصدير");return}const v=Object.keys(w[0]).join(","),S=w.map(h=>Object.values(h).map(N=>`"${N}"`).join(",")),C=[v,...S].join(`
`),O=new Blob(["\uFEFF"+C],{type:"text/csv;charset=utf-8;"}),E=URL.createObjectURL(O),s=document.createElement("a");s.href=E,s.download=`${y}_${new Date().toISOString().slice(0,10)}.csv`,s.click()};return e.jsxs("div",{className:"p-6 max-w-[1800px] mx-auto min-h-screen space-y-8 animate-fade-in",children:[e.jsx("div",{className:"space-y-6",children:e.jsxs(K,{index:r,onIndexChange:p,children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 bg-white p-2 rounded-2xl shadow-sm border border-slate-100 mb-6",children:[e.jsx("div",{className:"w-full md:w-auto flex justify-center md:justify-start",children:e.jsxs(Q,{variant:"solid",className:"bg-slate-50 p-1 rounded-xl shadow-inner border border-slate-200/50",children:[e.jsx(I,{className:"px-6 py-2 rounded-lg font-bold text-slate-500 ui-selected:bg-blue-600 ui-selected:text-white ui-selected:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{children:"الموردين"})]})}),e.jsx(I,{className:"px-6 py-2 rounded-lg font-bold text-slate-500 ui-selected:bg-indigo-600 ui-selected:text-white ui-selected:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:"العملاء (الزبائن)"})]})})]})}),e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto justify-center md:justify-end",children:[e.jsx("button",{onClick:()=>i(),className:"flex items-center GAP-2 px-4 py-2 text-slate-600 bg-slate-50 hover:bg-slate-100 rounded-xl font-bold border border-slate-200 transition-colors text-sm",children:e.jsx("span",{children:"تصدير"})}),e.jsx("button",{onClick:()=>c(),className:"flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition-colors shadow-lg shadow-blue-600/20 text-sm",children:e.jsx("span",{children:r===0?"إضافة مورد":"إضافة عميل"})}),e.jsx("button",{onClick:()=>window.print(),className:"flex items-center gap-2 px-4 py-2 text-slate-600 bg-slate-50 hover:bg-slate-100 rounded-xl font-bold border border-slate-200 transition-colors text-sm",children:e.jsx("span",{children:"طباعة"})})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(B,{mode:"wait",children:[r===0&&e.jsx(D.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:e.jsx(V,{suppliers:n,hideHeader:!0})},"suppliers"),r===1&&e.jsx(D.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:e.jsx(Z,{customers:f,onUpdate:j,hideHeader:!0})},"customers")]})})]})}),e.jsx(W,{isOpen:m,onClose:()=>b(!1),onSuccess:()=>window.location.reload()}),e.jsx(P,{isOpen:d,onClose:()=>a(!1),onSuccess:()=>window.location.reload()})]})}export{le as default};
