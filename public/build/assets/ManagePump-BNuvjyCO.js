import{c as O,r as d,j as e,m as a,d as L,S as r,F as N,b as v,a as c,t as o}from"./main-BZye3MWh.js";import{g as R,e as z,c as M}from"./Tracker-B3Wsk5ua.js";import{T as w}from"./trash-2-D_DkLkqJ.js";import{G as h}from"./gauge-DQTYN_kb.js";import{C as y}from"./circle-check-big-CfJJ_WJ_.js";import{S as A}from"./save-C_qR2yBp.js";import{T as F}from"./triangle-alert-BhxvaoUt.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],f=O("pen-line",V);function Q({pump:n,counters:k,workers:j,tanks:C,user:U}){const[m,x]=d.useState(null),[g,u]=d.useState(null),[E,p]=d.useState(!1),[S,b]=d.useState(!1),P=(t,l)=>{const s=t.match(/\d+/);return s?s[0]:l+1},_=async(t,l)=>{t.preventDefault();const s=new FormData(t.target);try{const i=await fetch("/PETRODIESEL2/public/pumps/updateCounter",{method:"POST",body:s});i.redirected||i.ok?(o.success("تم حفظ التغييرات بنجاح"),window.location.reload()):o.error("حدث خطأ أثناء الحفظ")}catch{o.error("فشل الاتصال بالخادم")}},D=t=>{const l=document.createElement("form");l.method="POST",l.action="/PETRODIESEL2/public/pumps/deleteCounter";const s=document.createElement("input");s.type="hidden",s.name="id",s.value=t;const i=document.createElement("input");i.type="hidden",i.name="pump_id",i.value=n.id,l.appendChild(s),l.appendChild(i),document.body.appendChild(l),l.submit()},I=t=>{t.preventDefault(),t.target.submit()},T=t=>{t.preventDefault(),t.target.submit()};return e.jsxs(a.div,{initial:{opacity:0},animate:{opacity:1},className:"p-6 max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 border-b border-slate-200 pb-6",children:[e.jsxs("div",{children:[e.jsxs("a",{href:"/PETRODIESEL2/public/pumps",className:"text-slate-500 hover:text-blue-600 mb-2 flex items-center gap-1 text-sm font-bold transition-colors",children:[e.jsx(L,{className:"w-4 h-4 ml-1"})," العودة للمكائن"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h1",{className:"text-3xl font-black text-slate-800 flex items-center gap-3",children:[e.jsx(r,{className:"w-8 h-8 text-blue-600"}),"تعديل الماكينة: ",e.jsx("span",{className:"text-blue-600",children:n.name})]}),e.jsx("button",{onClick:()=>p(!0),className:"p-1.5 rounded-full bg-slate-100 hover:bg-blue-100 text-slate-400 hover:text-blue-600 transition-colors",children:e.jsx(f,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-bold transition-all shadow-md hover:shadow-lg",children:[e.jsx(w,{className:"w-4 h-4 hidden"})," ",e.jsx(r,{className:"w-4 h-4"})," إضافة عداد جديد"]}),e.jsx(R,{size:"lg",color:"slate",icon:N,children:n.tank_name})]})]}),e.jsx(z,{numItems:1,numItemsMd:2,className:"gap-6",children:k.map((t,l)=>e.jsx(a.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:l*.1},children:e.jsxs(M,{className:"h-full border-t-4 border-t-amber-500 relative overflow-hidden group hover:shadow-lg transition-shadow bg-white",children:[e.jsx("div",{className:"absolute top-0 left-0 p-4 opacity-5 pointer-events-none",children:e.jsx(h,{className:"w-32 h-32"})}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b border-slate-100 pb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-50 text-amber-600 rounded-lg shadow-sm",children:e.jsx(h,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800",children:t.name||`العداد ${P(t.name,l)}`}),e.jsxs("span",{className:"text-xs text-slate-400 font-mono",children:["ID: #",t.id]})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>x(t),className:"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"تعديل الاسم",children:e.jsx(f,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>u(t),className:"p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"حذف العداد",children:e.jsx(w,{className:"w-4 h-4"})})]})]}),e.jsxs("form",{onSubmit:s=>_(s,t.id),className:"space-y-5",children:[e.jsx("input",{type:"hidden",name:"pump_id",value:n.id}),e.jsx("input",{type:"hidden",name:"counter_id",value:t.id}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"العامل المسؤول"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{name:"worker_id",defaultValue:t.current_worker_id||"",className:"w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none appearance-none font-bold text-slate-700",children:[e.jsx("option",{value:"",children:"-- غير محدد --"}),j.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(v,{className:"absolute left-3 top-3.5 w-5 h-5 text-slate-400 pointer-events-none"})]}),e.jsxs("p",{className:"text-[10px] text-emerald-600 mt-1.5 flex items-center gap-1 font-medium",children:[e.jsx(y,{className:"w-3 h-3"}),"سيتم ربط المبيعات بهذا العامل"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"قراءة العداد الحالية"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",name:"current_reading",defaultValue:t.current_reading,className:"w-full p-3 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-amber-500/20 focus:border-amber-500 outline-none font-mono text-lg font-bold text-slate-800 pl-16 text-right"}),e.jsx("div",{className:"absolute left-0 top-0 bottom-0 px-3 bg-slate-100 border-r border-slate-200 rounded-l-xl flex items-center text-slate-500 font-mono text-sm font-bold",children:"Liters"})]})]}),e.jsxs("button",{type:"submit",className:"w-full py-3 bg-slate-800 hover:bg-slate-700 text-white rounded-xl shadow-lg hover:shadow-xl transition-all font-bold flex justify-center items-center gap-2 mt-2",children:[e.jsx(A,{className:"w-4 h-4"})," حفظ التغييرات"]})]})]})]})},t.id))}),e.jsx(c,{children:m&&e.jsx(a.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm",onClick:()=>x(null),children:e.jsxs(a.div,{initial:{scale:.95},animate:{scale:1},exit:{scale:.95},className:"bg-white rounded-2xl p-6 w-full max-w-md shadow-2xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5 text-blue-500"})," تعديل اسم العداد"]}),e.jsxs("form",{action:"/PETRODIESEL2/public/pumps/updateCounterName",method:"POST",onSubmit:I,children:[e.jsx("input",{type:"hidden",name:"pump_id",value:n.id}),e.jsx("input",{type:"hidden",name:"counter_id",value:m.id}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"الاسم الجديد"}),e.jsx("input",{type:"text",name:"name",defaultValue:m.name,className:"w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",autoFocus:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>x(null),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg font-bold",children:"إلغاء"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold shadow-md",children:"حفظ"})]})]})]})})}),e.jsx(c,{children:g&&e.jsx(a.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm",onClick:()=>u(null),children:e.jsxs(a.div,{initial:{scale:.95},animate:{scale:1},exit:{scale:.95},className:"bg-white rounded-2xl p-6 w-full max-w-md shadow-2xl border-t-4 border-red-500",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 text-red-600 mb-4",children:[e.jsx("div",{className:"p-3 bg-red-50 rounded-full",children:e.jsx(F,{className:"w-6 h-6"})}),e.jsx("h3",{className:"text-xl font-bold",children:"تأكيد الحذف"})]}),e.jsxs("p",{className:"text-slate-600 mb-6 font-medium",children:["هل أنت متأكد من حذف هذا العداد؟ ",e.jsx("br",{}),e.jsx("span",{className:"text-sm text-red-500",children:"لا يمكن التراجع عن هذا الإجراء وسيتم حذف جميع البيانات المرتبطة."})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>u(null),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg font-bold",children:"إلغاء"}),e.jsx("button",{onClick:()=>D(g.id),className:"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-bold shadow-md",children:"حذف نهائي"})]})]})})}),e.jsx(c,{children:E&&e.jsx(a.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm",onClick:()=>p(!1),children:e.jsxs(a.div,{initial:{scale:.95},animate:{scale:1},exit:{scale:.95},className:"bg-white rounded-2xl p-6 w-full max-w-md shadow-2xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(r,{className:"w-5 h-5 text-blue-500"})," تعديل بيانات الماكينة"]}),e.jsxs("form",{action:"/PETRODIESEL2/public/pumps/updatePump",method:"POST",onSubmit:T,children:[e.jsx("input",{type:"hidden",name:"id",value:n.id}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"اسم الماكينة"}),e.jsx("input",{type:"text",name:"name",defaultValue:n.name,className:"w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none font-bold",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"الخزان (نوع الوقود)"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{name:"tank_id",defaultValue:n.tank_id,className:"w-full p-3 bg-slate-50 border border-slate-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none appearance-none font-bold",children:C.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.product_type,")"]},t.id))}),e.jsx(N,{className:"absolute left-3 top-3.5 w-5 h-5 text-slate-400 pointer-events-none"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>p(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg font-bold",children:"إلغاء"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold shadow-md",children:"حفظ التعديلات"})]})]})]})})}),e.jsx(c,{children:S&&e.jsx(a.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm",onClick:()=>b(!1),children:e.jsxs(a.div,{initial:{scale:.95},animate:{scale:1},exit:{scale:.95},className:"bg-white rounded-2xl p-6 w-full max-w-md shadow-2xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(r,{className:"w-5 h-5 text-emerald-500"})," إضافة عداد جديد"]}),e.jsxs("form",{onSubmit:async t=>{t.preventDefault();const l=new FormData(t.target);try{(await fetch("/PETRODIESEL2/public/pumps/addCounter",{method:"POST",body:l})).ok?(o.success("تمت إضافة العداد بنجاح"),window.location.reload()):o.error("حدث خطأ أثناء الإضافة")}catch{o.error("فشل الاتصال بالخادم")}},children:[e.jsx("input",{type:"hidden",name:"pump_id",value:n.id}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"اسم العداد"}),e.jsx("input",{type:"text",name:"name",className:"w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none font-bold placeholder:text-slate-300",placeholder:"مثال: مسدس 1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"القراءة الأولية"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",name:"initial_reading",className:"w-full p-3 pl-12 border border-slate-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none font-mono font-bold",placeholder:"0.00",required:!0}),e.jsx(h,{className:"absolute left-3 top-3.5 w-5 h-5 text-slate-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"العامل المسؤول"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{name:"worker_id",className:"w-full p-3 bg-slate-50 border border-slate-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none appearance-none font-bold text-slate-700 cursor-pointer",children:[e.jsx("option",{value:"",children:"-- اختر عامل --"}),j.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx(v,{className:"absolute left-3 top-3.5 w-5 h-5 text-slate-400 pointer-events-none"})]}),e.jsxs("p",{className:"text-[10px] text-emerald-600 mt-1.5 flex items-center gap-1 font-medium",children:[e.jsx(y,{className:"w-3 h-3"}),"تعيين مباشر للعامل عند الإنشاء"]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg font-bold",children:"إلغاء"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-bold shadow-md",children:"إضافة العداد"})]})]})]})})})]})}export{Q as default};
