import{c as U,r as d,j as e,m as x,a as I,b as B,W as M,t as i}from"./main-BZye3MWh.js";import"./Tracker-B3Wsk5ua.js";import{D as P}from"./droplets-tYTJtffJ.js";import{C as O}from"./circle-alert-CMgrqVIW.js";import{S as T}from"./save-C_qR2yBp.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],h=U("refresh-cw",q);function J({pumps:g=[],safes:m=[],banks:k=[],customers:S=[],initialSale:p=null}){var _,y;const[t,n]=d.useState({sale_date:new Date().toISOString().split("T")[0],pump_id:"",counter_id:"",opening_reading:"",closing_reading:"",volume_sold:0,unit_price:0,total_amount:0,payment_method:"cash",account_type:"safe",account_id:"",customer_id:"",notes:""}),[c,f]=d.useState(null),[C,j]=d.useState(!1),[v,N]=d.useState(!1),[w,F]=d.useState("Loading...");d.useEffect(()=>{fetch(`${window.BASE_URL||""}/sales/getNextInvoiceNumber`).then(s=>s.json()).then(s=>{s.success&&F(s.invoice_number)}).catch(s=>console.error("Failed to fetch invoice number",s)),m.length>0&&n(s=>({...s,account_id:m[0].id})),p&&n(p)},[m,p]);const L=s=>{const l=s.target.value;n(r=>({...r,pump_id:l,counter_id:"",opening_reading:"",unit_price:0})),f(null)},D=async s=>{const l=s.target.value;if(n(r=>({...r,counter_id:l})),!!l){j(!0);try{const a=await(await fetch(`${window.BASE_URL||""}/sales/getCounterDetails?counter_id=${l}`)).json();a.success?(f({fuel_type:a.product_type,worker_name:a.worker_name,worker_id:a.worker_id,price:parseFloat(a.price),current_reading:parseFloat(a.current_reading)}),n(o=>({...o,unit_price:parseFloat(a.price),opening_reading:parseFloat(a.current_reading),worker_id:a.worker_id})),i.success("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­")):i.error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¯Ø§Ø¯")}catch(r){console.error("API Error:",r),i.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„")}finally{j(!1)}}},E=s=>{const l=parseFloat(s.target.value)||0,r=parseFloat(t.opening_reading)||0;let a=0;l>=r&&(a=l-r);const o=a*t.unit_price;n(A=>({...A,closing_reading:s.target.value,volume_sold:a,total_amount:o}))},$=async s=>{if(s.preventDefault(),!t.counter_id||!t.closing_reading){i.error("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©");return}if(parseFloat(t.closing_reading)<parseFloat(t.opening_reading)){i.error("Ø®Ø·Ø£: Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©!");return}N(!0);try{const l=new FormData;Object.keys(t).forEach(o=>{t[o]!==null&&t[o]!==void 0&&l.append(o,t[o])}),l.append("invoice_number",w);const a=await(await fetch(`${window.BASE_URL||""}/sales/store`,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"},body:l})).json();a.success?(i.success("ØªÙ… Ø­ÙØ¸ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰"),setTimeout(()=>window.location.href=`${window.BASE_URL||""}/sales`,1e3)):i.error(a.message||"ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©")}catch(l){console.error("Submit Error:",l),i.error("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸")}finally{N(!1)}},b=s=>parseFloat(s||0).toLocaleString("en-US",{style:"currency",currency:"USD"}).replace("$","")+" SDG",u=s=>parseFloat(s||0).toLocaleString("en-US"),R=s=>{const l=(s||"").toLowerCase();return l.includes("diesel")||l.includes("Ø¯ÙŠØ²Ù„")?"bg-amber-100 text-amber-700 border-amber-200":l.includes("petrol")||l.includes("Ø¨Ù†Ø²ÙŠÙ†")?"bg-emerald-100 text-emerald-700 border-emerald-200":l.includes("gas")||l.includes("ØºØ§Ø²")?"bg-purple-100 text-purple-700 border-purple-200":"bg-blue-100 text-blue-700 border-blue-200"};return e.jsx("div",{className:"min-h-screen bg-slate-50/50 p-4",style:{direction:"rtl"},children:e.jsxs("div",{className:"max-w-[1600px] mx-auto grid grid-cols-1 lg:grid-cols-12 gap-6 items-start",children:[e.jsx(x.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"lg:col-span-9",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"px-6 pt-6 pb-2 flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-bold text-slate-400",children:"Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:"}),e.jsx("span",{className:"text-lg font-black text-slate-700 tracking-tight font-mono bg-slate-100 px-3 py-1 rounded-lg border border-slate-200 dashed",children:w})]}),e.jsx("input",{type:"date",value:t.sale_date,onChange:s=>n(l=>({...l,sale_date:s.target.value})),className:"bg-transparent border border-slate-200 text-slate-500 text-xs font-bold rounded-lg focus:ring-0 focus:border-blue-400 p-2 cursor-pointer hover:bg-slate-50 hover:border-slate-300 transition-colors"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200",children:e.jsxs("div",{className:"flex flex-wrap lg:flex-nowrap items-end gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1 block",children:"Ø§Ù„Ù…Ø§ÙƒÙŠÙ†Ø© (Pump)"}),e.jsx("div",{className:"relative",children:e.jsxs("select",{value:t.pump_id,onChange:L,className:"w-full text-sm font-bold text-black bg-white border border-slate-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500/20 outline-none",children:[e.jsx("option",{value:"",children:"Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§ÙƒÙŠÙ†Ø©..."}),g.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - ",s.product_name||"ÙˆÙ‚ÙˆØ¯"]},s.id))]})})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"text-xs font-bold text-indigo-900 mb-1 block",children:"Ø§Ù„Ø¹Ø¯Ø§Ø¯ (Counter)"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:t.counter_id,onChange:D,disabled:!t.pump_id,className:"w-full text-sm font-bold text-black bg-white border border-slate-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500/20 outline-none disabled:bg-slate-100 disabled:text-slate-400",children:[e.jsx("option",{value:"",children:"Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯..."}),(y=(_=g.find(s=>s.id==t.pump_id))==null?void 0:_.counters)==null?void 0:y.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),C&&e.jsx(h,{className:"w-4 h-4 absolute left-3 top-3 animate-spin text-blue-500"})]})]}),e.jsx(I,{children:c&&e.jsxs(e.Fragment,{children:[e.jsxs(x.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:`flex items-center gap-2 px-3 py-2 rounded-lg border ${R(c.fuel_type)} h-[42px] min-w-[120px]`,children:[e.jsx(P,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] opacity-75 leading-none",children:"Ø§Ù„ÙˆÙ‚ÙˆØ¯"}),e.jsx("div",{className:"text-xs font-bold leading-none mt-1",children:c.fuel_type})]})]}),e.jsxs(x.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-white border border-slate-200 text-slate-700 shadow-sm h-[42px] min-w-[140px]",children:[e.jsx("div",{className:"p-1 bg-slate-100 rounded-full",children:e.jsx(B,{className:"w-3 h-3 text-slate-500"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-slate-400 leading-none",children:"Ø§Ù„Ø¹Ø§Ù…Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„"}),e.jsx("div",{className:"text-xs font-bold leading-none mt-1",children:c.worker_name})]})]})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4 items-end",children:[e.jsx("div",{className:"md:col-span-3 flex justify-start pb-1",children:e.jsxs("div",{className:"flex items-center gap-3 bg-slate-100 border border-slate-200 rounded-xl px-3 py-2 w-full",children:[e.jsx("div",{className:"p-2 bg-white rounded-lg shadow-sm",children:e.jsx(h,{className:"w-4 h-4 text-slate-400"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500 block",children:"Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©"}),e.jsx("div",{className:"text-lg font-mono font-black text-slate-700 tracking-tight",children:u(t.opening_reading)||"---"})]})]})}),e.jsxs("div",{className:"md:col-span-5",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1 block",children:"Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Closing)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:t.closing_reading,onChange:E,disabled:!c,autoFocus:!0,className:`w-full font-mono text-xl font-black border rounded-xl p-3 focus:ring-4 outline-none transition-all shadow-sm ${parseFloat(t.closing_reading)<parseFloat(t.opening_reading)?"border-red-300 focus:ring-red-500/10 bg-red-50 text-red-600":"border-slate-200 focus:ring-blue-500/10 focus:border-blue-400 bg-white text-slate-800"}`,placeholder:"000000"}),e.jsx("div",{className:"absolute left-4 top-3.5 text-xs text-slate-300 font-bold",children:"Liters"})]}),parseFloat(t.closing_reading)<parseFloat(t.opening_reading)&&e.jsxs("p",{className:"text-[10px] text-red-500 mt-1 font-bold flex items-center gap-1 animate-pulse",children:[e.jsx(O,{className:"w-3 h-3"}),"Ø®Ø·Ø£: Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©"]})]}),e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1 block",children:"Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:u(t.volume_sold),readOnly:!0,className:"w-full bg-indigo-50/50 text-indigo-600 font-mono text-xl font-black border border-indigo-100 rounded-xl p-3"}),e.jsx("div",{className:"absolute left-4 top-3.5 text-xs text-indigo-300 font-bold",children:"Liters"})]})]})]}),e.jsxs("div",{className:"relative py-2",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-slate-200"})}),e.jsx("div",{className:"relative flex justify-center",children:e.jsxs("span",{className:"bg-white px-4 text-xs text-slate-400 font-mono",children:["Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©: ",e.jsx("span",{className:"text-slate-700 font-bold",children:b(t.unit_price)})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 bg-slate-50/50 p-4 rounded-xl border border-slate-200",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1 block",children:"Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹"}),e.jsxs("div",{className:"flex rounded-lg overflow-hidden border border-slate-300",children:[e.jsx("button",{type:"button",onClick:()=>n(s=>({...s,payment_method:"cash"})),className:`flex-1 py-2 text-xs font-bold transition-all ${t.payment_method==="cash"?"bg-emerald-600 text-white":"bg-white text-slate-600 hover:bg-slate-50"}`,children:"ğŸ’µ Ù†Ù‚Ø¯ÙŠ"}),e.jsx("button",{type:"button",onClick:()=>n(s=>({...s,payment_method:"credit"})),className:`flex-1 py-2 text-xs font-bold transition-all ${t.payment_method==="credit"?"bg-amber-600 text-white":"bg-white text-slate-600 hover:bg-slate-50"}`,children:"ğŸ“„ Ø¢Ø¬Ù„"})]})]}),t.payment_method==="cash"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1 block",children:"Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨"}),e.jsxs("select",{value:t.account_type,onChange:s=>n(l=>({...l,account_type:s.target.value,account_id:""})),className:"w-full text-sm bg-white border border-slate-300 rounded-lg p-2 outline-none focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:"safe",children:"Ø®Ø²Ù†Ø© (Safe)"}),e.jsx("option",{value:"bank",children:"Ø¨Ù†Ùƒ (Bank)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1 block",children:"Ø§Ù„Ø§ÙŠØ¯Ø§Ø¹ ÙÙŠ"}),e.jsxs("select",{value:t.account_id,onChange:s=>n(l=>({...l,account_id:s.target.value})),className:"w-full text-sm bg-white border border-slate-300 rounded-lg p-2 outline-none focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Ø§Ø®ØªØ± Ø§Ù„Ø­Ø³Ø§Ø¨..."}),t.account_type==="safe"?m.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id)):k.map(s=>e.jsxs("option",{value:s.id,children:[s.bank_name," - ",s.account_number]},s.id))]})]})]}):e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1 block",children:"Ø§Ù„Ø¹Ù…ÙŠÙ„ (Customer)"}),e.jsxs("select",{value:t.customer_id,onChange:s=>n(l=>({...l,customer_id:s.target.value})),className:"w-full text-sm bg-white border border-slate-300 rounded-lg p-2 outline-none focus:ring-1 focus:ring-amber-500",children:[e.jsx("option",{value:"",children:"Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…ÙŠÙ„..."}),S.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - Ø±ØµÙŠØ¯: ",b(s.balance)]},s.id))]})]})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsxs(x.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:$,disabled:v||!t.closing_reading,className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-xl shadow-lg shadow-blue-500/30 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed text-lg",children:[v?e.jsx(h,{className:"w-5 h-5 animate-spin"}):e.jsx(T,{className:"w-5 h-5"}),"Ø­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©"]})})]})]})}),e.jsx(x.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},className:"lg:col-span-3 lg:sticky lg:top-6 lg:bottom-6",children:e.jsxs("div",{className:"bg-gradient-to-br from-indigo-600/90 to-purple-700/90 backdrop-blur-xl rounded-2xl shadow-2xl p-6 text-white border border-white/10 h-full min-h-[400px] flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-10 -mt-10 blur-2xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-32 h-32 bg-indigo-400/20 rounded-full -ml-10 -mb-10 blur-2xl"}),e.jsxs("div",{className:"relative z-10 flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 text-indigo-100",children:[e.jsx(M,{className:"w-6 h-6"}),e.jsx("h3",{className:"font-bold text-lg",children:"Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©"})]}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"bg-white/10 rounded-xl p-4 backdrop-blur-md",children:[e.jsx("div",{className:"text-xs text-indigo-200 mb-1",children:"Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©"}),e.jsxs("div",{className:"text-2xl font-black font-mono tracking-tight flex items-baseline gap-1",children:[u(t.volume_sold),e.jsx("span",{className:"text-sm font-bold opacity-75",children:"Ù„ØªØ±"})]})]}),e.jsxs("div",{className:"space-y-3 py-4",children:[e.jsxs("div",{className:"flex justify-between text-sm opacity-80",children:[e.jsx("span",{children:"Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©:"}),e.jsx("span",{className:"font-mono",children:b(t.unit_price)})]}),e.jsxs("div",{className:"flex justify-between text-sm opacity-80",children:[e.jsx("span",{children:"Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª:"}),e.jsx("span",{className:"font-mono",children:t.volume_sold})]}),t.payment_method==="credit"&&e.jsxs("div",{className:"flex justify-between text-xs text-amber-300 font-bold bg-amber-500/10 p-2 rounded",children:[e.jsx("span",{children:"Ø§Ù„Ø¯ÙØ¹:"}),e.jsx("span",{children:"Ø¢Ø¬Ù„ (Ø°Ù…Ù…)"})]})]})]}),e.jsxs("div",{className:"mt-auto pt-6 border-t border-white/20",children:[e.jsx("div",{className:"text-sm text-indigo-200 mb-1",children:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"}),e.jsxs("div",{className:"text-4xl font-black font-mono tracking-tight flex items-baseline gap-2",children:[u(t.total_amount),e.jsx("span",{className:"text-base font-bold text-indigo-200",children:"SDG"})]})]})]})]})})]})})}export{J as default};
