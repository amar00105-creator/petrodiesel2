import{j as e,S as L,X as T,F as M,R as $,l as F,P as I,i as R,t as u,m as w}from"./ui-DpPGrQoH.js";import{r as o,R as B}from"./vendor-BdFMDtQB.js";import{n as V,D as P,d as A,c as z,b as H,m as W,e as G}from"./main-i_nKCBsx.js";import{S as J}from"./SuccessAnimation-Bxw0sD32.js";function U({isOpen:p,onClose:i,pump:l,tanks:b,workers:f}){const[r,x]=o.useState({id:l.id,name:l.name,tank_id:l.tank_id,counters:l.counters||[]});B.useEffect(()=>{x({id:l.id,name:l.name,tank_id:l.tank_id,counters:l.counters||[]})},[l]);const[n,c]=o.useState(!1),d=(s,t)=>{x(a=>({...a,[s]:t}))},m=(s,t,a)=>{const h=[...r.counters];h[s]={...h[s],[t]:a},x(_=>({..._,counters:h}))},C=async()=>{c(!0);try{const t=await(await fetch("/PETRODIESEL2/public/pumps/updateBulk",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).json();t.success?(u.success("تم حفظ التغييرات بنجاح"),setTimeout(()=>window.location.reload(),800)):u.error(t.message||"حدث خطأ أثناء الحفظ")}catch{u.error("خطأ في الاتصال")}finally{c(!1)}},[k,g]=o.useState(!1),[j,v]=o.useState(null),[D,N]=o.useState(!1),E=s=>{v(s),g(!0)},y=async()=>{if(!j)return;N(!0);const s=new FormData;s.append("id",j),s.append("pump_id",r.id);try{await fetch("/PETRODIESEL2/public/pumps/deleteCounter",{method:"POST",body:s}),u.success("تم الحذف بنجاح"),x(t=>({...t,counters:t.counters.filter(a=>a.id!==j)}))}catch{u.error("فشل عملية الحذف")}finally{N(!1),g(!1),v(null)}},S=s=>{E(s)},O=async(s,t)=>{if(!s||t===""){u.error("يرجى ملء جميع الحقول");return}const a=new FormData;a.append("pump_id",r.id),a.append("name",s),a.append("initial_reading",t);try{const _=await(await fetch("/PETRODIESEL2/public/pumps/addCounter",{method:"POST",body:a})).json();_.success?(u.success("تمت إضافة العداد بنجاح"),setTimeout(()=>window.location.reload(),1e3)):u.error("فشل إضافة العداد: "+(_.error||"خطأ غير معروف"))}catch{u.error("خطأ في الاتصال")}};return e.jsxs(V,{open:p,onClose:i,static:!0,className:"z-[100]",children:[e.jsx(P,{isOpen:k,onClose:()=>g(!1),onConfirm:y,title:"حذف عداد",message:"هل أنت متأكد من حذف هذا العداد؟",isDeleting:D}),e.jsxs(A,{className:"max-w-4xl p-0 overflow-hidden bg-white rounded-2xl shadow-2xl ring-1 ring-slate-900/5",children:[e.jsxs("div",{className:"bg-slate-50 border-b border-slate-100 p-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-blue-600"}),"إدارة الماكينة: ",l.name]}),e.jsx("p",{className:"text-slate-500 text-sm",children:"تعديل البيانات والعدادات والعمال"})]}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-slate-200 rounded-full transition-colors text-slate-500",children:e.jsx(T,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[70vh] space-y-8",children:[e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-800 font-bold border-r-4 border-blue-500 pr-3",children:[e.jsx(M,{className:"w-5 h-5 text-blue-500"}),e.jsx("h3",{children:"بيانات الماكينة"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 bg-slate-50/50 p-6 rounded-xl border border-slate-100",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"اسم الماكينة"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-slate-700",value:r.name,onChange:s=>d("name",s.target.value),placeholder:"مثال: ماكينة 1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"الخزان المرتبط"}),e.jsx("select",{className:"w-full px-3 py-2 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-slate-700",value:String(r.tank_id),onChange:s=>d("tank_id",s.target.value),children:b.map(s=>e.jsxs("option",{value:String(s.id),children:[s.name," (",s.product_type,")"]},s.id))})]}),e.jsx("div",{className:"sm:col-span-2 flex justify-end"})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-800 font-bold border-r-4 border-emerald-500 pr-3",children:[e.jsx($,{className:"w-5 h-5 text-emerald-500"}),e.jsx("h3",{children:"العدادات والعمال"})]}),e.jsxs("div",{className:"space-y-4",children:[r.counters.map((s,t)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-4 shadow-sm hover:border-blue-300 transition-colors flex flex-col md:flex-row gap-4 items-end md:items-center",children:[e.jsxs("div",{className:"flex-1 w-full space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400",children:"اسم العداد"}),e.jsx("input",{type:"text",className:"w-full px-2 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-slate-700",value:s.name,onChange:a=>m(t,"name",a.target.value)})]}),e.jsxs("div",{className:"w-full md:w-32 space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400",children:"القراءة الحالية"}),e.jsx("input",{type:"number",className:"w-full px-2 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-slate-700",value:s.current_reading,onChange:a=>m(t,"current_reading",a.target.value),min:0})]}),e.jsxs("div",{className:"flex-1 w-full space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400",children:"العامل المسؤول"}),e.jsxs("select",{className:"w-full px-2 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-slate-700",value:String(s.current_worker_id||""),onChange:a=>m(t,"current_worker_id",a.target.value),children:[e.jsx("option",{value:"",children:"خالي (بدون عامل)"}),f.map(a=>e.jsx("option",{value:String(a.id),children:a.name},a.id))]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:()=>S(s.id),className:"p-1.5 rounded-lg bg-red-50 text-red-600 hover:bg-red-100 transition-colors",title:"حذف العداد",children:e.jsx(F,{className:"w-4 h-4"})})})]},s.id)),r.counters.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400 italic bg-slate-50 rounded-xl border border-dashed border-slate-200",children:"لا توجد عدادات لهذه الماكينة"})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100",children:[e.jsxs("h4",{className:"text-sm font-bold text-slate-600 mb-3 flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"})," إضافة عداد جديد"]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 items-end",children:[e.jsxs("div",{className:"flex-1 w-full space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400",children:"اسم العداد"}),e.jsx("input",{type:"text",className:"w-full px-2 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-slate-700",placeholder:"مثال: مسدس 3",id:"new_counter_name"})]}),e.jsxs("div",{className:"w-full md:w-32 space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400",children:"القراءة الأولية"}),e.jsx("input",{type:"number",className:"w-full px-2 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-slate-700",defaultValue:0,min:0,step:"0.01",id:"new_counter_reading"})]}),e.jsxs("button",{className:"inline-flex items-center gap-2 px-3 py-1.5 text-xs font-semibold text-blue-700 bg-blue-100/50 hover:bg-blue-100 rounded-lg transition-colors",onClick:()=>O(document.getElementById("new_counter_name").value,document.getElementById("new_counter_reading").value),children:[e.jsx(I,{className:"w-4 h-4"}),"إضافة"]})]})]})]})]}),e.jsxs("div",{className:"bg-slate-50 p-4 border-t border-slate-100 flex justify-end gap-3",children:[e.jsx("button",{onClick:i,className:"px-4 py-2 text-sm font-medium text-slate-700 bg-white border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors",children:"إلغاء"}),e.jsx("button",{onClick:C,disabled:n,className:"px-4 py-2 text-sm font-bold text-white bg-blue-600 rounded-lg hover:bg-blue-700 shadow-lg shadow-blue-500/30 transition-all flex items-center gap-2",children:n?"جاري الحفظ...":e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4"}),"حفظ التعديلات"]})})]})]})]})}const X=({pumpName:p="مضخة رقم 1",fuelType:i="ديزل ممتاز",counters:l=[],sourceWell:b="البير رقم 3",onEdit:f,onDelete:r})=>{const x=i&&(i.includes("ديزل")||i.includes("Diesel")||i.includes("جاز")),n=x?{primary:"blue",border:"border-blue-500/20",shadow:"rgba(59, 130, 246, 0.5)",text:"text-blue-400"}:{primary:"orange",border:"border-orange-500/20",shadow:"rgba(249, 115, 22, 0.5)",text:"text-orange-400"},c={initial:{opacity:.6,shadowBlur:"10px"},animate:{opacity:[.6,1,.6],boxShadow:[`0 0 10px ${n.shadow}`,`0 0 20px ${n.shadow}`,`0 0 10px ${n.shadow}`]}};return e.jsxs(w.div,{whileHover:{scale:1.02,translateY:-5},transition:{type:"spring",stiffness:300},className:`relative w-full h-[24rem] p-4 rounded-3xl border border-white/10 bg-black/60 backdrop-blur-xl flex flex-col justify-between overflow-hidden group ${n.border}`,children:[e.jsx(w.div,{variants:c,initial:"initial",animate:"animate",transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:`absolute inset-y-0 left-0 w-1 bg-${n.primary}-500`}),e.jsx(w.div,{variants:c,initial:"initial",animate:"animate",transition:{duration:2,repeat:1/0,ease:"easeInOut",delay:1},className:`absolute inset-y-0 right-0 w-1 bg-${n.primary}-500`}),e.jsxs("div",{className:"w-full flex justify-between items-start z-10 mb-2",children:[e.jsxs("div",{className:"flex flex-col items-start gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:`w-6 h-6 ${n.text}`}),e.jsx("h3",{className:`font-black text-xl ${n.text} drop-shadow-md whitespace-nowrap`,children:p})]}),e.jsx("span",{className:`text-xl font-bold ${n.text} uppercase bg-white/5 px-3 py-1 rounded mt-1`,children:i})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("div",{className:"flex flex-col items-end bg-white/5 px-2 py-1 rounded-lg border border-white/5",children:[e.jsx("span",{className:"text-[9px] text-gray-400",children:"المصدر"}),e.jsx("span",{className:"text-xs font-bold text-gray-200",children:b})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:f,className:"p-1.5 rounded-lg bg-blue-500/10 hover:bg-blue-500/20 text-blue-400 hover:text-blue-300 transition-all border border-blue-500/20",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),e.jsx("button",{onClick:r,className:"p-1.5 rounded-lg bg-red-500/10 hover:bg-red-500/20 text-red-400 hover:text-red-300 transition-all border border-red-500/20",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 6h18"}),e.jsx("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),e.jsx("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"})]})})]})]})]}),e.jsx("div",{className:"w-full flex-1 overflow-y-auto space-y-2 mt-2 custom-scrollbar pr-1",children:l&&l.length>0?l.map((d,m)=>e.jsxs("div",{className:"w-full bg-black border border-white/10 rounded-lg p-3 flex justify-between items-center shadow-lg relative overflow-hidden group/row h-16",children:[e.jsx("div",{className:`absolute inset-y-0 left-0 w-0.5 bg-${n.primary}-500 opacity-50`}),e.jsxs("div",{className:"text-left flex-1 border-r border-white/10 pr-2 mr-2",children:[e.jsx("span",{className:"text-lg font-bold text-gray-200 block leading-tight",children:d.worker_name||"عامل غير مخصص"}),e.jsx("span",{className:"text-[9px] text-gray-500",children:"اسم العامل"})]}),e.jsxs("div",{className:"font-mono text-xl text-white tracking-wider drop-shadow-sm flex flex-col items-end leading-none",children:[e.jsx("span",{children:parseFloat(d.current_reading||0).toLocaleString("en-US",{minimumFractionDigits:2})}),e.jsx("span",{className:"text-[10px] text-gray-500 font-sans mt-0.5",children:"Liters"})]})]},m)):e.jsx("div",{className:"w-full h-full flex items-center justify-center border border-white/5 rounded-xl bg-white/5 border-dashed",children:e.jsx("span",{className:"text-xs text-gray-500",children:"لا توجد عدادات"})})}),e.jsx("div",{className:`absolute inset-0 bg-[radial-gradient(circle_at_50%_0%,${x?"rgba(59,130,246,0.15)":"rgba(249,115,22,0.15)"},transparent)] pointer-events-none`})]})};function Z({pumps:p=[],tanks:i=[],workers:l=[]}){const[b,f]=o.useState(!1),[r,x]=o.useState(""),[n,c]=o.useState(!1),[d,m]=o.useState(null),C=t=>{m(t),c(!0)},[k,g]=o.useState(!1),j=async()=>{if(!d)return;g(!0);const t=new FormData;t.append("id",d.id);try{const h=await(await fetch("/PETRODIESEL2/public/pumps/delete_ajax",{method:"POST",body:t})).json();h.success?(c(!1),x("تم حذف الماكينة بنجاح"),f(!0)):alert(h.message||"فشل عملية الحذف")}catch(a){console.error(a),alert("خطأ في الاتصال")}finally{g(!1),b||(c(!1),m(null))}},v=()=>{f(!1),window.location.reload()},D={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},N={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}},[E,y]=o.useState(!1),[S,O]=o.useState(null),s=t=>{O(t),y(!0)};return e.jsxs(w.div,{initial:"hidden",animate:"visible",variants:D,className:"p-6 max-w-[1900px] mx-auto",children:[e.jsx(J,{isVisible:b,message:r,onComplete:v}),e.jsx(P,{isOpen:n,onClose:()=>c(!1),onConfirm:j,title:"تحذير: حذف ماكينة وقود",isDeleting:k,message:`سيتم حذف الماكينة "${d==null?void 0:d.name}" وجميع عداداتها المرتبطة. هل أنت متأكد من الحذف؟`}),S&&e.jsx(U,{isOpen:E,onClose:()=>y(!1),pump:S,tanks:i,workers:l}),e.jsx("div",{className:"flex justify-end mb-6",children:e.jsxs("a",{href:"/PETRODIESEL2/public/pumps/create",className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl shadow-lg hover:shadow-blue-500/30 transition-all flex items-center gap-2 font-bold",children:[e.jsx(I,{className:"w-5 h-5"})," إضافة ماكينة"]})}),p.length===0?e.jsxs(z,{className:"text-center py-20 bg-slate-50 border-dashed border-2 border-slate-200",children:[e.jsx("div",{className:"inline-flex p-4 bg-slate-100 rounded-full mb-4 text-slate-400",children:e.jsx(M,{className:"w-12 h-12"})}),e.jsx(H,{className:"text-slate-600",children:"لا توجد مكائن مضافة"}),e.jsx(W,{className:"mt-2 text-slate-400",children:"ابدأ بإضافة أول ماكينة وقود للنظام"})]}):e.jsx(G,{numItems:2,numItemsMd:3,numItemsLg:5,className:"gap-4",children:p.map(t=>e.jsx(w.div,{variants:N,children:e.jsx(X,{pumpName:t.name,fuelType:t.product_type||"وقود",counters:t.counters||[],sourceWell:t.tank_name||"خزان غير محدد",onEdit:()=>s(t),onDelete:()=>C(t)})},t.id))})]})}export{Z as default};
