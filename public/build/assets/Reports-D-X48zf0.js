import{j as e,o as ke,p as ve,aq as _e,ar as Se,t as I,ai as De,T as ne,q as je,f as fe,m as H,F as $e,ap as Ce,A as ye,g as Le,Q as ie,a8 as Ne,U as le,W as Fe,af as we,_ as Ee}from"./ui-DtuMUTb1.js";import{r as k}from"./vendor-BdFMDtQB.js";import{c as y,b as A,m as o,g as oe,s as B,j as Re,k as Ue,l as te,a as J}from"./main-CLVC6oQV.js";import Ae from"./CustomerReport-B0PGWx7N.js";function Te({stationId:q}){var v,j;const[C,w]=k.useState(new Date().toISOString().split("T")[0]),[p,R]=k.useState(null),[t,P]=k.useState(!1),u=async()=>{P(!0);try{const g=new URLSearchParams({action:"get_detailed_daily_sales",date:C,station_id:q||"all"}).toString(),T=await(await fetch(`${window.BASE_URL||""}/reports?${g}`)).json();T.success?R(T):I.error(T.message||"فشل تحميل التقرير")}catch(g){console.error(g),I.error("خطأ في الاتصال")}finally{P(!1)}};k.useEffect(()=>{u()},[C,q]);const f=g=>parseFloat(g||0).toLocaleString("en-US"),Q=()=>{window.print()};return e.jsx("div",{className:"space-y-6 animate-fade-in p-4 print:p-0",children:e.jsxs(y,{className:"bg-white print:shadow-none print:border-none",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 mb-4",children:[e.jsxs("div",{className:"text-center md:text-right",children:[e.jsx(A,{className:"text-2xl font-black text-slate-800",children:"تقرير مبيعات العدادات اليومية"}),e.jsx(o,{className:"text-slate-500",children:"تفاصيل المبيعات وحركة الخزانات"})]}),e.jsxs("div",{className:"flex items-center gap-3 print:hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:C,onChange:g=>w(g.target.value),className:"pl-3 pr-10 py-2 border-2 border-slate-200 rounded-xl font-bold text-slate-700 focus:border-blue-500 outline-none transition-colors"}),e.jsx(ke,{className:"w-5 h-5 text-slate-400 absolute right-3 top-2.5 pointer-events-none"})]}),e.jsx("button",{onClick:Q,className:"p-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-xl transition-colors",children:e.jsx(ve,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"hidden print:block font-bold text-xl",children:["التاريخ: ",C]})]}),e.jsx("div",{className:"overflow-x-auto border-2 border-slate-200 rounded-lg mt-4",children:e.jsxs("table",{className:"w-full text-center text-sm",children:[e.jsx("thead",{className:"bg-slate-100 text-slate-800 font-bold border-b-2 border-slate-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 border-r border-slate-200",children:"#"}),e.jsx("th",{className:"p-3 border-r border-slate-200",children:"رقم المكنة"}),e.jsx("th",{className:"p-3 border-r border-slate-200",children:"اسم العامل"}),e.jsx("th",{className:"p-3 border-r border-slate-200 bg-blue-50",children:"العداد الحالي"}),e.jsx("th",{className:"p-3 border-r border-slate-200 bg-orange-50",children:"العداد السابق"}),e.jsx("th",{className:"p-3 border-r border-slate-200 bg-emerald-50",children:"عدد البيع (لترات)"}),e.jsx("th",{className:"p-3 border-r border-slate-200",children:"سعر اللتر"}),e.jsx("th",{className:"p-3 bg-indigo-50",children:"مبلغ البيع"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200",children:t?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"p-8 text-center text-slate-400",children:"جاري التحميل..."})}):((v=p==null?void 0:p.sales)==null?void 0:v.length)>0?p.sales.map((g,h)=>e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors bg-white",children:[e.jsx("td",{className:"p-2 border-r border-slate-100 font-mono text-slate-400",children:h+1}),e.jsxs("td",{className:"p-2 border-r border-slate-100 font-bold",children:[g.machine_name," ",e.jsxs("span",{className:"text-xs text-slate-400",children:["(",g.fuel_type,")"]})]}),e.jsx("td",{className:"p-2 border-r border-slate-100",children:g.worker_name}),e.jsx("td",{className:"p-2 border-r border-slate-100 font-mono font-bold text-blue-700",children:f(g.current_counter)}),e.jsx("td",{className:"p-2 border-r border-slate-100 font-mono text-slate-600",children:f(g.previous_counter)}),e.jsx("td",{className:"p-2 border-r border-slate-100 font-mono font-bold text-emerald-600 text-lg bg-emerald-50/30",children:f(g.volume_sold)}),e.jsx("td",{className:"p-2 border-r border-slate-100 font-mono",children:f(g.price_per_liter)}),e.jsx("td",{className:"p-2 font-mono font-bold text-indigo-700 bg-indigo-50/30",children:f(g.total_amount)})]},h)):e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"p-8 text-center text-slate-400",children:"لا توجد مبيعات مسجلة في هذا التاريخ"})})}),(p==null?void 0:p.totals)&&e.jsx("tfoot",{className:"bg-slate-800 text-white font-bold border-t-2 border-slate-800",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"5",className:"p-3 text-left pl-6",children:"الإجمالي الكلي"}),e.jsx("td",{className:"p-3 font-mono text-emerald-300 text-lg",children:f(p.totals.total_liters)}),e.jsx("td",{className:"p-3"}),e.jsx("td",{className:"p-3 font-mono text-indigo-300 text-lg",children:f(p.totals.total_amount)})]})})]})}),((j=p==null?void 0:p.tanks)==null?void 0:j.length)>0&&e.jsx("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.tanks.map((g,h)=>e.jsxs("div",{className:"border-2 border-slate-200 rounded-xl overflow-hidden print:border-slate-800 print:break-inside-avoid",children:[e.jsxs("div",{className:"bg-slate-50 p-3 border-b border-slate-200 flex justify-between items-center",children:[e.jsx("div",{className:"font-bold text-slate-700",children:g.tank_name}),e.jsx(oe,{size:"xs",color:g.fuel_type.includes("Benzine")?"emerald":"amber",children:g.fuel_type})]}),e.jsxs("div",{className:"p-4 space-y-3 bg-white text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center border-b border-dashed border-slate-100 pb-2",children:[e.jsx("span",{className:"text-slate-500",children:"كمية البير السابقة (Opening)"}),e.jsx("span",{className:"font-mono font-bold",children:f(g.opening_balance)})]}),e.jsxs("div",{className:"flex justify-between items-center text-emerald-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_e,{className:"w-3 h-3"})," وارد (Purchases)"]}),e.jsxs("span",{className:"font-mono font-bold",children:["+",f(g.purchases_in)]})]}),e.jsxs("div",{className:"flex justify-between items-center text-rose-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Se,{className:"w-3 h-3"})," مبيعات (Sales)"]}),e.jsxs("span",{className:"font-mono font-bold",children:["-",f(g.sales_out)]})]}),e.jsxs("div",{className:"flex justify-between items-center bg-slate-50 p-2 rounded-lg",children:[e.jsx("span",{className:"text-slate-700 font-bold",children:"الرصيد الدفتري (Theoretical)"}),e.jsx("span",{className:"font-mono font-bold text-blue-700",children:f(g.theoretical_balance)})]}),e.jsxs("div",{className:"flex justify-between items-center border-b border-dashed border-slate-100 pb-2",children:[e.jsx("span",{className:"text-slate-500",children:"المعايرة الفعلية (Actual)"}),e.jsx("span",{className:"font-mono font-bold text-slate-800",children:f(g.actual_balance)})]}),e.jsxs("div",{className:"flex justify-between items-center pt-1",children:[e.jsx("span",{className:"font-bold text-slate-700",children:"زيادة / عجز (Variance)"}),e.jsx("span",{className:`font-mono font-black text-lg ${g.variance<0?"text-red-600":"text-emerald-600"}`,children:f(g.variance)})]})]})]},h))})]})})}function ze({stationId:q}){var l;const[C,w]=k.useState([]),[p,R]=k.useState(""),[t,P]=k.useState(new Date().toISOString().split("T")[0]),[u,f]=k.useState(null),[Q,v]=k.useState(!1);k.useEffect(()=>{j()},[q]),k.useEffect(()=>{p&&g()},[p,t]);const j=async()=>{try{const n=new URLSearchParams({action:"get_stats",station_id:q||"all"}).toString(),S=await(await fetch(`${window.BASE_URL||""}/reports?${n}`)).json();if(S.success&&S.warehouse&&S.warehouse.tanks){const a=S.warehouse.tanks.map(r=>({id:r.id||r.name,name:r.name,fuel_type:r.fuel}));w(a),a.length>0?a.find(d=>d.id==p)||R(a[0].id):(R(""),f(null))}}catch(n){console.error("Failed to fetch tanks:",n),I.error("فشل تحميل قائمة الخزانات")}},g=async()=>{v(!0);try{const n=new URLSearchParams({action:"get_tank_sales",tank_id:p,date:t}).toString(),S=await(await fetch(`${window.BASE_URL||""}/reports?${n}`)).json();S.success?f(S):I.error(S.message||"فشل تحميل التقرير")}catch(n){console.error(n),I.error("خطأ في الاتصال")}finally{v(!1)}},h=n=>parseFloat(n||0).toLocaleString("en-US",{maximumFractionDigits:2}),T=()=>{window.print()};return e.jsx("div",{className:"space-y-6 animate-fade-in p-4 print:p-0",children:e.jsxs(y,{className:"bg-white print:shadow-none print:border-none dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 mb-6 print:mb-4",children:[e.jsxs("div",{className:"text-center md:text-right",children:[e.jsxs(A,{className:"text-2xl font-black text-slate-800 dark:text-white",children:["تقرير مبيعات البير رقم ",((l=u==null?void 0:u.tank)==null?void 0:l.name)||""]}),e.jsxs(o,{className:"text-slate-500 dark:text-slate-400",children:["التاريخ: ",new Date(t).toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 print:hidden",children:[e.jsxs("select",{value:p,onChange:n=>R(n.target.value),className:"px-4 py-2 border-2 border-slate-200 rounded-xl font-bold text-slate-700 focus:border-blue-500 outline-none transition-colors dark:bg-slate-800 dark:border-slate-700 dark:text-white",children:[e.jsx("option",{value:"",children:"اختر البير"}),C.map(n=>e.jsxs("option",{value:n.id,children:[n.name," - ",n.fuel_type]},n.id))]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:t,onChange:n=>P(n.target.value),className:"pl-3 pr-10 py-2 border-2 border-slate-200 rounded-xl font-bold text-slate-700 focus:border-blue-500 outline-none transition-colors dark:bg-slate-800 dark:border-slate-700 dark:text-white"}),e.jsx(ke,{className:"w-5 h-5 text-slate-400 absolute right-3 top-2.5 pointer-events-none"})]}),e.jsx("button",{onClick:()=>{const n=window.open("","_blank"),$=document.querySelector(".overflow-x-auto"),S=$?$.innerHTML:"<p>لا توجد بيانات</p>";n.document.write(`
                                    <html dir="rtl" lang="ar">
                                    <head>
                                        <title>معاينة تقرير مبيعات البير</title>
                                        <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
                                        <style>
                                            * { box-sizing: border-box; margin: 0; padding: 0; }
                                            body { 
                                                font-family: 'Cairo', sans-serif; 
                                                background: #f0f0f0; 
                                                padding: 20px;
                                                display: flex;
                                                justify-content: center;
                                            }
                                            .a4-page {
                                                width: 210mm;
                                                min-height: 297mm;
                                                background: white url('${window.BASE_URL||""}/img/background.png') no-repeat center center;
                                                background-size: cover;
                                                padding: 8mm 15mm 15mm 15mm;
                                                box-shadow: 0 0 20px rgba(0,0,0,0.15);
                                                position: relative;
                                            }
                                            .report-header {
                                                display: flex;
                                                justify-content: space-between;
                                                align-items: center;
                                                border-bottom: 3px solid #374151;
                                                padding-bottom: 15px;
                                                margin-bottom: 20px;
                                            }
                                            .logo-section img {
                                                height: 60px;
                                                width: auto;
                                            }
                                            .title-section {
                                                text-align: center;
                                                flex: 1;
                                            }
                                            .title-section h1 {
                                                font-size: 20px;
                                                font-weight: 900;
                                                color: #1f2937;
                                                margin-bottom: 5px;
                                            }
                                            .title-section p {
                                                font-size: 14px;
                                                color: #6b7280;
                                            }
                                            table { width: 100%; border-collapse: collapse; margin-top: 15px; }
                                            th, td { border: 1px solid #333; padding: 8px; text-align: center; font-size: 11px; }
                                            th { background: #374151; color: white; font-weight: bold; }
                                            tfoot td { font-weight: bold; }
                                            .print\\:hidden { display: none !important; }
                                            @media print {
                                                body { background: white; padding: 0; }
                                                .a4-page { box-shadow: none; padding: 10mm; }
                                            }
                                        </style>
                                    </head>
                                    <body>
                                        <div class="a4-page">
                                            <div class="report-header">
                                                <div class="logo-section">
                                                    <img src="${window.BASE_URL||""}/img/logo.png" alt="Petro Diesel" />
                                                </div>
                                                <div class="title-section">
                                                    <h1>تقرير مبيعات البير</h1>
                                                    <p>التاريخ: ${new Date(t).toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric"})}</p>
                                                </div>
                                                <div class="logo-section" style="visibility: hidden;">
                                                    <img src="${window.BASE_URL||""}/img/logo.png" alt="" />
                                                </div>
                                            </div>
                                            ${S}
                                        </div>
                                    </body>
                                    </html>
                                `),n.document.close()},className:"p-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-xl transition-colors dark:bg-blue-900/30 dark:text-blue-400 dark:hover:bg-blue-900/50",title:"معاينة التقرير",children:e.jsx(De,{className:"w-5 h-5"})}),e.jsx("button",{onClick:T,className:"p-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-xl transition-colors dark:bg-slate-800 dark:text-white dark:hover:bg-slate-700",children:e.jsx(ve,{className:"w-5 h-5"})})]})]}),p?Q?e.jsx("div",{className:"text-center py-12",children:e.jsx(o,{className:"text-slate-400",children:"جاري التحميل..."})}):u?e.jsx(e.Fragment,{children:e.jsx("div",{className:"overflow-x-auto border-2 border-slate-800 rounded-lg mt-4 dark:border-white/10",children:e.jsxs("table",{className:"w-full text-center text-sm border-collapse",children:[e.jsx("thead",{className:"bg-slate-700 text-white font-bold dark:bg-white/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 border border-slate-600 dark:border-white/10",children:"رقم المكنة"}),e.jsx("th",{className:"p-3 border border-slate-600 dark:border-white/10",children:"الاسم العامل"}),e.jsx("th",{className:"p-3 border border-slate-600 dark:border-white/10",children:"العداد الحالي"}),e.jsx("th",{className:"p-3 border border-slate-600 dark:border-white/10",children:"العداد السابق"}),e.jsx("th",{className:"p-3 border border-slate-600 dark:border-white/10",children:"عدد البيع لترات"}),e.jsx("th",{className:"p-3 border border-slate-600 dark:border-white/10 bg-blue-600",children:"عدد البيع جالون"}),e.jsx("th",{className:"p-3 border border-slate-600 dark:border-white/10",children:"سعر اللتر"}),e.jsx("th",{className:"p-3 border border-slate-600 dark:border-white/10",children:"اجمالي مبلغ البيع"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-300 dark:divide-white/10",children:u.sales.length>0?u.sales.map((n,$)=>{const S=parseFloat(n.volume_sold||0)/3.78541;return e.jsxs("tr",{className:"hover:bg-slate-50 bg-white dark:bg-white/5 dark:hover:bg-white/10 text-slate-800 dark:text-slate-200",children:[e.jsx("td",{className:"p-2 border border-slate-300 font-bold dark:border-white/10",children:n.machine_name}),e.jsx("td",{className:"p-2 border border-slate-300 dark:border-white/10",children:n.worker_name}),e.jsx("td",{className:"p-2 border border-slate-300 font-mono dark:border-white/10",children:h(n.current_counter)}),e.jsx("td",{className:"p-2 border border-slate-300 font-mono dark:border-white/10",children:h(n.previous_counter)}),e.jsx("td",{className:"p-2 border border-slate-300 font-mono font-bold text-blue-700 dark:text-blue-400 dark:border-white/10",children:h(n.volume_sold)}),e.jsx("td",{className:"p-2 border border-slate-300 font-mono font-bold text-blue-700 bg-blue-50 dark:text-blue-400 dark:border-white/10 dark:bg-blue-900/20",children:h(S)}),e.jsx("td",{className:"p-2 border border-slate-300 font-mono dark:border-white/10",children:h(n.price_per_liter)}),e.jsx("td",{className:"p-2 border border-slate-300 font-mono font-bold dark:border-white/10",children:h(n.total_amount)})]},$)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"p-8 text-center text-slate-400 border border-slate-300 dark:border-white/10 dark:bg-white/5",children:"لا توجد مبيعات لهذا البير في هذا التاريخ"})})}),e.jsxs("tfoot",{className:"bg-slate-100 font-bold text-slate-800 dark:bg-white/5 dark:text-white",children:[e.jsxs("tr",{className:"border-t-2 border-slate-800 dark:border-white/10 bg-yellow-50 dark:bg-yellow-900/20",children:[e.jsx("td",{colSpan:"4",className:"p-3 text-right border border-slate-300 dark:border-white/10 font-black",children:"اجمالي البيع"}),e.jsx("td",{className:"p-3 font-mono text-blue-700 text-lg border border-slate-300 dark:text-blue-400 dark:border-white/10",children:h(u.summary.total_volume_sold)}),e.jsx("td",{className:"p-3 font-mono text-blue-700 text-lg border border-slate-300 bg-blue-50 dark:text-blue-400 dark:border-white/10 dark:bg-blue-900/20",children:h(parseFloat(u.summary.total_volume_sold||0)/3.78541)}),e.jsx("td",{className:"p-3 border border-slate-300 dark:border-white/10"}),e.jsx("td",{className:"p-3 font-mono text-lg border border-slate-300 dark:border-white/10",children:h(u.summary.total_amount)})]}),e.jsxs("tr",{className:"bg-white dark:bg-white/5",children:[e.jsx("td",{colSpan:"4",className:"p-3 text-right border border-slate-300 dark:border-white/10",children:"كمية البير السابقة قبل البيع"}),e.jsx("td",{className:"p-3 font-mono text-lg border border-slate-300 dark:border-white/10",children:h(u.summary.opening_balance)}),e.jsx("td",{className:"p-3 font-mono text-lg border border-slate-300 bg-blue-50 dark:border-white/10 dark:bg-blue-900/20",children:h(parseFloat(u.summary.opening_balance||0)/3.78541)}),e.jsx("td",{colSpan:"2",className:"p-3 border border-slate-300 dark:border-white/10"})]}),e.jsxs("tr",{className:"bg-white dark:bg-white/5",children:[e.jsx("td",{colSpan:"4",className:"p-3 text-right border border-slate-300 dark:border-white/10",children:"الكمية البير بعد البيع وقبل المعايره"}),e.jsx("td",{className:"p-3 font-mono text-lg border border-slate-300 dark:border-white/10",children:h(u.summary.theoretical_closing)}),e.jsx("td",{className:"p-3 font-mono text-lg border border-slate-300 bg-blue-50 dark:border-white/10 dark:bg-blue-900/20",children:h(parseFloat(u.summary.theoretical_closing||0)/3.78541)}),e.jsx("td",{colSpan:"2",className:"p-3 border border-slate-300 dark:border-white/10"})]}),e.jsxs("tr",{className:"bg-white dark:bg-white/5",children:[e.jsx("td",{colSpan:"4",className:"p-3 text-right border border-slate-300 dark:border-white/10",children:"الكمية المعايرة بعد البيع"}),e.jsx("td",{className:"p-3 font-mono text-lg border border-slate-300 dark:border-white/10",children:h(u.summary.actual_closing)}),e.jsx("td",{className:"p-3 font-mono text-lg border border-slate-300 bg-blue-50 dark:border-white/10 dark:bg-blue-900/20",children:h(parseFloat(u.summary.actual_closing||0)/3.78541)}),e.jsx("td",{colSpan:"2",className:"p-3 border border-slate-300 dark:border-white/10"})]}),e.jsxs("tr",{className:"bg-slate-200 dark:bg-white/10",children:[e.jsx("td",{colSpan:"4",className:"p-3 text-right font-black border border-slate-300 dark:border-white/10",children:"المعايره عجز زياده"}),e.jsxs("td",{className:`p-3 font-mono font-black text-xl border border-slate-300 dark:border-white/10 ${parseFloat(u.summary.variance||0)<0?"text-red-600 bg-red-50 dark:text-red-400 dark:bg-red-900/20":"text-emerald-600 bg-emerald-50 dark:text-emerald-400 dark:bg-emerald-900/20"}`,children:[parseFloat(u.summary.variance||0)<0?"-":"+",h(Math.abs(parseFloat(u.summary.variance||0)))]}),e.jsxs("td",{className:`p-3 font-mono font-black text-xl border border-slate-300 dark:border-white/10 ${parseFloat(u.summary.variance||0)<0?"text-red-600 bg-red-50 dark:text-red-400 dark:bg-red-900/20":"text-emerald-600 bg-emerald-50 dark:text-emerald-400 dark:bg-emerald-900/20"}`,children:[parseFloat(u.summary.variance||0)<0?"-":"+",h(Math.abs(parseFloat(u.summary.variance||0)/3.78541))]}),e.jsx("td",{colSpan:"2",className:"p-3 border border-slate-300 dark:border-white/10"})]})]})]})})}):null:e.jsx("div",{className:"text-center py-12 text-slate-400",children:e.jsx(o,{children:"الرجاء اختيار بير لعرض التقرير"})})]})})}function Be({stationId:q}){const[C,w]=k.useState(!1),[p,R]=k.useState([]),[t,P]=k.useState(null),[u,f]=k.useState({supplier_id:"",period:"month",start_date:new Date().toISOString().split("T")[0],end_date:new Date().toISOString().split("T")[0]});k.useEffect(()=>{Q()},[]);const Q=async()=>{try{const n=await(await fetch(`${window.BASE_URL}/reports?action=get_sources&type=supplier`)).json();n.suppliers&&R(n.suppliers)}catch(l){console.error("Failed to fetch suppliers",l)}},v=async()=>{if(u.supplier_id){w(!0);try{const l=new URLSearchParams({action:"get_supplier_report",station_id:q,...u}).toString(),$=await(await fetch(`${window.BASE_URL}/reports?${l}`,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json();$.success?P($.data):I.error($.message||"فشل تحميل التقرير")}catch(l){console.error(l),I.error("حدث خطأ أثناء تحميل البيانات")}finally{w(!1)}}};k.useEffect(()=>{u.supplier_id&&v()},[u.supplier_id,u.period,u.start_date,u.end_date]);const j=l=>{const n=new Date;let $=new Date;const S=new Date;l==="day"||(l==="week"?$.setDate(n.getDate()-7):l==="month"?$.setDate(1):l==="year"&&$.setMonth(0,1)),f(a=>({...a,period:l,start_date:$.toISOString().split("T")[0],end_date:S.toISOString().split("T")[0]}))},g=l=>h(l)+" SDG",h=l=>parseFloat(l||0).toLocaleString("en-US"),T=[{id:"day",label:"اليوم"},{id:"week",label:"أسبوع"},{id:"month",label:"شهر"},{id:"year",label:"سنة"},{id:"custom",label:"مخصص"}];return e.jsxs("div",{className:"space-y-6 animate-fade-in pb-10",children:[e.jsxs(y,{className:"bg-white/80 backdrop-blur-md p-4 shadow-sm rounded-2xl border border-slate-100/50 sticky top-0 z-20 dark:bg-white/5 dark:border-white/10 dark:ring-white/10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsx("div",{className:"flex flex-wrap items-center gap-2 justify-center md:justify-start w-full md:w-auto order-2 md:order-1",children:e.jsx("div",{className:"bg-slate-100 p-1 rounded-xl flex gap-1 dark:bg-slate-800",children:T.map(l=>e.jsx("button",{onClick:()=>j(l.id),className:`px-4 py-1.5 rounded-lg text-sm font-bold transition-all duration-300 ${u.period===l.id?"bg-white text-blue-600 shadow-sm scale-105 dark:bg-blue-600 dark:text-white":"text-slate-500 hover:text-slate-700 hover:bg-slate-200/50 dark:text-slate-400 dark:hover:text-slate-200 dark:hover:bg-slate-700"}`,children:l.label},l.id))})}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-4 w-full md:w-auto order-1 md:order-2",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-600 to-cyan-500 rounded-xl text-white shadow-lg shadow-cyan-200",children:[e.jsx(ne,{className:"w-5 h-5"}),e.jsx("span",{className:"font-bold text-lg whitespace-nowrap",children:"كشف حساب مورد"})]}),e.jsxs("div",{className:"w-full md:w-64 relative",children:[e.jsx(je,{className:"w-4 h-4 text-slate-400 absolute right-3 top-3 pointer-events-none"}),e.jsxs("select",{value:u.supplier_id,onChange:l=>f(n=>({...n,supplier_id:l.target.value})),className:"w-full h-10 pr-9 pl-3 bg-slate-50 border border-slate-200 rounded-lg text-sm font-bold text-slate-700 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all outline-none appearance-none dark:bg-slate-800 dark:border-slate-700 dark:text-white",children:[e.jsx("option",{value:"",children:"اختر المورد..."}),p.map(l=>e.jsx("option",{value:String(l.id),children:l.name},l.id))]})]})]})]}),e.jsx(fe,{children:u.period==="custom"&&e.jsx(H.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100 flex items-center justify-start gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 ml-2",children:"من تاريخ"}),e.jsx("input",{type:"date",value:u.start_date,onChange:l=>f(n=>({...n,start_date:l.target.value})),className:"bg-slate-50 border border-slate-200 text-slate-700 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2 outline-none dark:bg-slate-800 dark:border-slate-700 dark:text-white"})]}),e.jsx("div",{className:"flex items-center self-end pb-2",children:e.jsx("span",{className:"text-slate-300",children:"-----"})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 ml-2",children:"إلى تاريخ"}),e.jsx("input",{type:"date",value:u.end_date,onChange:l=>f(n=>({...n,end_date:l.target.value})),className:"bg-slate-50 border border-slate-200 text-slate-700 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2 outline-none dark:bg-slate-800 dark:border-slate-700 dark:text-white"})]})]})})})]}),u.supplier_id?!t&&C?e.jsxs("div",{className:"text-center py-24",children:[e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4 shadow-xl shadow-blue-200"}),e.jsx(o,{className:"text-blue-600 font-bold animate-pulse",children:"جاري جلب البيانات..."})]}):t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(H.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.1},children:e.jsxs(y,{decoration:"top",decorationColor:"emerald",className:"bg-white hover:shadow-lg transition-shadow dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",children:[e.jsx(o,{className:"dark:text-slate-400",children:"إجمالي المدفوعات (لنا)"}),e.jsx(B,{className:"mt-2 text-emerald-600 drop-shadow-sm dark:text-emerald-400",children:g(t.totals.total_paid)})]})}),e.jsx(H.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.2},children:e.jsxs(y,{decoration:"top",decorationColor:"blue",className:"bg-white hover:shadow-lg transition-shadow dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",children:[e.jsx(o,{className:"dark:text-slate-400",children:"إجمالي المشتريات (علينا)"}),e.jsx(B,{className:"mt-2 text-blue-600 drop-shadow-sm dark:text-blue-400",children:g(t.totals.total_purchased)})]})}),e.jsx(H.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.3},children:e.jsxs(y,{decoration:"top",decorationColor:t.totals.net_balance>0?"rose":"teal",className:"bg-white hover:shadow-lg transition-shadow dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",children:[e.jsx(o,{className:"dark:text-slate-400",children:"صافي الرصيد النهائي"}),e.jsx(B,{className:`mt-2 ${t.totals.net_balance>0?"text-rose-600 dark:text-rose-400":"text-teal-600 dark:text-teal-400"} drop-shadow-sm`,children:g(t.totals.net_balance)}),e.jsx(o,{className:"text-xs text-slate-400 mt-1",children:t.totals.net_balance>0?"مبلغ مستحق للمورد":"فائض مدفوع"})]})})]}),e.jsx(y,{className:"px-0 py-0 overflow-hidden bg-white shadow-lg rounded-2xl border border-slate-100 dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",children:e.jsxs("div",{className:"overflow-x-auto min-h-[400px]",children:[C&&e.jsx("div",{className:"absolute inset-0 bg-white/50 backdrop-blur-[1px] z-10 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full"})}),e.jsxs("table",{className:"w-full text-right text-base",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-600 font-bold border-b border-slate-200 dark:bg-white/5 dark:text-slate-400 dark:border-white/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 whitespace-nowrap",children:"التاريخ"}),e.jsx("th",{className:"p-4 whitespace-nowrap",children:"البيان"}),e.jsx("th",{className:"p-4 whitespace-nowrap",children:"التصنيف"}),e.jsx("th",{className:"p-4 whitespace-nowrap",children:"الكمية"}),e.jsx("th",{className:"p-4 whitespace-nowrap",children:"السعر"}),e.jsx("th",{className:"p-4 whitespace-nowrap text-emerald-600",children:"المبلغ (المورد)"}),e.jsx("th",{className:"p-4 whitespace-nowrap text-blue-600",children:"قيمة الشراء"}),e.jsx("th",{className:"p-4 whitespace-nowrap",children:"الإجمالي (تراكمي)"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-white/10",children:e.jsx(fe,{mode:"wait",children:t.transactions.length>0?t.transactions.map((l,n)=>e.jsxs(H.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,scale:.98},transition:{delay:n*.02},className:"hover:bg-blue-50/50 transition-colors group dark:hover:bg-white/5",children:[e.jsx("td",{className:"p-4 whitespace-nowrap text-slate-500 font-mono text-sm dark:text-slate-400",children:l.date}),e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"font-bold text-slate-800 text-lg dark:text-white",children:l.statement_title}),e.jsx("div",{className:"text-sm text-slate-400 group-hover:text-slate-500 dark:text-slate-500 dark:group-hover:text-slate-400",children:l.statement_subtitle})]}),e.jsx("td",{className:"p-4",children:e.jsxs("span",{className:`px-2 py-1 rounded-full text-sm font-bold inline-flex items-center gap-1 ${l.type==="purchase"?"bg-blue-100 text-blue-700":"bg-emerald-100 text-emerald-700"}`,children:[l.type==="purchase"?e.jsx($e,{className:"w-4 h-4"}):e.jsx(Ce,{className:"w-4 h-4"}),l.category]})}),e.jsx("td",{className:"p-4 font-mono text-lg text-slate-600 dark:text-slate-300",children:l.quantity?h(l.quantity):"-"}),e.jsx("td",{className:"p-4 font-mono text-slate-400 text-sm dark:text-slate-500",children:l.price?h(l.price):"-"}),e.jsx("td",{className:"p-4 font-mono font-bold text-lg text-emerald-600 dark:text-emerald-400",children:l.amount_paid?h(l.amount_paid):"-"}),e.jsx("td",{className:"p-4 font-mono font-bold text-lg text-blue-600 dark:text-blue-400",children:l.purchase_value?h(l.purchase_value):"-"}),e.jsx("td",{className:"p-4 font-bold text-lg",dir:"ltr",children:e.jsx("span",{className:l.running_balance>=0?"text-emerald-600 dark:text-emerald-400":"text-rose-600 dark:text-rose-400",children:h(l.running_balance)})})]},n)):e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"p-12 text-center text-slate-400",children:"لا توجد حركات في هذه الفترة"})})})}),e.jsx("tfoot",{className:"bg-slate-900 text-white font-bold border-t-2 border-slate-700",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"5",className:"p-4 text-left",children:"الإجماليات الكلية:"}),e.jsx("td",{className:"p-4 text-emerald-400",children:h(t.totals.total_paid)}),e.jsx("td",{className:"p-4 text-blue-400",children:h(t.totals.total_purchased)}),e.jsx("td",{className:"p-4",dir:"ltr",children:e.jsx("span",{className:t.totals.net_balance>=0?"text-emerald-400":"text-rose-400",children:h(t.totals.net_balance)})})]})})]})]})}),t.transactions.length>0&&e.jsxs("div",{className:"grid grid-cols-3 gap-1 bg-slate-900 text-white font-bold p-4 rounded-xl mt-4 border-t-2 border-slate-700 dark:bg-white/5 dark:border-white/10 dark:text-slate-200 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-slate-400 text-xs mb-1",children:"المدفوع"}),e.jsx("div",{className:"text-emerald-400",children:h(t.totals.total_paid)})]}),e.jsxs("div",{className:"text-center border-r border-slate-700 dark:border-white/10",children:[e.jsx("div",{className:"text-slate-400 text-xs mb-1",children:"مشتريات"}),e.jsx("div",{className:"text-blue-400",children:h(t.totals.total_purchased)})]}),e.jsxs("div",{className:"text-center border-r border-slate-700 dark:border-white/10",children:[e.jsx("div",{className:"text-slate-400 text-xs mb-1",children:"الرصيد"}),e.jsx("div",{dir:"ltr",className:t.totals.net_balance>=0?"text-emerald-400":"text-rose-400",children:h(t.totals.net_balance)})]})]})]}):null:e.jsxs(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-24 bg-white rounded-3xl border border-slate-100 shadow-sm dark:bg-white/5 dark:backdrop-blur-md dark:border-white/10",children:[e.jsx(je,{className:"w-20 h-20 text-slate-200 mx-auto mb-4 dark:text-slate-600"}),e.jsx(A,{className:"text-slate-700 text-xl font-bold dark:text-white",children:"حدد المورد لعرض التقرير"}),e.jsx(o,{className:"text-slate-400",children:"يمكنك اختيار المورد من القائمة أعلاه"})]})]})}function qe({initialGroup:q}){const C=new Date;new Date(C.getFullYear(),C.getMonth(),1).toLocaleDateString("en-CA"),C.toLocaleDateString("en-CA");const[w,p]=k.useState({source_type:"safe",source_id:"",start_date:null,end_date:null,group_sales:q||"none"}),[R,t]=k.useState("month"),[P,u]=k.useState({safes:[],banks:[]}),[f,Q]=k.useState(null),[v,j]=k.useState(!1);k.useEffect(()=>{g()},[]),k.useEffect(()=>{if(w.source_id){if(w.start_date>w.end_date){I.warning("تم تصحيح التاريخ: تاريخ البداية لا يمكن أن يكون بعد النهاية"),p(a=>({...a,start_date:a.end_date,end_date:a.start_date}));return}h()}},[w.source_id,w.source_type,w.start_date,w.end_date,w.group_sales]);const g=async()=>{try{const r=await(await fetch(`${window.BASE_URL||""}/reports?action=get_sources`)).json();r.success&&(u({safes:r.safes||[],banks:r.banks||[]}),w.source_id||(r.safes&&r.safes.length>0?p(d=>({...d,source_type:"safe",source_id:r.safes[0].id})):r.banks&&r.banks.length>0&&p(d=>({...d,source_type:"bank",source_id:r.banks[0].id}))))}catch(a){console.error("Failed to fetch sources:",a),I.error("فشل تحميل قائمة الحسابات")}},h=async()=>{if(w.source_id){j(!0);try{const a=new URLSearchParams({id:w.source_id,start_date:w.start_date,end_date:w.end_date}),r=w.source_type==="safe"?`${window.BASE_URL||""}/finance/getSafeDetails?${a.toString()}`:`${window.BASE_URL||""}/finance/getBankDetails?${a.toString()}`,d=await fetch(r);if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);const c=await d.json();if(c.success){let m=c.transactions||[];if(w.group_sales==="fuel_type"){const i={},N=[];m.forEach(x=>{let _=x.fuel_name;!_&&x.description&&(x.description.includes("جاز")||x.description.toLowerCase().includes("diesel")?_="جاز":(x.description.includes("بنزين")||x.description.toLowerCase().includes("benzene"))&&(_="بنزين"));const F=(x.description||"").toLowerCase(),z=(x.category_name||"").toLowerCase(),G=(x.tank_name||"").toLowerCase();_||(F.includes("جاز")||F.includes("diesel")||z.includes("جاز")||z.includes("diesel")||G.includes("جاز")||G.includes("diesel")?_="جاز":(F.includes("بنزين")||F.includes("benzene")||z.includes("بنزين")||z.includes("benzene")||G.includes("بنزين")||G.includes("benzene"))&&(_="بنزين"));const X=["sales","sale"].includes(x.related_entity_type)||z.includes("مبيعات")||F.includes("مبيعات")||F.includes("محروقات")||F.includes("عملية")||F.includes("sale")||F.includes("fuel");if(X&&!_&&(_="وقود (غير محدد)"),X&&_){const Y=`${x.created_at?x.created_at.split(" ")[0]:x.date}_${_}`;i[Y]||(i[Y]={...x,id:`group_${Math.random()}`,description:`إجمالي مبيعات ${_}`,fuel_name:_,original_amount:0,amount:0,user_name:"-",created_at:x.created_at||x.date}),i[Y].amount=(parseFloat(i[Y].amount)+parseFloat(x.amount)).toString()}else N.push(x)}),m=[...Object.values(i),...N].sort((x,_)=>{const F=x.id.toString().startsWith("group_"),z=_.id.toString().startsWith("group_");if(F&&z)return parseFloat(_.amount)-parseFloat(x.amount);if(F)return-1;if(z)return 1;const G=x.created_at||x.date,X=_.created_at||_.date;return new Date(X)-new Date(G)})}const D=m.map(i=>{const N=i.to_type===w.source_type&&i.to_id==w.source_id;return{date:i.created_at?i.created_at.split(" ")[0]:i.date,id:i.id,type:i.type,category:i.category_name||"عام",description:i.description,user_name:i.user_name||null,beneficiary:i.beneficiary_name||null,fuel_name:i.fuel_name||null,amount_in:N?parseFloat(i.amount):0,amount_out:N?0:parseFloat(i.amount),balance:0,is_sale:i.related_entity_type==="sales"}});let b=0;D.forEach(i=>{b+=i.amount_in,b-=i.amount_out,i.balance=b}),Q({success:!0,summary:{opening_balance:0,closing_balance:b,total_sales:0,total_other_income:0,total_expenses:0,total_transfers_in:0,total_transfers_out:0},movements:D})}else I.error(c.message||"فشل تحميل التقرير")}catch(a){console.error("Fetch error:",a),I.error(`خطأ في الاتصال: ${a.message}`)}finally{j(!1)}}},T=(a,r)=>{var d,c;if(a==="source_type"){const m=r==="safe"?((d=P.safes[0])==null?void 0:d.id)||"":((c=P.banks[0])==null?void 0:c.id)||"";p(D=>({...D,source_type:r,source_id:m}))}else p(m=>({...m,[a]:r}))};k.useEffect(()=>{(async()=>{try{const d=await(await fetch(`${window.BASE_URL||""}/api/server-time`)).json();if(d.success){const c=d.date,[m,D,b]=c.split("-"),i=`${m}-${D}-01`;p(N=>({...N,start_date:i,end_date:c}))}}catch{console.warn("Using client date fallback");const d=new Date,c=d.toLocaleDateString("en-CA"),m=new Date(d.getFullYear(),d.getMonth(),1).toLocaleDateString("en-CA");p(D=>({...D,start_date:m,end_date:c}))}})()},[]);const l=async a=>{t(a);let r;try{const x=await(await fetch(`${window.BASE_URL||""}/api/server-time`)).json();x.success&&(r=x.date)}catch{console.warn("Server date fetch failed")}const d=r||new Date().toISOString().split("T")[0],[c,m,D]=d.split("-");let b,i;switch(a){case"today":b=i=d;break;case"week":const N=new Date(d);N.setDate(N.getDate()-6),b=N.toISOString().split("T")[0],i=d;break;case"month":b=`${c}-${m}-01`,i=d;break;case"quarter":const x=Math.floor((parseInt(m)+2)/3),_=String((x-1)*3+1).padStart(2,"0");b=`${c}-${_}-01`,i=d;break;case"year":b=`${c}-01-01`,i=d;break;case"all":b="2024-01-01",i=d;break;case"custom":return}a!=="custom"&&p(N=>({...N,start_date:b,end_date:i}))},n=()=>w.source_type==="safe"?P.safes:P.banks,$=a=>parseFloat(a||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})+" SDG",S=a=>a?parseFloat(a).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"0";return e.jsxs("div",{className:"space-y-6 w-full",children:[e.jsxs(H.div,{className:"bg-white p-6 rounded-2xl border border-slate-100 dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-6 dark:text-white",children:"كشف حساب"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider dark:text-slate-400",children:"نوع الحساب"}),e.jsxs("select",{value:w.source_type,onChange:a=>T("source_type",a.target.value),className:"w-full h-10 px-3 bg-slate-50 border border-slate-200 rounded-lg text-sm font-bold text-slate-700 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all outline-none dark:bg-slate-800 dark:border-slate-700 dark:text-white",children:[e.jsx("option",{value:"safe",children:"خزنة"}),e.jsx("option",{value:"bank",children:"بنك"})]})]}),e.jsxs("div",{className:"md:col-span-3 space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider dark:text-slate-400",children:"الحساب"}),e.jsxs("select",{value:w.source_id,onChange:a=>T("source_id",a.target.value),className:"w-full h-10 px-3 bg-slate-50 border border-slate-200 rounded-lg text-sm font-bold text-slate-700 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all outline-none dark:bg-slate-800 dark:border-slate-700 dark:text-white",children:[e.jsx("option",{value:"",children:"-- اختر --"}),n().map(a=>e.jsxs("option",{value:a.id,children:[a.name," (",$(a.balance),")"]},a.id))]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider dark:text-slate-400",children:"تجميع المبيعات"}),e.jsxs("select",{value:w.group_sales,onChange:a=>T("group_sales",a.target.value),className:"w-full h-10 px-3 bg-slate-50 border border-slate-200 rounded-lg text-sm font-bold text-slate-700 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all outline-none dark:bg-slate-800 dark:border-slate-700 dark:text-white",children:[e.jsx("option",{value:"none",children:"تفصيلي (بدون تجميع)"}),e.jsx("option",{value:"fuel_type",children:"حسب نوع الوقود"})]})]}),e.jsxs("div",{className:"md:col-span-5 space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider dark:text-slate-400",children:"الفترة"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>l("today"),className:`flex-1 h-10 px-2 rounded-lg text-xs font-bold transition-all ${R==="today"?"bg-blue-600 text-white shadow-md shadow-blue-200 dark:shadow-none":"bg-slate-50 text-slate-700 hover:bg-slate-100 dark:bg-slate-800 dark:text-slate-300 dark:hover:bg-slate-700"}`,children:"اليوم"}),e.jsx("button",{onClick:()=>l("week"),className:`flex-1 h-10 px-2 rounded-lg text-xs font-bold transition-all ${R==="week"?"bg-blue-600 text-white shadow-md shadow-blue-200 dark:shadow-none":"bg-slate-50 text-slate-700 hover:bg-slate-100 dark:bg-slate-800 dark:text-slate-300 dark:hover:bg-slate-700"}`,children:"الأسبوع"}),e.jsx("button",{onClick:()=>l("month"),className:`flex-1 h-10 px-2 rounded-lg text-xs font-bold transition-all ${R==="month"?"bg-blue-600 text-white shadow-md shadow-blue-200 dark:shadow-none":"bg-slate-50 text-slate-700 hover:bg-slate-100 dark:bg-slate-800 dark:text-slate-300 dark:hover:bg-slate-700"}`,children:"الشهر"}),e.jsx("button",{onClick:()=>l("custom"),className:`flex-1 h-10 px-2 rounded-lg text-xs font-bold transition-all ${R==="custom"?"bg-blue-600 text-white shadow-md shadow-blue-200 dark:shadow-none":"bg-slate-50 text-slate-700 hover:bg-slate-100 dark:bg-slate-800 dark:text-slate-300 dark:hover:bg-slate-700"}`,children:"مخصص"})]})]}),R==="custom"&&e.jsxs("div",{className:"md:col-span-12 space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider dark:text-slate-400",children:"الفترة الزمنية المخصصة"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:w.start_date,onChange:a=>T("start_date",a.target.value),className:"w-full h-[46px] px-4 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold text-slate-700 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all outline-none dark:bg-slate-800 dark:border-slate-700 dark:text-white"}),e.jsx("span",{className:"text-slate-400 font-bold dark:text-slate-500",children:"إلى"}),e.jsx("input",{type:"date",value:w.end_date,onChange:a=>T("end_date",a.target.value),className:"w-full h-[46px] px-4 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold text-slate-700 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all outline-none dark:bg-slate-800 dark:border-slate-700 dark:text-white"})]})]})]})]}),v&&e.jsxs("div",{className:"bg-white rounded-2xl p-12 text-center dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mx-auto dark:border-white/10 dark:border-t-blue-400"}),e.jsx("p",{className:"text-slate-500 mt-4 dark:text-slate-400",children:"جاري التحميل..."})]}),!v&&f&&f.movements&&e.jsxs(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",children:[e.jsxs("div",{className:"p-5 border-b border-slate-50 dark:border-white/10",children:[e.jsx("h3",{className:"font-bold text-base text-slate-800 dark:text-white",children:"كشف الحساب"}),e.jsxs("p",{className:"text-sm text-slate-500 mt-1 dark:text-slate-400",children:["عدد العمليات: ",f.movements.length]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-right text-sm",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 text-xs font-medium dark:bg-white/5 dark:text-slate-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 text-right",children:"التاريخ"}),e.jsx("th",{className:"p-4 text-right",children:"الوصف"}),e.jsx("th",{className:"p-4 text-right",children:"نوع الوقود"}),e.jsx("th",{className:"p-4 text-right",children:"المستخدم"}),e.jsx("th",{className:"p-4 text-right",children:"المستفيد"}),e.jsx("th",{className:"p-4 text-left text-emerald-600",children:"وارد"}),e.jsx("th",{className:"p-4 text-left text-rose-600",children:"منصرف"}),e.jsx("th",{className:"p-4 text-left",children:"الاجمالي"})]})}),e.jsx("tbody",{children:f.movements.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"p-8 text-center text-slate-400",children:"لا توجد عمليات في هذه الفترة"})}):f.movements.map((a,r)=>e.jsxs("tr",{className:`border-b border-slate-50 transition-colors dark:border-white/10 ${a.id.toString().startsWith("group_")?"bg-blue-50/80 hover:bg-blue-100/80 dark:bg-blue-900/20 dark:hover:bg-blue-900/30":"hover:bg-slate-50/50 dark:hover:bg-white/5"}`,children:[e.jsx("td",{className:"p-4 text-slate-500 font-mono text-sm dark:text-slate-300",children:a.date}),e.jsxs("td",{className:"p-4 font-medium text-slate-700 dark:text-white",children:[e.jsx("div",{children:a.description}),a.user_name&&e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["بواسطة: ",a.user_name]})]}),e.jsx("td",{className:"p-4 text-slate-600 text-sm dark:text-slate-300",children:a.fuel_name?e.jsx("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded-lg text-xs font-bold dark:bg-blue-500/20 dark:text-blue-300",children:a.fuel_name}):"-"}),e.jsx("td",{className:"p-4 text-slate-600 text-sm dark:text-slate-300",children:a.user_name||"-"}),e.jsx("td",{className:"p-4 text-slate-600 text-sm dark:text-slate-300",children:a.beneficiary||"-"}),e.jsx("td",{className:"p-4 text-left font-mono font-bold text-emerald-600 dark:text-emerald-400",dir:"ltr",children:a.amount_in>0?S(a.amount_in):"-"}),e.jsx("td",{className:"p-4 text-left font-mono font-bold text-rose-600 dark:text-rose-400",dir:"ltr",children:a.amount_out>0?S(a.amount_out):"-"}),e.jsx("td",{className:"p-4 text-left font-mono font-bold text-slate-700 dark:text-slate-300",dir:"ltr",children:S(a.balance)})]},r))}),f.movements.length>0&&e.jsx("tfoot",{className:"bg-slate-100 font-bold text-slate-800 border-t-2 border-slate-200 dark:bg-white/5 dark:text-white dark:border-white/10",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"5",className:"p-4 text-center text-sm uppercase tracking-wider",children:"المجموع الكلي"}),e.jsx("td",{className:"p-4 text-left font-mono text-emerald-700 dark:text-emerald-400",dir:"ltr",children:S(f.movements.reduce((a,r)=>a+(parseFloat(r.amount_in)||0),0))}),e.jsx("td",{className:"p-4 text-left font-mono text-rose-700 dark:text-rose-400",dir:"ltr",children:S(f.movements.reduce((a,r)=>a+(parseFloat(r.amount_out)||0),0))}),e.jsx("td",{className:"p-4 text-left font-mono text-blue-700 dark:text-blue-400",dir:"ltr",children:S(f.movements[f.movements.length-1].balance)})]})})]})})]}),!f&&!v&&e.jsxs("div",{className:"bg-white rounded-2xl p-12 text-center border border-slate-100 dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10",children:[e.jsx(ye,{className:"w-12 h-12 text-slate-300 mx-auto mb-4 dark:text-slate-600"}),e.jsx("p",{className:"text-slate-400 font-medium",children:"اختر حساباً لعرض التقرير"})]})]})}function Oe({user:q}){const[C,w]=k.useState(0);k.useEffect(()=>{const r=new URLSearchParams(window.location.search),d=r.get("tab"),c=r.get("subtab");d==="sales"?w(2):d==="financial"?(w(0),c==="statement"&&h(1)):d==="warehouse"&&w(1)},[]);const[p,R]=k.useState({station_id:(q==null?void 0:q.station_id)||"all",start_date:null,end_date:null,period:"month"}),[t,P]=k.useState(null),[u,f]=k.useState(!1),Q=async()=>{var r;f(!0);try{const d=new URLSearchParams({action:"get_stats",...p}).toString(),m=await(await fetch(`${window.BASE_URL||""}/reports?${d}`,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json();m.success?(console.log("📊 Reports Data:",m),console.log("📦 Warehouse Readings:",(r=m==null?void 0:m.warehouse)==null?void 0:r.readings),P(m)):I.error("فشل تحميل البيانات")}catch(d){console.error(d),I.error("خطأ في الاتصال")}finally{f(!1)}};k.useEffect(()=>{(async()=>{try{const c=await(await fetch(`${window.BASE_URL||""}/api/server-time`)).json();if(c.success){const m=c.date,[D,b,i]=m.split("-"),N=`${D}-${b}-01`;R(x=>({...x,start_date:N,end_date:m}))}}catch{console.warn("Failed to get server date, using client date");const c=new Date;R(m=>({...m,start_date:new Date(c.getFullYear(),c.getMonth(),1).toISOString().split("T")[0],end_date:c.toISOString().split("T")[0]}))}})()},[]),k.useEffect(()=>{p.start_date&&p.end_date&&Q()},[p.start_date,p.end_date]);const v=r=>parseFloat(r||0).toLocaleString("en-US",{style:"currency",currency:"USD"}).replace("$","")+" SDG",j=r=>parseFloat(r||0).toLocaleString("en-US"),[g,h]=k.useState(0),T=()=>{var r,d,c,m,D,b,i,N,x,_,F,z,G,X,Z,Y,se,ae,re,s,U,M,O,K,V,de,ee,L,ce,xe,he,me,be,pe;return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex gap-2 p-1 bg-slate-100/50 rounded-xl w-fit dark:bg-white/5",children:[e.jsx("button",{onClick:()=>h(0),className:`px-4 py-2 rounded-lg text-sm font-bold transition-all ${g===0?"bg-white shadow text-blue-700 dark:bg-blue-600 dark:text-white":"text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-white"}`,children:"نظرة عامة"}),e.jsx("button",{onClick:()=>h(1),className:`px-4 py-2 rounded-lg text-sm font-bold transition-all ${g===1?"bg-white shadow text-blue-700 dark:bg-blue-600 dark:text-white":"text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-white"}`,children:"كشف حساب (خزنة/بنك)"})]}),g===0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(y,{decoration:"top",decorationColor:"emerald",className:"bg-white dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",children:[e.jsxs(J,{justifyContent:"start",className:"space-x-4 space-x-reverse",children:[e.jsx("div",{className:"p-3 bg-emerald-100 text-emerald-600 rounded-xl dark:bg-emerald-500/20 dark:text-emerald-400",children:e.jsx(Ne,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx(o,{className:"dark:text-slate-400",children:"صافي الربح / الخسارة"}),e.jsx(B,{className:((r=t==null?void 0:t.financial)==null?void 0:r.net_profit)>=0?"text-emerald-700 dark:text-emerald-400":"text-rose-600 dark:text-rose-400",children:v((d=t==null?void 0:t.financial)==null?void 0:d.net_profit)})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100 grid grid-cols-2 gap-4 dark:border-white/10",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-xs dark:text-slate-400",children:"الإيرادات"}),e.jsx("div",{className:"font-bold text-emerald-600 dark:text-emerald-400",children:v((c=t==null?void 0:t.financial)==null?void 0:c.income)})]}),e.jsxs("div",{children:[e.jsx(o,{className:"text-xs dark:text-slate-400",children:"المصروفات"}),e.jsx("div",{className:"font-bold text-rose-600 dark:text-rose-400",children:v((m=t==null?void 0:t.financial)==null?void 0:m.expense)})]})]})]}),e.jsxs(y,{decoration:"top",decorationColor:"indigo",className:"bg-white dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",children:[e.jsxs(J,{justifyContent:"start",className:"space-x-4 space-x-reverse",children:[e.jsx("div",{className:"p-3 bg-indigo-100 text-indigo-600 rounded-xl dark:bg-indigo-500/20 dark:text-indigo-400",children:e.jsx(Fe,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx(o,{className:"dark:text-slate-400",children:"إجمالي النقد المتاح"}),e.jsx(B,{className:"text-indigo-700 dark:text-indigo-400",children:v((D=t==null?void 0:t.financial)==null?void 0:D.total_cash)})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100 grid grid-cols-2 gap-4 dark:border-white/10",children:[e.jsxs("div",{children:[e.jsxs(o,{className:"text-xs dark:text-slate-400",children:["الخزائن (",((i=(b=t==null?void 0:t.financial)==null?void 0:b.safes)==null?void 0:i.length)||0,")"]}),e.jsx("div",{className:"font-bold text-blue-600 dark:text-blue-400",children:v((N=t==null?void 0:t.financial)==null?void 0:N.total_safes)})]}),e.jsxs("div",{children:[e.jsxs(o,{className:"text-xs dark:text-slate-400",children:["البنوك (",((_=(x=t==null?void 0:t.financial)==null?void 0:x.banks)==null?void 0:_.length)||0,")"]}),e.jsx("div",{className:"font-bold text-indigo-600 dark:text-indigo-400",children:v((F=t==null?void 0:t.financial)==null?void 0:F.total_banks)})]})]})]}),e.jsxs(y,{decoration:"top",decorationColor:"blue",className:"bg-white dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",children:[e.jsxs(J,{justifyContent:"start",className:"space-x-4 space-x-reverse",children:[e.jsx("div",{className:"p-3 bg-blue-100 text-blue-600 rounded-xl dark:bg-blue-500/20 dark:text-blue-400",children:e.jsx(ie,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx(o,{className:"dark:text-slate-400",children:"قيمة المخزون اللحظي"}),e.jsx(B,{className:"dark:text-white",children:v((z=t==null?void 0:t.financial)==null?void 0:z.inventory_value)})]})]}),e.jsx(o,{className:"mt-2 text-slate-400 text-xs",children:"مجموع (حجم الخزان × السعر الحالي)"})]}),e.jsxs(y,{decoration:"top",decorationColor:"amber",className:"bg-white dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",children:[e.jsxs(J,{justifyContent:"start",className:"space-x-4 space-x-reverse",children:[e.jsx("div",{className:"p-3 bg-amber-100 text-amber-600 rounded-xl dark:bg-amber-500/20 dark:text-amber-400",children:e.jsx(we,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx(o,{className:"dark:text-slate-400",children:"الذمم والديون"}),e.jsx("div",{className:"text-2xl font-bold text-slate-700 dark:text-white",children:"ملخص الأرصدة"})]})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs(J,{className:"justify-between",children:[e.jsx(o,{className:"dark:text-slate-400",children:"ديون الشركات (لنا)"}),e.jsx(o,{className:"font-bold text-emerald-600 dark:text-emerald-400",children:v((G=t==null?void 0:t.financial)==null?void 0:G.corporate_debts)})]}),e.jsxs(J,{className:"justify-between",children:[e.jsx(o,{className:"dark:text-slate-400",children:"التزامات الموردين (علينا)"}),e.jsx(o,{className:"font-bold text-rose-600 dark:text-rose-400",children:v((X=t==null?void 0:t.financial)==null?void 0:X.supplier_debts)})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(y,{className:"bg-white dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",children:[e.jsx(A,{className:"text-slate-800 mb-4 dark:text-white",children:"💰 تفاصيل الأرصدة النقدية"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{className:"font-bold text-blue-600 mb-2 dark:text-blue-400",children:"الخزائن"}),e.jsxs("div",{className:"space-y-2",children:[(Y=(Z=t==null?void 0:t.financial)==null?void 0:Z.safes)==null?void 0:Y.map((E,W)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-blue-50 rounded-lg dark:bg-blue-900/20",children:[e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:E.name}),e.jsx("span",{className:"font-bold text-blue-700 dark:text-blue-400",children:v(E.balance)})]},W)),(!((se=t==null?void 0:t.financial)!=null&&se.safes)||((ae=t==null?void 0:t.financial)==null?void 0:ae.safes.length)===0)&&e.jsx("div",{className:"text-slate-400 text-sm text-center py-2",children:"لا توجد خزائن"})]})]}),e.jsxs("div",{children:[e.jsx(o,{className:"font-bold text-indigo-600 mb-2 dark:text-indigo-400",children:"البنوك"}),e.jsxs("div",{className:"space-y-2",children:[(s=(re=t==null?void 0:t.financial)==null?void 0:re.banks)==null?void 0:s.map((E,W)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-indigo-50 rounded-lg dark:bg-indigo-900/20",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:E.name}),E.account_number&&e.jsxs("span",{className:"text-xs text-slate-400 mr-2",children:["(",E.account_number,")"]})]}),e.jsx("span",{className:"font-bold text-indigo-700 dark:text-indigo-400",children:v(E.balance)})]},W)),(!((U=t==null?void 0:t.financial)!=null&&U.banks)||((M=t==null?void 0:t.financial)==null?void 0:M.banks.length)===0)&&e.jsx("div",{className:"text-slate-400 text-sm text-center py-2",children:"لا توجد حسابات بنكية"})]})]})]})]}),e.jsxs(y,{className:"bg-white dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",children:[e.jsx(A,{className:"text-slate-800 mb-4 dark:text-white",children:"📊 توزيع المصروفات حسب الفئة"}),e.jsxs("div",{className:"space-y-3",children:[(K=(O=t==null?void 0:t.financial)==null?void 0:O.expense_breakdown)==null?void 0:K.map((E,W)=>{var ge;const ue=((ge=t==null?void 0:t.financial)==null?void 0:ge.expense)>0?(E.total_amount/t.financial.expense*100).toFixed(1):0;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:E.category_name}),e.jsx("span",{className:"font-bold text-rose-600 dark:text-rose-400",children:v(E.total_amount)})]}),e.jsx("div",{className:"h-2 bg-slate-100 rounded-full overflow-hidden dark:bg-slate-700",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-rose-400 to-rose-600 rounded-full transition-all duration-500",style:{width:`${ue}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-400",children:[e.jsxs("span",{children:[E.transaction_count," عملية"]}),e.jsxs("span",{children:[ue,"%"]})]})]},W)}),(!((V=t==null?void 0:t.financial)!=null&&V.expense_breakdown)||((de=t==null?void 0:t.financial)==null?void 0:de.expense_breakdown.length)===0)&&e.jsx("div",{className:"text-slate-400 text-sm text-center py-4",children:"لا توجد مصروفات في هذه الفترة"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(y,{className:"bg-white dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",children:[e.jsx(A,{className:"text-slate-800 mb-4 dark:text-white",children:"👥 أكبر العملاء المدينين (لنا)"}),e.jsxs("div",{className:"space-y-2",children:[(L=(ee=t==null?void 0:t.financial)==null?void 0:ee.top_customers)==null?void 0:L.map((E,W)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-emerald-50 rounded-lg border border-emerald-100 dark:bg-emerald-900/20 dark:border-emerald-900/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-emerald-500 text-white rounded-full flex items-center justify-center font-bold text-sm",children:W+1}),e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:E.name})]}),e.jsx("span",{className:"font-bold text-emerald-700 dark:text-emerald-400",children:v(E.balance)})]},W)),(!((ce=t==null?void 0:t.financial)!=null&&ce.top_customers)||((xe=t==null?void 0:t.financial)==null?void 0:xe.top_customers.length)===0)&&e.jsx("div",{className:"text-slate-400 text-sm text-center py-4",children:"لا توجد ديون من العملاء"})]})]}),e.jsxs(y,{className:"bg-white dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",children:[e.jsx(A,{className:"text-slate-800 mb-4 dark:text-white",children:"🚛 أكبر الموردين الدائنين (علينا)"}),e.jsxs("div",{className:"space-y-2",children:[(me=(he=t==null?void 0:t.financial)==null?void 0:he.top_suppliers)==null?void 0:me.map((E,W)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-rose-50 rounded-lg border border-rose-100 dark:bg-rose-900/20 dark:border-rose-900/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-rose-500 text-white rounded-full flex items-center justify-center font-bold text-sm",children:W+1}),e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:E.name})]}),e.jsx("span",{className:"font-bold text-rose-700 dark:text-rose-400",children:v(E.balance)})]},W)),(!((be=t==null?void 0:t.financial)!=null&&be.top_suppliers)||((pe=t==null?void 0:t.financial)==null?void 0:pe.top_suppliers.length)===0)&&e.jsx("div",{className:"text-slate-400 text-sm text-center py-4",children:"لا توجد التزامات للموردين"})]})]})]})]}):e.jsx(qe,{initialGroup:new URLSearchParams(window.location.search).get("group")})]})},l=()=>{var r,d,c,m,D,b,i,N,x,_,F,z,G,X,Z,Y,se,ae,re;return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(y,{decoration:"top",decorationColor:"blue",className:"bg-white dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",children:[e.jsx(o,{className:"dark:text-slate-400",children:"قيمة المخزون الحالي"}),e.jsx(B,{className:"mt-2 text-blue-700 dark:text-blue-400",children:v((r=t==null?void 0:t.financial)==null?void 0:r.inventory_value)})]}),e.jsxs(y,{decoration:"top",decorationColor:"cyan",className:"bg-white dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",children:[e.jsx(o,{className:"dark:text-slate-400",children:"الوارد (مشتريات) للفترة"}),e.jsxs(B,{className:"mt-2 text-cyan-700 dark:text-cyan-400",children:[j((c=(d=t==null?void 0:t.warehouse)==null?void 0:d.incoming_stock)==null?void 0:c.total_volume)," ",e.jsx("span",{className:"text-sm",children:"لتر"})]}),e.jsxs(o,{className:"mt-2 text-xs text-slate-400",children:["بتكلفة: ",v((D=(m=t==null?void 0:t.warehouse)==null?void 0:m.incoming_stock)==null?void 0:D.total_cost)]})]}),e.jsxs(y,{decoration:"top",decorationColor:"orange",className:"bg-white dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",children:[e.jsx(o,{className:"dark:text-slate-400",children:"فاقد التبخر (تقديري)"}),e.jsxs(B,{className:"mt-2 text-orange-700 dark:text-orange-400",children:[j((b=t==null?void 0:t.financial)==null?void 0:b.evaporation_loss)," ",e.jsx("span",{className:"text-sm",children:"لتر"})]}),e.jsx(o,{className:"mt-2 text-xs text-slate-400",children:"حسب التباين بين الأرصدة"})]})]}),e.jsx(A,{className:"text-slate-700 mt-4 mb-2",children:"تفاصيل المستودعات والمعايرة"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:(i=t==null?void 0:t.warehouse)==null?void 0:i.tanks.map((s,U)=>{const M=s.volume/(s.capacity||1)*100,O=M<20,K=M<10,V=ee=>{const L=(ee||"").toLowerCase();return L.includes("diesel")||L.includes("ديزل")?"from-amber-400 to-orange-500":L.includes("petrol")||L.includes("بنزين")||L.includes("91")||L.includes("95")?"from-emerald-400 to-teal-500":L.includes("gas")||L.includes("غاز")?"from-purple-400 to-pink-500":"from-blue-400 to-indigo-500"},de=ee=>{const L=(ee||"").toLowerCase();return L.includes("diesel")||L.includes("ديزل")?"bg-amber-50":L.includes("petrol")||L.includes("بنزين")||L.includes("91")||L.includes("95")?"bg-emerald-50":L.includes("gas")||L.includes("غاز")?"bg-purple-50":"bg-blue-50"};return e.jsx(H.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:U*.1},children:e.jsxs(y,{className:`relative overflow-hidden group hover:shadow-xl transition-all duration-300 border-2 dark:bg-white/5 dark:backdrop-blur-md dark:border-white/10 ${K?"border-red-300 animate-pulse":O?"border-orange-300":"border-slate-200"}`,children:[e.jsx("div",{className:`absolute bottom-0 left-0 w-full transition-all duration-1000 ${de(s.fuel)}`,style:{height:`${M}%`,opacity:.4}}),(O||K)&&e.jsxs("div",{className:`absolute top-3 left-3 px-2 py-1 rounded-full text-xs font-bold flex items-center gap-1 z-20 ${K?"bg-red-500 text-white animate-bounce":"bg-orange-500 text-white"}`,children:[e.jsx(ye,{className:"w-3 h-3"}),K?"حرج!":"منخفض"]}),e.jsxs(J,{justifyContent:"between",alignItems:"start",className:"relative z-10",children:[e.jsxs("div",{children:[e.jsx(o,{className:"font-bold text-slate-800 text-lg",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full bg-gradient-to-r ${V(s.fuel)}`}),e.jsx(o,{className:"text-xs text-slate-500",children:s.fuel})]})]}),e.jsxs("div",{className:`px-3 py-1.5 rounded-full text-xs font-bold bg-gradient-to-r ${V(s.fuel)} text-white shadow-lg`,children:[M.toFixed(1),"%"]})]}),e.jsxs("div",{className:"mt-6 mb-4 relative z-10",children:[e.jsx("div",{className:"h-3 bg-slate-200 rounded-full overflow-hidden relative",children:e.jsx(H.div,{initial:{width:0},animate:{width:`${M}%`},transition:{duration:1,ease:"easeOut"},className:`h-full bg-gradient-to-r ${V(s.fuel)} shadow-lg`})}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-400 mt-1.5 font-mono",children:[e.jsx("span",{children:"0"}),e.jsxs("span",{className:"font-bold text-slate-600",children:[j(s.volume)," L"]}),e.jsx("span",{children:j(s.capacity)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-4 relative z-10",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm p-3 rounded-xl border border-slate-100 dark:bg-slate-800/80 dark:border-slate-700",children:[e.jsx(o,{className:"text-xs text-slate-500 mb-1 dark:text-slate-400",children:"القيمة الإجمالية"}),e.jsx("div",{className:"font-bold text-emerald-600",children:v(s.value)})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm p-3 rounded-xl border border-slate-100 dark:bg-slate-800/80 dark:border-slate-700",children:[e.jsx(o,{className:"text-xs text-slate-500 mb-1 dark:text-slate-400",children:"آخر معايرة"}),e.jsx("div",{className:"font-mono text-xs font-bold text-slate-700 dark:text-slate-300",children:s.last_calibration==="N/A"?"غير متوفر":new Date(s.last_calibration).toLocaleDateString("ar-EG",{month:"short",day:"numeric"})})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-100 flex justify-between items-center relative z-10 dark:border-white/10",children:[e.jsx(o,{className:"text-xs text-slate-500",children:"التباين (Variance)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-mono font-bold text-sm ${s.variance<-50?"text-red-600":s.variance<0?"text-orange-600":s.variance>50?"text-blue-600":"text-emerald-600"}`,children:[s.variance>0?"+":"",j(s.variance)," L"]}),Math.abs(s.variance)>50&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"})]})]})]})},U)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-8",children:[e.jsxs(y,{className:"bg-white dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",children:[e.jsx(A,{className:"mb-4 text-slate-700 border-b border-slate-100 pb-2 dark:text-white dark:border-white/10",children:"سجل الوارد (المشتريات)"}),((_=(x=(N=t==null?void 0:t.warehouse)==null?void 0:N.incoming_stock)==null?void 0:x.list)==null?void 0:_.length)>0?e.jsx("div",{className:"overflow-x-auto max-h-80 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-right text-sm",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 sticky top-0 z-10 dark:bg-white/5 dark:text-slate-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"التاريخ"}),e.jsx("th",{className:"p-3",children:"المورد"}),e.jsx("th",{className:"p-3",children:"الخزان"}),e.jsx("th",{className:"p-3",children:"الكمية"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-white/10",children:t.warehouse.incoming_stock.list.map((s,U)=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-white/5",children:[e.jsx("td",{className:"p-3 whitespace-nowrap dark:text-slate-300",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"p-3 font-bold dark:text-white",children:s.supplier_name}),e.jsx("td",{className:"p-3 text-xs dark:text-slate-400",children:s.tank_name}),e.jsx("td",{className:"p-3 font-mono text-blue-600 dark:text-blue-400",children:j(s.volume_received)})]},U))})]})}):e.jsx(o,{className:"text-center py-6 text-slate-400",children:"لا توجد عمليات واردة في هذه الفترة"})]}),e.jsxs(y,{className:"bg-white dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",children:[e.jsx(A,{className:"mb-4 text-slate-700 border-b border-slate-100 pb-2 dark:text-white dark:border-white/10",children:"سجل قراءات الخزانات (المعايرة والقياس)"}),((z=(F=t==null?void 0:t.warehouse)==null?void 0:F.readings)==null?void 0:z.length)>0?e.jsx("div",{className:"overflow-x-auto max-h-80 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-right text-sm",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 sticky top-0 z-10 dark:bg-white/5 dark:text-slate-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"التاريخ"}),e.jsx("th",{className:"p-3",children:"وقت المعايرة"}),e.jsx("th",{className:"p-3",children:"الخزان"}),e.jsx("th",{className:"p-3",children:"مشرف الوردية"}),e.jsx("th",{className:"p-3",children:"القراءة السابقة"}),e.jsx("th",{className:"p-3",children:"القراءة الحالية"}),e.jsx("th",{className:"p-3",children:"عجز وزيادة"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-white/10",children:t.warehouse.readings.map((s,U)=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-white/5",children:[e.jsx("td",{className:"p-3 whitespace-nowrap dark:text-slate-300",children:new Date(s.created_at).toLocaleDateString("ar-EG")}),e.jsx("td",{className:"p-3 whitespace-nowrap dark:text-slate-300 font-mono text-xs",children:new Date(s.created_at).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsx("td",{className:"p-3 font-bold dark:text-white",children:s.tank_name}),e.jsx("td",{className:"p-3 text-xs text-slate-600 dark:text-slate-400",children:s.user_name||"-"}),e.jsx("td",{className:"p-3 font-mono text-slate-500 dark:text-slate-400",children:s.previous_quantity?j(s.previous_quantity):"-"}),e.jsx("td",{className:"p-3 font-mono font-bold text-slate-700 dark:text-white",children:j(s.volume_liters)}),e.jsxs("td",{className:`p-3 font-mono font-bold ${parseFloat(s.variance)<0?"text-red-600 dark:text-red-400":parseFloat(s.variance)>0?"text-lime-600 dark:text-lime-400":"text-slate-400"}`,children:[parseFloat(s.variance)>0&&"+",j(s.variance)]})]},U))})]})}):e.jsx(o,{className:"text-center py-6 text-slate-400",children:"لا توجد قراءات مسجلة في هذه الفترة"})]})]}),((G=t==null?void 0:t.warehouse)==null?void 0:G.calibration_logs)&&t.warehouse.calibration_logs.length>0&&e.jsxs(y,{className:"bg-white mt-6 dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",children:[e.jsx(A,{className:"mb-4 text-slate-700 border-b border-slate-100 pb-2 dark:text-white dark:border-white/10",children:"سجل المعايرة"}),e.jsx("div",{className:"overflow-x-auto max-h-96 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-right text-sm",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 sticky top-0 z-10 dark:bg-white/5 dark:text-slate-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"التاريخ"}),e.jsx("th",{className:"p-3",children:"الخزان"}),e.jsx("th",{className:"p-3",children:"المستخدم"}),e.jsx("th",{className:"p-3",children:"الرصيد السابق"}),e.jsx("th",{className:"p-3",children:"الكمية الفعلية"}),e.jsx("th",{className:"p-3",children:"الفرق"}),e.jsx("th",{className:"p-3",children:"ملاحظات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-white/10",children:t.warehouse.calibration_logs.map((s,U)=>e.jsxs("tr",{className:`hover:bg-slate-50 dark:hover:bg-white/5 ${s.tank_updated?"bg-amber-50/30":""}`,children:[e.jsx("td",{className:"p-3 whitespace-nowrap text-xs dark:text-slate-300",children:new Date(s.created_at).toLocaleString("ar-EG",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{className:"p-3 font-bold text-slate-700 dark:text-white",children:s.tank_name}),e.jsx("td",{className:"p-3 text-xs text-slate-600 dark:text-slate-400",children:s.user_name||"غير معروف"}),e.jsxs("td",{className:"p-3 font-mono text-blue-600 dark:text-blue-400",children:[j(s.previous_quantity)," L"]}),e.jsxs("td",{className:"p-3 font-mono text-indigo-600 font-bold dark:text-indigo-400",children:[j(s.actual_quantity)," L"]}),e.jsxs("td",{className:`p-3 font-mono font-bold ${parseFloat(s.variance)>0?"text-green-600":parseFloat(s.variance)<0?"text-red-600":"text-gray-600"}`,children:[parseFloat(s.variance)>0&&"+",j(s.variance)," L",e.jsx("span",{className:"text-xs ml-2",children:parseFloat(s.variance)>0?"(زيادة)":parseFloat(s.variance)<0?"(عجز)":"(متطابق)"})]}),e.jsx("td",{className:"p-3 text-xs text-slate-500 max-w-xs truncate",children:s.notes||"-"})]},U))})]})}),e.jsx("div",{className:"mt-3 p-3 bg-slate-50 rounded-lg text-xs text-slate-600 dark:bg-white/5 dark:text-slate-400",children:"💡 السجلات ذات الخلفية الصفراء تشير إلى تحديث رصيد الخزان مباشرة من المعايرة"})]}),e.jsxs(y,{className:"bg-white mt-6 dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 pb-3 border-b border-slate-100 dark:border-white/10",children:[e.jsxs(A,{className:"text-slate-700 flex items-center gap-2 dark:text-white",children:[e.jsx(ne,{className:"w-5 h-5 text-orange-500"}),"تناكر شاحنة"]}),e.jsxs(oe,{className:"bg-orange-100 text-orange-700 border-orange-200",children:[((Z=(X=t==null?void 0:t.warehouse)==null?void 0:X.pending_shipments)==null?void 0:Z.length)||0," تنكر معلق"]})]}),((se=(Y=t==null?void 0:t.warehouse)==null?void 0:Y.pending_shipments)==null?void 0:se.length)>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.warehouse.pending_shipments.map((s,U)=>{const M=Math.floor((new Date-new Date(s.created_at))/864e5),O=M>3;return e.jsxs(H.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:U*.05},className:`p-4 rounded-xl border-2 transition-all hover:shadow-md dark:bg-white/5 ${O?"border-red-200 bg-red-50/50 hover:border-red-300 dark:border-red-900/50 dark:bg-red-900/20":"border-orange-200 bg-orange-50/30 hover:border-orange-300 dark:border-orange-900/50 dark:bg-orange-900/20"}`,children:[e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold ${O?"bg-red-500":"bg-orange-500"}`,children:e.jsx(ne,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-slate-800 dark:text-white",children:["#",s.invoice_number]}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:s.supplier_name})]}),O&&e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-700 text-xs font-bold rounded-full animate-pulse",children:"تأخير!"})]})}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"نوع الوقود:"}),e.jsxs("span",{className:"font-bold text-slate-700 flex items-center gap-1 dark:text-slate-200",children:[e.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:s.fuel_color||"#94a3b8"}}),s.fuel_type||"غير محدد"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"الكمية:"}),e.jsxs("span",{className:"font-mono font-bold text-blue-600 dark:text-blue-400",children:[j(s.volume_ordered)," L"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"السائق:"}),e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-200",children:s.driver_name_resolved||s.driver_name||"غير محدد"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"التاريخ:"}),e.jsxs("span",{className:"font-mono text-slate-600 text-xs dark:text-slate-400",children:[new Date(s.created_at).toLocaleDateString("ar-EG"),e.jsxs("span",{className:`mr-1 ${O?"text-red-600 dark:text-red-400":"text-slate-400 dark:text-slate-500"}`,children:["(",M," ",M===1?"يوم":"أيام",")"]})]})]})]}),e.jsx("div",{className:`mt-3 pt-3 border-t ${O?"border-red-200 dark:border-red-900/50":"border-orange-200 dark:border-orange-900/50"} text-center`,children:e.jsxs("span",{className:`text-xs font-bold ${O?"text-red-700":"text-orange-700"}`,children:[s.status==="ordered"&&"📦 تم الطلب",s.status==="in_transit"&&"🚚 في الطريق",s.status==="arrived"&&"✅ وصلت - بانتظار التفريغ",s.status==="offloading"&&"⏳ جاري التفريغ"]})})]},U)})}):e.jsx("div",{className:"text-center py-12 bg-slate-50 rounded-xl border-2 border-dashed border-slate-200",children:e.jsxs("div",{className:"flex flex-col items-center text-slate-400",children:[e.jsx(Ee,{className:"w-16 h-16 mb-3 text-emerald-400"}),e.jsx(o,{className:"font-bold text-slate-600",children:"ممتاز! جميع التناكر تم تفريغها"}),e.jsx(o,{className:"text-sm mt-1",children:"لا توجد تناكر شاحنة في الوقت الحالي"})]})})]}),e.jsxs(y,{className:"bg-white mt-6 dark:bg-white/5 dark:backdrop-blur-md dark:border dark:border-white/10 dark:ring-white/10",children:[e.jsx(A,{className:"mb-4 text-slate-700 border-b border-slate-100 pb-2 dark:text-white dark:border-white/10",children:"تفاصيل حركة المخزون اليومية (مطابقة الأرصدة)"}),((re=(ae=t==null?void 0:t.warehouse)==null?void 0:ae.daily_reconciliation)==null?void 0:re.length)>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-right text-sm",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 font-bold dark:bg-white/5 dark:text-slate-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"التاريخ"}),e.jsx("th",{className:"p-3",children:"الخزان"}),e.jsx("th",{className:"p-3",children:"رصيد أول المدة"}),e.jsx("th",{className:"p-3 text-cyan-600",children:"وارد (+)"}),e.jsx("th",{className:"p-3 text-rose-600",children:"منصرف (-)"}),e.jsx("th",{className:"p-3 text-blue-600",children:"رصيد نظري (=)"}),e.jsx("th",{className:"p-3 text-purple-600",children:"رصيد فعلي (قياس)"}),e.jsx("th",{className:"p-3",children:"الفارق (Variance)"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-white/10",children:t.warehouse.daily_reconciliation.map((s,U)=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-white/5",children:[e.jsx("td",{className:"p-3 whitespace-nowrap dark:text-slate-300",children:s.date}),e.jsx("td",{className:"p-3 font-bold dark:text-white",children:s.tank_name}),e.jsx("td",{className:"p-3 font-mono",children:j(s.opening)}),e.jsx("td",{className:"p-3 font-mono text-cyan-600",children:j(s.in)}),e.jsx("td",{className:"p-3 font-mono text-rose-600",children:j(s.out)}),e.jsx("td",{className:"p-3 font-mono font-bold text-blue-600",children:j(s.theoretical)}),e.jsx("td",{className:"p-3 font-mono font-bold text-purple-600",children:s.actual!==null?j(s.actual):e.jsx("span",{className:"text-slate-300",children:"-"})}),e.jsx("td",{className:"p-3",children:s.actual!==null?e.jsx("span",{className:`font-mono font-bold px-2 py-1 rounded ${s.variance<0?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:j(s.variance)}):e.jsx("span",{className:"text-slate-300",children:"-"})})]},U))})]})}):e.jsx(o,{className:"text-center py-6 text-slate-400",children:"لا توجد حركات مخزون في هذه الفترة"})]})]})},[n,$]=k.useState(0);k.useEffect(()=>{const r=new URLSearchParams(window.location.search);r.get("tab")==="sales"&&r.get("subtab")==="tank_sales"&&$(2)},[]);const S=()=>{var r,d,c,m,D,b,i;return e.jsxs("div",{className:"animate-fade-in space-y-6",children:[e.jsxs("div",{className:"flex gap-2 p-1 bg-slate-100/50 rounded-xl w-fit",children:[e.jsx("button",{onClick:()=>$(0),className:`px-4 py-2 rounded-lg text-sm font-bold transition-all ${n===0?"bg-white shadow text-violet-700":"text-slate-500 hover:text-slate-700"}`,children:"نظرة عامة"}),e.jsx("button",{onClick:()=>$(1),className:`px-4 py-2 rounded-lg text-sm font-bold transition-all ${n===1?"bg-white shadow text-violet-700":"text-slate-500 hover:text-slate-700"}`,children:"التقرير اليومي"}),e.jsx("button",{onClick:()=>$(2),className:`px-4 py-2 rounded-lg text-sm font-bold transition-all ${n===2?"bg-white shadow text-violet-700":"text-slate-500 hover:text-slate-700"}`,children:"مبيعات الآبار"})]}),n===0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(y,{decoration:"top",decorationColor:"violet",className:"bg-white",children:[e.jsx(o,{children:"إجمالي المبيعات (إيراد)"}),e.jsx(B,{className:"mt-2 text-violet-700",children:v((r=t==null?void 0:t.sales)==null?void 0:r.total_revenue)}),e.jsxs(J,{className:"mt-4 pt-4 border-t border-slate-100",children:[e.jsx(o,{children:"عدد العمليات"}),e.jsx(o,{className:"font-bold",children:(d=t==null?void 0:t.sales)==null?void 0:d.total_transactions})]})]}),e.jsxs(y,{decoration:"top",decorationColor:"indigo",className:"bg-white",children:[e.jsx(o,{children:"الكميات المباعة"}),e.jsxs(B,{className:"mt-2 text-indigo-700",children:[j((c=t==null?void 0:t.sales)==null?void 0:c.total_liters)," ",e.jsx("span",{className:"text-sm",children:"لتر"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(y,{className:"bg-white",children:[e.jsx(A,{className:"mb-4",children:"تحليل المبيعات حسب المنتج"}),e.jsx("div",{className:"space-y-4",children:((D=(m=t==null?void 0:t.sales)==null?void 0:m.by_product)==null?void 0:D.length)>0?t.sales.by_product.map((N,x)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-xl hover:bg-slate-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 rounded-full shadow-sm",style:{backgroundColor:N.color_hex||"#94a3b8"}}),e.jsx("span",{className:"font-bold text-slate-700",children:N.product_name})]}),e.jsxs("div",{className:"flex gap-6 text-sm",children:[e.jsxs("div",{className:"text-slate-500",children:[e.jsx("span",{className:"font-bold text-slate-800",children:j(N.total_liters)})," لتر"]}),e.jsxs("div",{className:"text-slate-500 font-mono",children:[e.jsx("span",{className:"font-bold text-slate-800",children:j(N.total_revenue)})," SDG"]})]})]},x)):e.jsx("div",{className:"text-center text-slate-400 py-6",children:"لا توجد بيانات مبيعات تفصيلية لهذه الفترة"})})]}),e.jsxs(y,{className:"bg-white",children:[e.jsx(A,{className:"mb-4",children:"المبيعات الأخيرة (مباشر)"}),((i=(b=t==null?void 0:t.sales)==null?void 0:b.recent_sales)==null?void 0:i.length)>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-right text-sm",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 text-xs uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2",children:"الوقت"}),e.jsx("th",{className:"p-2",children:"المكنة"}),e.jsx("th",{className:"p-2",children:"الكمية"}),e.jsx("th",{className:"p-2",children:"المبلغ"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50",children:t.sales.recent_sales.map((N,x)=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"p-2 whitespace-nowrap text-slate-400 text-xs",children:new Date(N.created_at).toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})}),e.jsxs("td",{className:"p-2 font-medium",children:[N.pump_name,e.jsx("span",{className:"block text-xs text-slate-400",children:N.fuel_type})]}),e.jsx("td",{className:"p-2 font-mono text-blue-600",children:j(N.volume_sold)}),e.jsx("td",{className:"p-2 font-mono font-bold text-emerald-600",children:j(N.total_amount)})]},x))})]})}):e.jsx("div",{className:"text-center text-slate-400 py-6",children:"لا توجد مبيعات حديثة"})]})]})]}):n===1?e.jsx(Te,{stationId:p.station_id}):e.jsx(ze,{stationId:p.station_id})]})},a=()=>{var D;const r=((D=t==null?void 0:t.employees)==null?void 0:D.list)||[],d=[...r].sort((b,i)=>i.total_sales-b.total_sales)[0],c=[...r].sort((b,i)=>i.total_volume-b.total_volume)[0],m=[...r].sort((b,i)=>i.shifts_count-b.shifts_count)[0];return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[r.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(y,{decoration:"top",decorationColor:"emerald",className:"bg-white relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-3 opacity-10",children:e.jsx(le,{className:"w-24 h-24 text-emerald-600"})}),e.jsx(o,{children:"الأعلى مبيعاً (إيراد)"}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-700 font-bold text-xl border-2 border-emerald-200",children:"1"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-slate-800",children:d==null?void 0:d.worker_name}),e.jsx(B,{className:"text-emerald-600 text-xl",children:v(d==null?void 0:d.total_sales)})]})]})]}),e.jsxs(y,{decoration:"top",decorationColor:"blue",className:"bg-white relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-3 opacity-10",children:e.jsx(ie,{className:"w-24 h-24 text-blue-600"})}),e.jsx(o,{children:"الأكثر مبيعاً (كمية)"}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center text-blue-700 font-bold text-xl border-2 border-blue-200",children:"1"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-slate-800",children:c==null?void 0:c.worker_name}),e.jsxs(B,{className:"text-blue-600 text-xl",children:[j(c==null?void 0:c.total_volume)," لتر"]})]})]})]}),e.jsxs(y,{decoration:"top",decorationColor:"amber",className:"bg-white relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-3 opacity-10",children:e.jsx(we,{className:"w-24 h-24 text-amber-600"})}),e.jsx(o,{children:"الأكثر حضوراً (ورديات)"}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center text-amber-700 font-bold text-xl border-2 border-amber-200",children:"★"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-slate-800",children:m==null?void 0:m.worker_name}),e.jsxs(B,{className:"text-amber-600 text-xl",children:[m==null?void 0:m.shifts_count," وردية"]})]})]})]})]}),e.jsxs(y,{className:"bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-slate-500"}),"سجل الأداء والمستحقات"]}),e.jsxs(oe,{className:"bg-slate-100 text-slate-600",children:[r.length," موظف نشط"]})]}),r.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-right text-sm border-separate border-spacing-y-2",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 font-bold text-xs uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 rounded-r-lg",children:"الموظف"}),e.jsx("th",{className:"p-3",children:"الورديات"}),e.jsx("th",{className:"p-3",children:"المبيعات (لتر)"}),e.jsx("th",{className:"p-3",children:"المبيعات (إيراد)"}),e.jsx("th",{className:"p-3 text-emerald-600",children:"الحوافز (+)"}),e.jsx("th",{className:"p-3 text-red-600",children:"الخصومات (-)"}),e.jsx("th",{className:"p-3",children:"مؤشر الأداء"})]})}),e.jsx("tbody",{children:r.map((b,i)=>{const N=(c==null?void 0:c.total_volume)||1,x=b.total_volume/N*100;return e.jsxs("tr",{className:"bg-white hover:bg-slate-50 transition-shadow hover:shadow-sm group",children:[e.jsxs("td",{className:"p-3 border-y border-r border-slate-100 rounded-r-lg font-bold text-slate-700 flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 text-xs",children:b.worker_name.charAt(0)}),b.worker_name,b===d&&e.jsx("span",{className:"text-emerald-500 text-xs",children:"👑"})]}),e.jsx("td",{className:"p-3 border-y border-slate-100 text-slate-500 font-mono",children:b.shifts_count}),e.jsx("td",{className:"p-3 border-y border-slate-100 font-mono text-blue-600 font-medium",children:j(b.total_volume)}),e.jsx("td",{className:"p-3 border-y border-slate-100 font-mono font-bold text-slate-700",children:v(b.total_sales)}),e.jsx("td",{className:"p-3 border-y border-slate-100 font-mono text-emerald-600 bg-emerald-50/50 group-hover:bg-emerald-100/50 transition-colors",children:b.bonuses>0?j(b.bonuses):"-"}),e.jsx("td",{className:"p-3 border-y border-l border-slate-100 rounded-l-lg font-mono text-red-600 bg-red-50/50 group-hover:bg-red-100/50 transition-colors",children:b.deductions>0?j(b.deductions):"-"}),e.jsx("td",{className:"p-3 border-y border-l border-slate-100",children:e.jsx("div",{className:"w-24 h-1.5 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 rounded-full",style:{width:`${x}%`}})})})]},i)})})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-slate-400",children:[e.jsx(le,{className:"w-12 h-12 mb-3 text-slate-200"}),e.jsx(o,{children:"لا توجد بيانات للأداء الوظيفي في هذه الفترة"})]})]})]})};return e.jsx("div",{className:"p-6 max-w-[1800px] mx-auto min-h-screen space-y-6",children:e.jsxs(Re,{index:C,onIndexChange:w,children:[e.jsxs(Ue,{variant:"solid",className:"bg-white/80 backdrop-blur-md p-1 rounded-2xl shadow-sm border border-slate-100 dark:bg-white/5 dark:backdrop-blur-md dark:border-white/10 dark:ring-white/10",children:[e.jsx("div",{className:"hidden md:inline-flex items-center px-3 py-1 bg-slate-100/50 rounded-lg mr-2 dark:bg-white/5 mx-2",children:e.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider dark:text-slate-400",children:"📍 تقارير محلية"})}),e.jsx(te,{className:"px-5 py-2.5 rounded-xl font-bold text-slate-500 ui-selected:bg-emerald-600 ui-selected:text-white ui-selected:shadow-md transition-all dark:text-slate-400 dark:ui-selected:text-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-5 h-5"})," ",e.jsx("span",{children:"المالية"})]})}),e.jsx(te,{className:"px-5 py-2.5 rounded-xl font-bold text-slate-500 ui-selected:bg-blue-600 ui-selected:text-white ui-selected:shadow-md transition-all dark:text-slate-400 dark:ui-selected:text-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5"})," ",e.jsx("span",{children:"المستودعات"})]})}),e.jsx(te,{className:"px-5 py-2.5 rounded-xl font-bold text-slate-500 ui-selected:bg-violet-600 ui-selected:text-white ui-selected:shadow-md transition-all dark:text-slate-400 dark:ui-selected:text-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5"})," ",e.jsx("span",{children:"المبيعات"})]})}),e.jsx(te,{className:"px-5 py-2.5 rounded-xl font-bold text-slate-500 ui-selected:bg-amber-500 ui-selected:text-white ui-selected:shadow-md transition-all dark:text-slate-400 dark:ui-selected:text-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5"})," ",e.jsx("span",{children:"الموظفين"})]})}),e.jsx("div",{className:"hidden md:inline-block w-px h-8 bg-slate-200 mx-3 dark:bg-white/10"}),e.jsx("div",{className:"hidden md:inline-flex items-center px-3 py-1 bg-gradient-to-r from-cyan-100/50 to-blue-100/50 rounded-lg mr-2 dark:from-cyan-900/20 dark:to-blue-900/20",children:e.jsx("span",{className:"text-xs font-bold text-cyan-700 uppercase tracking-wider dark:text-cyan-400",children:"🌍 تقارير عامة"})}),e.jsx(te,{className:"px-5 py-2.5 rounded-xl font-bold text-slate-500 ui-selected:bg-gradient-to-r ui-selected:from-cyan-600 ui-selected:to-blue-600 ui-selected:text-white ui-selected:shadow-lg transition-all dark:text-slate-400 dark:ui-selected:text-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5"})," ",e.jsx("span",{children:"تقرير مورد"})]})}),e.jsx(te,{className:"px-5 py-2.5 rounded-xl font-bold text-slate-500 ui-selected:bg-gradient-to-r ui-selected:from-emerald-600 ui-selected:to-green-600 ui-selected:text-white ui-selected:shadow-lg transition-all dark:text-slate-400 dark:ui-selected:text-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5"})," ",e.jsx("span",{children:"تقرير عميل"})]})})]}),e.jsxs("div",{className:"mt-8",children:[C===0&&T(),C===1&&l(),C===2&&S(),C===3&&a(),C===4&&e.jsx(Be,{stationId:p.station_id}),C===5&&e.jsx(Ae,{stationId:p.station_id})]})]})})}export{Oe as default};
