import{j as e,f as U,m as _,a0 as ne,X as J,F as oe,i as ie,t as C,a4 as ce,a5 as de,v as W,l as V,P as Z,q as ue,a6 as xe,a7 as me,y as he,D as be,a8 as X,r as K}from"./ui-DpPGrQoH.js";import{r,R as pe}from"./vendor-BdFMDtQB.js";import{n as fe,c as ee,b as ge,m as je,h as R,p as Ne,g as Y,D as ve}from"./main-i_nKCBsx.js";import{D as we}from"./DischargeModal-BED4_E_U.js";import{S as se}from"./SuccessAnimation-Bxw0sD32.js";function ye({isOpen:n,onClose:g,onSuccess:h,fuelTypes:o=[],fuelSettings:i=[],tank:t=null}){const[f,N]=r.useState(!1),[a,j]=r.useState({name:"",fuel_type_id:"",capacity_liters:"",current_volume:"0",current_price:""});pe.useEffect(()=>{if(n)if(t)j({id:t.id,name:t.name,fuel_type_id:t.fuel_type_id||"",capacity_liters:t.total_cap||t.capacity_liters,current_volume:t.current||t.current_volume,current_price:t.current_price||""});else{const c=o.length>0?o[0]:null;j({name:"",fuel_type_id:c?c.id:"",capacity_liters:"",current_volume:"0",current_price:c?c.price_per_liter||"0":""})}},[n,t,o]);const b=c=>{const{name:y,value:S}=c.target;let d={...a,[y]:S};if(y==="fuel_type_id"){const u=o.find(T=>String(T.id)===String(S));u&&(d.current_price=u.price_per_liter||"0")}j(d)},v=async c=>{c.preventDefault(),N(!0);const y=window.BASE_URL||"/PETRODIESEL2/public",S=t?`${y}/tanks/update`:`${y}/tanks/store`;try{const u=await(await fetch(S,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).json();u.success?(C.success(u.message),h()):C.error(u.message||"Ø­Ø¯Ø« Ø®Ø·Ø£ Ù…Ø§")}catch(d){console.error("Error saving tank:",d),C.error("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…")}finally{N(!1)}};return e.jsx(U,{children:n&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm",dir:"rtl",children:e.jsxs(_.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden border border-slate-100",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-slate-100 bg-slate-50/50",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-navy-900 flex items-center gap-2",children:[e.jsx(ne,{className:"w-6 h-6 text-blue-600"}),t?"ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø²Ø§Ù†":"Ø¥Ø¶Ø§ÙØ© Ø®Ø²Ø§Ù† Ø¬Ø¯ÙŠØ¯"]}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:t?"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆØ³Ø¹Ø© Ø§Ù„Ø®Ø²Ø§Ù†":"Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙˆØ§Ù„Ø³Ø¹Ø©"})]}),e.jsx("button",{onClick:g,className:"p-2 hover:bg-slate-200 rounded-lg text-slate-500 transition-colors",children:e.jsx(J,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:v,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"Ø§Ø³Ù… Ø§Ù„Ø®Ø²Ø§Ù†"}),e.jsx("input",{type:"text",name:"name",required:!0,placeholder:"Ù…Ø«Ø§Ù„: Ø®Ø²Ø§Ù† Ø§Ù„Ø¯ÙŠØ²Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ",className:"w-full p-3 rounded-xl border border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all",value:a.name,onChange:b})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"Ù†ÙˆØ¹ Ø§Ù„ÙˆÙ‚ÙˆØ¯"}),e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute right-3 top-3.5 text-slate-400 w-5 h-5 pointer-events-none"}),e.jsxs("select",{name:"fuel_type_id",className:"w-full p-3 pr-10 rounded-xl border border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none appearance-none bg-white",value:a.fuel_type_id,onChange:b,required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ÙˆÙ‚ÙˆØ¯"}),o.length>0?o.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id)):e.jsx("option",{value:"",disabled:!0,children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù†ÙˆØ§Ø¹ ÙˆÙ‚ÙˆØ¯ Ù…Ø¹Ø±ÙØ© ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"Ø§Ù„Ø³Ø¹Ø© Ø§Ù„ÙƒÙ„ÙŠØ© (Ù„ØªØ±)"}),e.jsx("input",{type:"number",name:"capacity_liters",required:!0,min:"0",placeholder:"0",className:"w-full p-3 rounded-xl border border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none font-mono",value:a.capacity_liters,onChange:b})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ù„ØªØ±)"}),e.jsx("input",{type:"number",name:"current_volume",required:!0,min:"0",placeholder:"0",className:"w-full p-3 rounded-xl border border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none font-mono",value:a.current_volume,onChange:b})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„ØªØ± (Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª)"}),e.jsx("input",{type:"number",name:"current_price",step:"0.01",readOnly:!0,placeholder:"0.00",className:"w-full p-3 rounded-xl border border-slate-200 bg-slate-100 text-slate-500 cursor-not-allowed outline-none font-mono",value:a.current_price,onChange:b})]}),e.jsxs("div",{className:"pt-4 flex gap-3",children:[e.jsx("button",{type:"button",onClick:g,className:"flex-1 p-3 rounded-xl font-bold text-slate-600 hover:bg-slate-100 transition-colors",children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx("button",{type:"submit",disabled:f,className:"flex-[2] p-3 rounded-xl font-bold text-white bg-blue-600 hover:bg-blue-700 transition-all shadow-lg shadow-blue-200 flex justify-center items-center gap-2 disabled:opacity-70",children:f?"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...":e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-5 h-5"}),t?"Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª":"Ø­ÙØ¸ Ø§Ù„Ø®Ø²Ø§Ù†"]})})]})]})]})})})}const Se=({tank:n,isOpen:g,onClose:h,onSuccess:o})=>{const[i,t]=r.useState(""),[f,N]=r.useState(""),[a,j]=r.useState(0),[b,v]=r.useState(!1),[c,y]=r.useState(!1);r.useEffect(()=>{if(i&&n){const d=parseFloat(n.current_volume||n.current||0),T=(parseFloat(i)||0)-d;j(isNaN(T)?0:T)}else j(0)},[i,n]),r.useEffect(()=>{g||(t(""),N(""),j(0))},[g]);const S=async()=>{if(!i||parseFloat(i)<0){C.error("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„ÙØ¹Ù„ÙŠØ©");return}if(parseFloat(i)>parseFloat(n.capacity_liters)){C.error("Ø§Ù„ÙƒÙ…ÙŠØ© ØªØªØ¬Ø§ÙˆØ² Ø³Ø¹Ø© Ø§Ù„Ø®Ø²Ø§Ù†!");return}try{v(!0);const u=await(await fetch(`${window.BASE_URL}/calibrations/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tank_id:n.id,actual_quantity:parseFloat(i),notes:f})})).json();u.success?(y(!0),setTimeout(()=>{o&&o(),h()},3e3)):C.error(u.message||"ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ø§ÙŠØ±Ø©")}catch(d){console.error(d),C.error("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„")}finally{v(!1)}};return n?e.jsxs(e.Fragment,{children:[e.jsx(fe,{open:g,onClose:h,static:!0,children:e.jsxs("div",{className:"p-6 bg-white rounded-lg max-w-2xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Ù…Ø¹Ø§ÙŠØ±Ø© Ø§Ù„Ø®Ø²Ø§Ù†"}),e.jsx("p",{className:"text-slate-500 mt-1",children:n.name})]}),e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-blue-700 font-medium",children:"Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…"}),e.jsxs("span",{className:"text-2xl font-bold text-blue-900",children:[parseFloat(n.current_volume||n.current||0).toLocaleString("ar-SA")," Ù„ØªØ±"]})]}),e.jsxs("div",{className:"mt-2 text-xs text-blue-600",children:["Ø§Ù„Ø³Ø¹Ø©: ",parseFloat(n.capacity_liters||n.total_cap||0).toLocaleString("ar-SA")," Ù„ØªØ±"]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„ÙØ¹Ù„ÙŠØ© Ø§Ù„Ù…Ù‚Ø§Ø³Ø© (Ù„ØªØ±) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",step:"0.01",value:i,onChange:d=>t(d.target.value),placeholder:"Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ù‚Ø§Ø³Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg",disabled:b,autoFocus:!0})]}),e.jsx("div",{className:`mb-6 p-4 rounded-lg border-2 transition-all ${i&&a>0?"bg-green-50 border-green-300":i&&a<0?"bg-red-50 border-red-300":"bg-gray-50 border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Ø§Ù„ÙØ±Ù‚ (Ø§Ù„Ø¹Ø¬Ø²/Ø§Ù„Ø²ÙŠØ§Ø¯Ø©)"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-3xl font-bold ${i&&a>0?"text-green-700":i&&a<0?"text-red-700":"text-gray-700"}`,children:[a>0&&"+",a.toFixed(2)," Ù„ØªØ±"]}),e.jsx("div",{className:`text-sm mt-1 ${i&&a>0?"text-green-600":i&&a<0?"text-red-600":"text-gray-600"}`,children:i?a>0?"âœ“ Ø²ÙŠØ§Ø¯Ø©":a<0?"âœ— Ø¹Ø¬Ø²":"= Ù…ØªØ·Ø§Ø¨Ù‚":"Ø³ÙŠØ¸Ù‡Ø± Ø¨Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙ…ÙŠØ©"})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"}),e.jsx("textarea",{value:f,onChange:d=>N(d.target.value),placeholder:"Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ùˆ ØªÙˆØ¶ÙŠØ­Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©...",rows:"3",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",disabled:b})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:h,disabled:b,className:"px-6 py-2 border border-slate-300 rounded-lg text-slate-700 hover:bg-slate-50 disabled:opacity-50",children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsxs("button",{onClick:S,disabled:b||!i,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[b&&e.jsxs("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ø§ÙŠØ±Ø©"]})]})]})}),e.jsx(se,{isVisible:c,message:"ØªÙ…Øª Ø§Ù„Ù…Ø¹Ø§ÙŠØ±Ø© Ø¨Ù†Ø¬Ø§Ø­! ðŸŽŠ",onComplete:()=>y(!1)})]}):null},_e=({isVisible:n,onComplete:g,mode:h="transfer"})=>{const[o,i]=r.useState("transferring");r.useEffect(()=>{if(n){i("transferring"),setTimeout(()=>i("success"),2e3);const f=setTimeout(()=>{g&&g()},4e3);return()=>clearTimeout(f)}},[n,g]);const t=h==="delete";return e.jsx(U,{children:n&&e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[9999] flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-3xl p-10 shadow-2xl flex flex-col items-center max-w-sm w-full relative overflow-hidden",children:[e.jsxs("div",{className:"h-32 w-full flex items-center justify-center relative mb-6",children:[e.jsx(U,{children:o==="success"&&e.jsx(_.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},className:"absolute inset-0 flex items-center justify-center z-20 bg-white",children:e.jsx("div",{className:`w-24 h-24 rounded-full flex items-center justify-center ${t?"bg-red-100":"bg-emerald-100"}`,children:e.jsx("div",{className:`w-16 h-16 rounded-full flex items-center justify-center shadow-lg ${t?"bg-red-500 shadow-red-300":"bg-emerald-500 shadow-emerald-300"}`,children:t?e.jsx(J,{className:"w-8 h-8 text-white stroke-3"}):e.jsx(ce,{className:"w-8 h-8 text-white stroke-3"})})})})}),e.jsxs("div",{className:"flex items-center justify-between w-full px-4 relative",children:[e.jsxs("div",{className:"flex flex-col items-center z-10",children:[e.jsxs("div",{className:"w-12 h-16 bg-slate-100 border-2 border-slate-300 rounded-lg relative overflow-hidden",children:[e.jsx(_.div,{initial:{height:"80%"},animate:{height:t?"0%":"20%"},transition:{duration:1.5,ease:"easeInOut"},className:"absolute bottom-0 w-full bg-amber-500 opacity-80"}),t&&e.jsx(_.div,{initial:{opacity:0,scale:.5},animate:{opacity:o==="transferring"?0:1,scale:o==="transferring"?.5:1},transition:{duration:.3,delay:.2},className:"absolute inset-0 flex items-center justify-center bg-red-50/30 backdrop-blur-[1px]",children:e.jsx(J,{className:"w-10 h-10 text-red-600 stroke-[3px]"})})]}),e.jsx("span",{className:"text-xs font-bold text-slate-400 mt-2",children:"Ø§Ù„Ù…ØµØ¯Ø±"})]}),e.jsx("div",{className:"flex-1 h-2 bg-slate-100 rounded-full mx-2 relative overflow-hidden",children:e.jsx(_.div,{initial:{x:"-100%"},animate:{x:"100%"},transition:{duration:1,repeat:2,ease:"linear"},className:"absolute top-0 left-0 w-1/2 h-full bg-blue-400 blur-sm"})}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:e.jsx("div",{className:"p-2 bg-white rounded-full shadow-lg border border-slate-100",children:e.jsx(de,{className:"w-5 h-5 text-blue-500"})})}),e.jsxs("div",{className:"flex flex-col items-center z-10",children:[e.jsx("div",{className:"w-12 h-16 bg-slate-100 border-2 border-slate-300 rounded-lg relative overflow-hidden",children:e.jsx(_.div,{initial:{height:"20%"},animate:{height:"80%"},transition:{duration:1.5,ease:"easeInOut"},className:"absolute bottom-0 w-full bg-blue-500 opacity-80"})}),e.jsx("span",{className:"text-xs font-bold text-slate-400 mt-2",children:"Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„"})]})]})]}),e.jsxs("div",{className:"text-center z-20",children:[e.jsx(_.h3,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},className:`text-2xl font-black font-cairo ${o==="success"&&t?"text-red-600":"text-slate-800"}`,children:o==="transferring"?"Ø¬Ø§Ø±ÙŠ Ù†Ù‚Ù„ Ø§Ù„ÙˆÙ‚ÙˆØ¯...":t?"ØªÙ… Ø§Ù„Ù†Ù‚Ù„ ÙˆØ§Ù„Ø­Ø°Ù!":"ØªÙ… Ø§Ù„Ù†Ù‚Ù„ Ø¨Ù†Ø¬Ø§Ø­!"},o),e.jsx("p",{className:"text-slate-500 font-medium mt-2",children:o==="transferring"?"ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹":t?"ØªÙ… ØªÙØ±ÙŠØº ÙˆØ­Ø°Ù Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ù…ØµØ¯Ø±":"ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…ÙŠØ§Øª ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…"})]}),e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1.5 bg-slate-50",children:e.jsx(_.div,{initial:{width:0},animate:{width:"100%"},transition:{duration:4,ease:"linear"},className:`h-full ${o==="success"?t?"bg-red-500":"bg-emerald-500":"bg-blue-500"}`})})]})})})};function Ce({isOpen:n,onClose:g,tank:h,tanks:o,onConfirm:i}){const t=!!h,[f,N]=r.useState(h?h.id:""),[a,j]=r.useState([{tankId:"",amount:""}]),[b,v]=r.useState(""),[c,y]=r.useState(!1),[S,d]=r.useState(!1);r.useEffect(()=>{n&&h?(N(h.id),j([{tankId:"",amount:""}])):n&&!h&&(N(""),j([{tankId:"",amount:""}])),v(""),d(!1)},[n,h]);const u=o.find(l=>l.id==f),T=o.filter(l=>u&&l.id!=u.id&&l.fuel_type_id==u.fuel_type_id),F=a.reduce((l,x)=>l+(Number(x.amount)||0),0),$=u?Number(u.current_volume):0,E=Math.max(0,$-F),P=()=>{j([...a,{tankId:"",amount:""}])},O=l=>{const x=[...a];x.splice(l,1),j(x)},L=(l,x,w)=>{const D=[...a];D[l][x]=w,j(D),v("")},z=async()=>{if(!f){v("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ù…ØµØ¯Ø±");return}if(t&&Math.abs(E)>.1){v(`ÙŠØ¬Ø¨ ØªÙˆØ²ÙŠØ¹ ÙƒØ§Ù…Ù„ Ø§Ù„ÙƒÙ…ÙŠØ© Ù„Ø­Ø°Ù Ø§Ù„Ø®Ø²Ø§Ù†! Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${E.toLocaleString()} Ù„ØªØ±`);return}if(a.some(l=>!l.tankId||!l.amount||Number(l.amount)<=0)){v("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­");return}y(!0);try{const l=a.map(x=>({tank_id:x.tankId,amount:x.amount}));if(t)await i(f,l),d(!0);else{const x=window.BASE_URL||"/PETRODIESEL2/public",D=await(await fetch(`${x}/tanks/transfer`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({id:f,transfers:l})})).text();let I;try{I=JSON.parse(D)}catch{throw console.error("Invalid JSON:",D),new Error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù… (Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©)")}I.success?d(!0):v(I.message)}}catch(l){console.error(l),v(l.message||"ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…")}finally{y(!1)}};return n?S?e.jsx(_e,{isVisible:!0,mode:t?"delete":"transfer",onComplete:()=>{g(),window.location.reload()}}):e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs(ee,{className:"max-w-2xl w-full bg-white rounded-2xl shadow-2xl p-6 ring-1 ring-slate-200",children:[e.jsxs("div",{className:"flex flex-col items-center text-center mb-6",children:[e.jsx("div",{className:`p-3 rounded-full mb-4 ${t?"bg-amber-100 text-amber-600":"bg-blue-100 text-blue-600"}`,children:t?e.jsx(W,{className:"w-8 h-8"}):e.jsx("div",{className:"text-2xl font-bold",children:"â‡„"})}),e.jsx(ge,{className:"text-xl font-bold text-slate-900",children:t?"ØªÙØ±ÙŠØº Ø§Ù„Ø®Ø²Ø§Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø­Ø°Ù":"Ù†Ù‚Ù„ ÙˆÙ‚ÙˆØ¯ Ø¨ÙŠÙ† Ø§Ù„Ø®Ø²Ø§Ù†Ø§Øª"}),t&&e.jsxs(je,{className:"text-amber-600 font-medium",children:["Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù†Ù‚Ù„Ù‡Ø§: ",e.jsx("span",{className:"font-bold font-mono text-lg",children:$.toLocaleString()})," Ù„ØªØ±"]})]}),e.jsxs("div",{className:"space-y-4",children:[!t&&e.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200",children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ù…ØµØ¯Ø± (Ù…Ù†)"}),e.jsxs("select",{className:"w-full p-2 rounded-lg border-slate-300 focus:ring-2 focus:ring-blue-500",value:f,onChange:l=>N(l.target.value),children:[e.jsx("option",{value:"",children:"Ø§Ø®ØªØ± Ø§Ù„Ø®Ø²Ø§Ù†..."}),o.filter(l=>l.current_volume>0).map(l=>e.jsxs("option",{value:l.id,children:[l.name," (Ù…ØªØ§Ø­: ",Number(l.current_volume).toLocaleString()," Ù„ØªØ±) - ",l.product]},l.id))]})]}),b&&e.jsxs("div",{className:"p-3 bg-red-50 text-red-700 text-sm rounded-lg border border-red-100 flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),b]}),e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-3 pr-1",children:a.map((l,x)=>e.jsxs("div",{className:"flex flex-row items-end gap-3 p-3 bg-slate-50 rounded-xl border border-slate-100 relative",children:[e.jsxs("div",{className:"flex-[2] w-full",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1.5 block",children:"Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ (Ø¥Ù„Ù‰)"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{className:"w-full text-right p-2.5 pl-8 h-11 text-sm rounded-lg border-slate-200 bg-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 appearance-none",value:l.tankId,onChange:w=>L(x,"tankId",w.target.value),disabled:!f,children:[e.jsx("option",{value:"",children:"Ø§Ø®ØªØ± Ø®Ø²Ø§Ù† ÙˆØ¬Ù‡Ø©..."}),T.map(w=>e.jsxs("option",{value:w.id,children:[w.name," (Ù…ØªØ§Ø­: ",(w.capacity_liters-w.current_volume).toLocaleString()," L)"]},w.id))]}),e.jsx("div",{className:"absolute left-3 top-3.5 pointer-events-none text-slate-400",children:"â–¼"})]})]}),e.jsxs("div",{className:"flex-1 w-full relative",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1.5 block",children:"Ø§Ù„ÙƒÙ…ÙŠØ© (Ù„ØªØ±)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 h-11 text-sm font-mono font-bold text-center rounded-lg border-slate-200 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:l.amount,onChange:w=>L(x,"amount",w.target.value),placeholder:"0",min:"0",max:$})]}),a.length>1&&e.jsx("button",{onClick:()=>O(x),className:"h-10 w-10 flex items-center justify-center text-red-500 hover:bg-red-50 rounded-lg transition-colors border border-transparent hover:border-red-100",title:"Ø¥Ø²Ø§Ù„Ø©",children:e.jsx(V,{className:"w-5 h-5"})})]},x))}),e.jsxs("div",{className:"flex justify-between items-center text-sm pt-2 border-t mt-2",children:[e.jsxs("button",{onClick:P,className:"flex items-center gap-1.5 text-blue-600 font-bold hover:bg-blue-50 px-3 py-1.5 rounded-lg transition-colors",children:[e.jsx(Z,{className:"w-4 h-4"})," Ø¥Ø¶Ø§ÙØ© ÙˆØ¬Ù‡Ø© Ø£Ø®Ø±Ù‰"]}),e.jsxs("div",{className:"text-slate-600 bg-slate-100 px-3 py-1.5 rounded-lg",children:["Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­Ø¯Ø¯: ",e.jsx("span",{className:"font-bold text-slate-900 mx-1",children:F.toLocaleString()})," / ",$.toLocaleString()]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-4 pt-4 border-t border-slate-100",children:[e.jsx(R,{size:"md",variant:"secondary",className:"flex-1 border-slate-200 text-slate-600 hover:bg-slate-50",onClick:g,children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(R,{size:"md",variant:"primary",className:`flex-[2] text-white border-none shadow-md ${t?"bg-amber-500 hover:bg-amber-600 shadow-amber-100":"bg-blue-600 hover:bg-blue-700 shadow-blue-100"}`,onClick:z,loading:c,children:t?"ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù†Ù‚Ù„ ÙˆØ§Ù„Ø­Ø°Ù":"ØªÙ†ÙÙŠØ° Ø§Ù„Ù†Ù‚Ù„"})]})]})}):null}function Fe({tanks:n=[],suppliers:g=[],fuelSettings:h=[],generalSettings:o={},fuelTypes:i=[]}){const[t,f]=r.useState(""),[N,a]=r.useState("grid"),[j,b]=r.useState(!1),[v,c]=r.useState(!1),[y,S]=r.useState(!1),[d,u]=r.useState(null),[T,F]=r.useState(null),[$,E]=r.useState(!1),[P,O]=r.useState(!1),[L,z]=r.useState(null),[l,x]=r.useState(!1),[w,D]=r.useState(!1),[I,k]=r.useState(""),B=()=>{c(!1),F(null),window.location.reload()},G=s=>{F(s),c(!0)},Q=async s=>{z(s),s.current>1?O(!0):E(!0)},te=async()=>{if(!L)return;x(!0);const s=window.BASE_URL||"/PETRODIESEL2/public";try{const m=await(await fetch(`${s}/tanks/delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:L.id})})).json();m.success?(E(!1),k("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø®Ø²Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­"),D(!0)):m.requires_transfer?(E(!1),O(!0),C.warning(m.message)):C.error(m.message)}catch(p){console.error(p),C.error("ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø®Ø²Ø§Ù†")}finally{x(!1)}},le=async(s,p)=>{const m=window.BASE_URL||"/PETRODIESEL2/public";try{const M=await(await fetch(`${m}/tanks/transfer_and_delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:s,transfers:p})})).json();M.success?(O(!1),k(M.message),D(!0)):C.error(M.message)}catch(A){console.error(A),C.error("ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©")}},H=(n||[]).map(s=>{const p=Number(s.capacity_liters||0),m=Number(s.current_volume||0),A=p>0?m/p*100:0;return{id:s.id,name:s.name,product:s.product_type||"Fuel",fuel_type_id:s.fuel_type_id,total_cap:p,current:m,current_volume:m,capacity_liters:p,current_price:s.current_price,percentage:Math.min(100,Math.max(0,Number(A.toFixed(1)))),status:A<20?"Low Stock":"Active"}}),q=H.filter(s=>s.name.toLowerCase().includes(t.toLowerCase())||s.product.toLowerCase().includes(t.toLowerCase())),ae=s=>{const p=o.volume_display_mode||"liters",m=s/4.5;return p==="gallons"?e.jsx("div",{className:"flex flex-col items-end",children:e.jsxs("span",{children:[m.toLocaleString(void 0,{maximumFractionDigits:1})," ",e.jsx("span",{className:"text-xs text-slate-400",children:"Gal"})]})}):p==="both"?e.jsxs("div",{className:"flex flex-col items-end text-right",children:[e.jsxs("span",{className:"text-sm text-emerald-600 font-bold",children:[m.toLocaleString(void 0,{maximumFractionDigits:1})," ",e.jsx("span",{className:"text-[10px]",children:"Gal"})]}),e.jsxs("span",{className:"text-[10px] text-slate-400",children:[s.toLocaleString()," L"]})]}):e.jsxs("span",{children:[s.toLocaleString()," ",e.jsx("span",{className:"text-xs text-slate-400",children:"L"})]})},re=({tank:s})=>{let p="bg-blue-500";s.product.includes("Diesel")&&(p="bg-amber-500"),s.product.includes("91")&&(p="bg-emerald-500"),s.product.includes("95")&&(p="bg-rose-500");const m=o.volume_display_mode||"liters";return e.jsxs(_.div,{layout:!0,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white rounded-2xl shadow-sm border border-slate-100 p-6 relative overflow-hidden group hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx(Y,{size:"xs",color:s.status==="Low Stock"?"red":"slate",children:s.product}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>{u(s),S(!0)},className:"p-1.5 text-slate-400 hover:text-purple-600 hover:bg-purple-50 rounded-lg",title:"Ù…Ø¹Ø§ÙŠØ±Ø© Ø§Ù„Ø®Ø²Ø§Ù†",children:e.jsx(X,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>G(s),className:"p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg",children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Q(s),className:"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(V,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex flex-col items-center mb-6",children:[e.jsxs("div",{className:"relative w-24 h-36 bg-slate-100 rounded-xl border-4 border-slate-200 overflow-hidden mb-4 shadow-inner",children:[e.jsx(_.div,{className:`absolute bottom-0 left-0 w-full ${p} opacity-80`,initial:{height:0},animate:{height:`${s.percentage}%`},transition:{duration:1.5,ease:"easeOut"},children:e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-white/30"})}),e.jsx("div",{className:"absolute right-0 top-0 h-full w-full flex flex-col justify-between py-2 px-1 items-end pointer-events-none opacity-30",children:[...Array(5)].map((A,M)=>e.jsx("div",{className:"w-2 h-[1px] bg-slate-900"},M))})]}),e.jsx("h3",{className:"font-bold text-lg text-slate-800 text-center",children:s.name}),e.jsxs("div",{className:"text-2xl font-black text-slate-900 font-mono mt-1 flex flex-col items-center",dir:"ltr",children:[m==="gallons"&&e.jsxs("span",{children:[(s.current/4.5).toLocaleString(void 0,{maximumFractionDigits:1})," ",e.jsx("span",{className:"text-xs text-slate-400 font-sans font-medium",children:"Gal"})]}),m==="liters"&&e.jsxs("span",{children:[s.current.toLocaleString()," ",e.jsx("span",{className:"text-xs text-slate-400 font-sans font-medium",children:"L"})]}),m==="both"&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-emerald-600 text-xl",children:[(s.current/4.5).toLocaleString(void 0,{maximumFractionDigits:1})," ",e.jsx("span",{className:"text-[10px] text-emerald-400 font-sans font-medium",children:"Gal"})]}),e.jsxs("span",{className:"text-sm text-slate-400",children:[s.current.toLocaleString()," L"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs border-t pt-4",children:[e.jsxs("div",{className:"text-center p-2 bg-slate-50 rounded-lg",children:[e.jsx("span",{className:"block text-slate-400 mb-1",children:"Ø§Ù„Ø³Ø¹Ø© Ø§Ù„ÙƒÙ„ÙŠØ©"}),e.jsx("span",{className:"font-mono font-bold text-slate-700",children:m==="gallons"?(s.total_cap/4.5).toLocaleString(void 0,{maximumFractionDigits:0}):s.total_cap.toLocaleString()})]}),e.jsxs("div",{className:"text-center p-2 bg-slate-50 rounded-lg",children:[e.jsx("span",{className:"block text-slate-400 mb-1",children:"Ø§Ù„Ù†Ø³Ø¨Ø©"}),e.jsxs("span",{className:`font-mono font-bold ${s.percentage<20?"text-red-600":"text-emerald-600"}`,children:[s.percentage,"%"]})]})]})]})};return e.jsxs(_.div,{initial:{opacity:0},animate:{opacity:1},className:"p-6 max-w-[1800px] mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col xl:flex-row justify-between items-center gap-4 bg-white p-4 rounded-2xl shadow-sm border border-slate-100",children:[e.jsxs("div",{className:"flex w-full xl:w-auto gap-4",children:[e.jsxs("div",{className:"relative flex-1 xl:w-96",children:[e.jsx(ue,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx(Ne,{placeholder:"Ø¨Ø­Ø« Ø¹Ù† Ø®Ø²Ø§Ù† Ø£Ùˆ Ù…Ù†ØªØ¬...",className:"pl-4 pr-10 py-2 rounded-xl border-slate-200",value:t,onChange:s=>f(s.target.value)})]}),e.jsxs("div",{className:"flex gap-1 bg-slate-100 p-1 rounded-xl shrink-0",children:[e.jsx("button",{onClick:()=>a("grid"),className:`p-2 rounded-lg transition-all ${N==="grid"?"bg-white shadow text-blue-600":"text-slate-500 hover:text-slate-700"}`,title:"Ø´Ø¨ÙƒØ©",children:e.jsx(xe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>a("list"),className:`p-2 rounded-lg transition-all ${N==="list"?"bg-white shadow text-blue-600":"text-slate-500 hover:text-slate-700"}`,title:"Ù‚Ø§Ø¦Ù…Ø©",children:e.jsx(me,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex gap-2 w-full xl:w-auto justify-end overflow-x-auto pb-1 xl:pb-0",children:[e.jsx(R,{variant:"secondary",className:"rounded-xl font-bold border-slate-200 hover:border-emerald-500 hover:text-emerald-600 whitespace-nowrap",onClick:()=>{z(null),O(!0)},children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"â‡„"})," Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª"]})}),e.jsx(R,{variant:"secondary",icon:Z,className:"rounded-xl font-bold bg-emerald-500 hover:bg-emerald-600 text-white border-none shadow-lg shadow-emerald-100 whitespace-nowrap",onClick:()=>{F(null),c(!0)},children:"Ø¥Ø¶Ø§ÙØ© Ø®Ø²Ø§Ù†"}),e.jsx("button",{className:"custom-btn btn",onClick:()=>b(!0),children:e.jsx("span",{children:"ØªÙØ±ÙŠØº Ø´Ø­Ù†Ø©"})}),e.jsx(R,{variant:"secondary",icon:he,className:"rounded-xl font-bold border-slate-200 whitespace-nowrap",children:"ØªÙ‚Ø±ÙŠØ±"})]})]}),N==="grid"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[q.map(s=>e.jsx(re,{tank:s},s.id)),q.length===0&&e.jsx("div",{className:"col-span-full text-center py-20 text-slate-400",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø²Ø§Ù†Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«"})]}),N==="list"&&e.jsx(ee,{className:"rounded-2xl shadow-lg ring-1 ring-slate-200 overflow-hidden p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-right",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 text-sm font-bold text-slate-600",children:"Ø§Ø³Ù… Ø§Ù„Ø®Ø²Ø§Ù†"}),e.jsx("th",{className:"p-4 text-sm font-bold text-slate-600",children:"Ø§Ù„Ù…Ù†ØªØ¬"}),e.jsx("th",{className:"p-4 text-sm font-bold text-slate-600 w-1/3",children:"Ø§Ù„Ù…Ø³ØªÙˆÙ‰"}),e.jsx("th",{className:"p-4 text-sm font-bold text-slate-600",children:"Ø§Ù„Ø³Ø¹Ø©"}),e.jsx("th",{className:"p-4 text-sm font-bold text-slate-600",children:"Ø§Ù„Ø­Ø§Ù„ÙŠ"}),e.jsx("th",{className:"p-4 text-sm font-bold text-slate-600 text-center",children:"Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:q.map(s=>e.jsxs("tr",{className:"hover:bg-blue-50/30 transition-colors group",children:[e.jsxs("td",{className:"p-4 font-bold text-navy-900 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-slate-100 rounded-lg",children:e.jsx(be,{className:"w-5 h-5 text-blue-500"})}),s.name]}),e.jsx("td",{className:"p-4",children:e.jsx(Y,{size:"xs",color:"slate",children:s.product})}),e.jsxs("td",{className:"p-4 flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-bold w-10",children:[s.percentage,"%"]}),e.jsx("div",{className:"w-full bg-slate-100 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${s.percentage}%`}})})]}),e.jsx("td",{className:"p-4 font-mono",children:o.volume_display_mode==="gallons"?(s.total_cap/4.5).toLocaleString(void 0,{maximumFractionDigits:0}):s.total_cap.toLocaleString()}),e.jsx("td",{className:"p-4 font-mono font-bold",children:ae(s.current)}),e.jsx("td",{className:"p-4 text-center",children:e.jsxs("div",{className:"flex justify-center gap-2 md:opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>{u(s),S(!0)},className:"p-2 text-purple-600 hover:bg-purple-50 rounded-lg",title:"Ù…Ø¹Ø§ÙŠØ±Ø©",children:e.jsx(X,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>G(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg",children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Q(s),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(V,{className:"w-4 h-4"})})]})})]},s.id))})]})})}),e.jsx(se,{isVisible:w,message:I,onComplete:()=>window.location.reload()}),e.jsx(ve,{isOpen:$,onClose:()=>E(!1),onConfirm:te,title:"Ø­Ø°Ù Ø§Ù„Ø®Ø²Ø§Ù†",message:`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø®Ø²Ø§Ù† "${L==null?void 0:L.name}"ØŸ`,isDeleting:l}),e.jsx(Ce,{isOpen:P,onClose:()=>O(!1),tank:L,tanks:H,onConfirm:le}),e.jsx(we,{isOpen:j,onClose:()=>b(!1),tanks:n,suppliers:g}),e.jsx(ye,{isOpen:v,onClose:()=>c(!1),onSuccess:B,fuelSettings:h,fuelTypes:i,tank:T}),e.jsx(Se,{isOpen:y,onClose:()=>S(!1),tank:d,onSuccess:B})]})}export{Fe as default};
