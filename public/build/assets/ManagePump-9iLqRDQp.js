import{j as e,m as n,Y as O,S as r,_ as h,o as v,F as w,R as f,c as y,$ as k,i as L,f as d,s as q,t as o}from"./ui-Cx9d0ciQ.js";import{r as c}from"./vendor-BdFMDtQB.js";import{g as A,d as M,c as F}from"./main-CZ5QbTZK.js";function H({pump:i,counters:C,workers:j,tanks:E,user:X}){const[m,x]=c.useState(null),[g,u]=c.useState(null),[P,p]=c.useState(!1),[S,b]=c.useState(!1),D=(t,a)=>{const s=t.match(/\d+/);return s?s[0]:a+1},_=async(t,a)=>{t.preventDefault();const s=new FormData(t.target);try{const l=await fetch("/PETRODIESEL2/public/pumps/updateCounter",{method:"POST",body:s,headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}),N=await l.json().catch(()=>({}));N.success||l.redirected?(o.success("تم حفظ التغييرات بنجاح"),window.location.reload()):o.error(N.message||"حدث خطأ أثناء الحفظ")}catch(l){console.error(l),o.error("فشل الاتصال بالخادم")}},R=t=>{const a=document.createElement("form");a.method="POST",a.action="/PETRODIESEL2/public/pumps/deleteCounter";const s=document.createElement("input");s.type="hidden",s.name="id",s.value=t;const l=document.createElement("input");l.type="hidden",l.name="pump_id",l.value=i.id,a.appendChild(s),a.appendChild(l),document.body.appendChild(a),a.submit()},I=t=>{t.preventDefault(),t.target.submit()},T=async t=>{t.preventDefault();const a=new FormData(t.target);try{const s=await fetch("/PETRODIESEL2/public/pumps/updatePump",{method:"POST",body:a,headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}),l=await s.json().catch(()=>({}));l.success||s.redirected?(o.success("تم تحديث بيانات الماكينة بنجاح"),window.location.reload()):o.error(l.message||"حدث خطأ أثناء التحديث")}catch(s){console.error(s),o.error("فشل الاتصال بالخادم")}};return e.jsxs(n.div,{initial:{opacity:0},animate:{opacity:1},className:"p-6 max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 border-b border-slate-200 pb-6",children:[e.jsxs("div",{children:[e.jsxs("a",{href:"/PETRODIESEL2/public/pumps",className:"text-slate-500 hover:text-blue-600 mb-2 flex items-center gap-1 text-sm font-bold transition-colors",children:[e.jsx(O,{className:"w-4 h-4 ml-1"})," العودة للمكائن"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h1",{className:"text-3xl font-black text-slate-800 flex items-center gap-3",children:[e.jsx(r,{className:"w-8 h-8 text-blue-600"}),"تعديل الماكينة: ",e.jsx("span",{className:"text-blue-600",children:i.name})]}),e.jsx("button",{onClick:()=>p(!0),className:"p-1.5 rounded-full bg-slate-100 hover:bg-blue-100 text-slate-400 hover:text-blue-600 transition-colors",children:e.jsx(h,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-bold transition-all shadow-md hover:shadow-lg",children:[e.jsx(v,{className:"w-4 h-4 hidden"})," ",e.jsx(r,{className:"w-4 h-4"})," إضافة عداد جديد"]}),e.jsx(A,{size:"lg",color:"slate",icon:w,children:i.tank_name})]})]}),e.jsx(M,{numItems:1,numItemsMd:2,className:"gap-6",children:C.map((t,a)=>e.jsx(n.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:a*.1},children:e.jsxs(F,{className:"h-full border-t-4 border-t-amber-500 relative overflow-hidden group hover:shadow-lg transition-shadow bg-white",children:[e.jsx("div",{className:"absolute top-0 left-0 p-4 opacity-5 pointer-events-none",children:e.jsx(f,{className:"w-32 h-32"})}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b border-slate-100 pb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-50 text-amber-600 rounded-lg shadow-sm",children:e.jsx(f,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800",children:t.name||`العداد ${D(t.name,a)}`}),e.jsxs("span",{className:"text-xs text-slate-400 font-mono",children:["ID: #",t.id]})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>x(t),className:"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"تعديل الاسم",children:e.jsx(h,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>u(t),className:"p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"حذف العداد",children:e.jsx(v,{className:"w-4 h-4"})})]})]}),e.jsxs("form",{onSubmit:s=>_(s,t.id),className:"space-y-5",children:[e.jsx("input",{type:"hidden",name:"pump_id",value:i.id}),e.jsx("input",{type:"hidden",name:"counter_id",value:t.id}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"العامل المسؤول"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{name:"worker_id",defaultValue:t.current_worker_id||"",className:"w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none appearance-none font-bold text-slate-700",children:[e.jsx("option",{value:"",children:"-- غير محدد --"}),j.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(y,{className:"absolute left-3 top-3.5 w-5 h-5 text-slate-400 pointer-events-none"})]}),e.jsxs("p",{className:"text-[10px] text-emerald-600 mt-1.5 flex items-center gap-1 font-medium",children:[e.jsx(k,{className:"w-3 h-3"}),"سيتم ربط المبيعات بهذا العامل"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"قراءة العداد الحالية"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",name:"current_reading",defaultValue:t.current_reading,className:"w-full p-3 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-amber-500/20 focus:border-amber-500 outline-none font-mono text-lg font-bold text-slate-800 pl-16 text-right"}),e.jsx("div",{className:"absolute left-0 top-0 bottom-0 px-3 bg-slate-100 border-r border-slate-200 rounded-l-xl flex items-center text-slate-500 font-mono text-sm font-bold",children:"Liters"})]})]}),e.jsxs("button",{type:"submit",className:"w-full py-3 bg-slate-800 hover:bg-slate-700 text-white rounded-xl shadow-lg hover:shadow-xl transition-all font-bold flex justify-center items-center gap-2 mt-2",children:[e.jsx(L,{className:"w-4 h-4"})," حفظ التغييرات"]})]})]})]})},t.id))}),e.jsx(d,{children:m&&e.jsx(n.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm",onClick:()=>x(null),children:e.jsxs(n.div,{initial:{scale:.95},animate:{scale:1},exit:{scale:.95},className:"bg-white rounded-2xl p-6 w-full max-w-md shadow-2xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(h,{className:"w-5 h-5 text-blue-500"})," تعديل اسم العداد"]}),e.jsxs("form",{action:"/PETRODIESEL2/public/pumps/updateCounterName",method:"POST",onSubmit:I,children:[e.jsx("input",{type:"hidden",name:"pump_id",value:i.id}),e.jsx("input",{type:"hidden",name:"counter_id",value:m.id}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"الاسم الجديد"}),e.jsx("input",{type:"text",name:"name",defaultValue:m.name,className:"w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",autoFocus:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>x(null),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg font-bold",children:"إلغاء"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold shadow-md",children:"حفظ"})]})]})]})})}),e.jsx(d,{children:g&&e.jsx(n.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm",onClick:()=>u(null),children:e.jsxs(n.div,{initial:{scale:.95},animate:{scale:1},exit:{scale:.95},className:"bg-white rounded-2xl p-6 w-full max-w-md shadow-2xl border-t-4 border-red-500",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 text-red-600 mb-4",children:[e.jsx("div",{className:"p-3 bg-red-50 rounded-full",children:e.jsx(q,{className:"w-6 h-6"})}),e.jsx("h3",{className:"text-xl font-bold",children:"تأكيد الحذف"})]}),e.jsxs("p",{className:"text-slate-600 mb-6 font-medium",children:["هل أنت متأكد من حذف هذا العداد؟ ",e.jsx("br",{}),e.jsx("span",{className:"text-sm text-red-500",children:"لا يمكن التراجع عن هذا الإجراء وسيتم حذف جميع البيانات المرتبطة."})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>u(null),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg font-bold",children:"إلغاء"}),e.jsx("button",{onClick:()=>R(g.id),className:"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-bold shadow-md",children:"حذف نهائي"})]})]})})}),e.jsx(d,{children:P&&e.jsx(n.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm",onClick:()=>p(!1),children:e.jsxs(n.div,{initial:{scale:.95},animate:{scale:1},exit:{scale:.95},className:"bg-white rounded-2xl p-6 w-full max-w-md shadow-2xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(r,{className:"w-5 h-5 text-blue-500"})," تعديل بيانات الماكينة"]}),e.jsxs("form",{action:"/PETRODIESEL2/public/pumps/updatePump",method:"POST",onSubmit:T,children:[e.jsx("input",{type:"hidden",name:"id",value:i.id}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"اسم الماكينة"}),e.jsx("input",{type:"text",name:"name",defaultValue:i.name,className:"w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none font-bold",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"الخزان (نوع الوقود)"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{name:"tank_id",defaultValue:i.tank_id,className:"w-full p-3 bg-slate-50 border border-slate-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none appearance-none font-bold",children:E.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.product_type,")"]},t.id))}),e.jsx(w,{className:"absolute left-3 top-3.5 w-5 h-5 text-slate-400 pointer-events-none"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>p(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg font-bold",children:"إلغاء"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold shadow-md",children:"حفظ التعديلات"})]})]})]})})}),e.jsx(d,{children:S&&e.jsx(n.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm",onClick:()=>b(!1),children:e.jsxs(n.div,{initial:{scale:.95},animate:{scale:1},exit:{scale:.95},className:"bg-white rounded-2xl p-6 w-full max-w-md shadow-2xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(r,{className:"w-5 h-5 text-emerald-500"})," إضافة عداد جديد"]}),e.jsxs("form",{onSubmit:async t=>{t.preventDefault();const a=new FormData(t.target);try{const s=await fetch("/PETRODIESEL2/public/pumps/addCounter",{method:"POST",body:a,headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}),l=await s.json().catch(()=>({}));l.success||s.ok?(o.success("تمت إضافة العداد بنجاح"),window.location.reload()):o.error(l.message||l.error||"حدث خطأ أثناء الإضافة")}catch(s){console.error(s),o.error("فشل الاتصال بالخادم")}},children:[e.jsx("input",{type:"hidden",name:"pump_id",value:i.id}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"اسم العداد"}),e.jsx("input",{type:"text",name:"name",className:"w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none font-bold placeholder:text-slate-300",placeholder:"مثال: مسدس 1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"القراءة الأولية"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",name:"initial_reading",className:"w-full p-3 pl-12 border border-slate-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none font-mono font-bold",placeholder:"0.00",required:!0}),e.jsx(f,{className:"absolute left-3 top-3.5 w-5 h-5 text-slate-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"العامل المسؤول"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{name:"worker_id",className:"w-full p-3 bg-slate-50 border border-slate-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none appearance-none font-bold text-slate-700 cursor-pointer",children:[e.jsx("option",{value:"",children:"-- اختر عامل --"}),j.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx(y,{className:"absolute left-3 top-3.5 w-5 h-5 text-slate-400 pointer-events-none"})]}),e.jsxs("p",{className:"text-[10px] text-emerald-600 mt-1.5 flex items-center gap-1 font-medium",children:[e.jsx(k,{className:"w-3 h-3"}),"تعيين مباشر للعامل عند الإنشاء"]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg font-bold",children:"إلغاء"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-bold shadow-md",children:"إضافة العداد"})]})]})]})})})]})}export{H as default};
