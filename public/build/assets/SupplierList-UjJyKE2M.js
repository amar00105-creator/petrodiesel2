import{r as o,j as e,t as u,b as v,R as q,T as B}from"./main-BZye3MWh.js";import{n as O,d as C,g as E,h as G}from"./Tracker-B3Wsk5ua.js";import{A as $}from"./AddSupplierModal-DDwA4hHl.js";import{B as w}from"./building-2-B4W4HkxD.js";import{X as D}from"./x-CpP_tiue.js";import{P as y}from"./phone-s6QPuMec.js";import{S as A}from"./save-C_qR2yBp.js";import{D as X}from"./DeleteConfirmationModal-CGMvXUfk.js";import{M}from"./map-pin-B-WJpv1d.js";import{F as H}from"./file-text-DwdbBnTO.js";import{G as J}from"./GlobalTable-CiHnQ48r.js";import{S as K}from"./square-pen-DTQcLPwn.js";import{T as Q}from"./trash-2-D_DkLkqJ.js";import{P as V}from"./plus-CeiUBWS7.js";function W({isOpen:m,onClose:c,supplier:i,onSuccess:a}){const[n,f]=o.useState({id:"",name:"",phone:""}),[p,x]=o.useState(!1);o.useEffect(()=>{i&&f({id:i.id||"",name:i.name||"",phone:i.phone||""})},[i]);const h=r=>{const{name:d,value:l}=r.target;f(t=>({...t,[d]:l}))},b=async r=>{r.preventDefault(),x(!0);const d=new FormData;d.append("id",n.id),d.append("name",n.name),d.append("phone",n.phone);let l=!1;try{const j=await(await fetch("/PETRODIESEL2/public/suppliers/update_ajax",{method:"POST",headers:{Accept:"application/json"},body:d})).json();j.success?(u.success("تم تحديث المورد بنجاح"),l=!0):u.error(j.message||"حدث خطأ أثناء التحديث")}catch(t){console.error("Update Request Error:",t),u.error("فشل الاتصال بالخادم")}finally{x(!1)}if(l)try{a({...i,name:n.name,phone:n.phone}),c()}catch(t){console.error("Error updating UI state:",t)}};return e.jsx(O,{open:m,onClose:c,static:!0,className:"z-[100]",children:e.jsxs(C,{className:"max-w-md w-full bg-white rounded-2xl shadow-2xl ring-1 ring-slate-900/5 p-0 overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-50 border-b border-slate-100 p-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5 text-navy-900"}),"تعديل بيانات المورد"]}),e.jsx("p",{className:"text-slate-500 text-sm",children:"تعديل الاسم أو الهاتف"})]}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-slate-200 rounded-full transition-colors text-slate-500",children:e.jsx(D,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:b,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"اسم المورد"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("input",{type:"text",name:"name",value:n.name,onChange:h,placeholder:"اسم المورد",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-navy-500 transition-all",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"رقم الهاتف"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("input",{type:"text",name:"phone",value:n.phone,onChange:h,placeholder:"05xxxxxxxx",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-navy-500 transition-all"})]})]}),e.jsxs("div",{className:"flex justify-end pt-4",children:[e.jsx("button",{type:"button",onClick:c,className:"px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-50 rounded-lg transition-colors ml-2",children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:p,className:"px-6 py-2 text-sm font-bold text-white bg-navy-900 hover:bg-navy-800 rounded-lg shadow-lg hover:shadow-xl transition-all flex items-center gap-2",children:p?"جاري الحفظ...":e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4"}),"حفظ التغييرات"]})})]})]})]})})}function Y({isOpen:m,onClose:c,onSuccess:i}){const[a,n]=o.useState({name:"",phone:"",address:"",notes:""}),[f,p]=o.useState(!1),x=b=>{const{name:r,value:d}=b.target;n(l=>({...l,[r]:d}))},h=async b=>{b.preventDefault(),p(!0);const r=new FormData;r.append("name",a.name),r.append("phone",a.phone),r.append("address",a.address),r.append("notes",a.notes);try{const l=await(await fetch("/PETRODIESEL2/public/hr/api?entity=customer&action=store",{method:"POST",body:r})).json();if(l.success){u.custom(j=>e.jsxs("div",{className:"flex items-center gap-4 bg-emerald-50 border border-emerald-100 p-4 rounded-2xl shadow-xl w-full",children:[e.jsx("div",{className:"p-2 bg-emerald-500 rounded-full text-white animate-pulse",children:e.jsx(v,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-emerald-900 font-bold",children:"تم حفظ العميل الجديد!"}),e.jsxs("p",{className:"text-emerald-700 text-sm",children:["تم إضافة ",a.name," إلى القائمة بنجاح"]})]})]}),{duration:4e3});const t={id:l.id,...a};i(t),c(),n({name:"",phone:"",address:"",notes:""})}else u.error(l.message||"حدث خطأ أثناء الإضافة")}catch{u.error("فشل الاتصال بالخادم")}finally{p(!1)}};return e.jsx(O,{open:m,onClose:c,static:!0,className:"z-[100]",children:e.jsxs(C,{className:"max-w-md w-full bg-white rounded-2xl shadow-2xl ring-1 ring-slate-900/5 p-0 overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-50 border-b border-slate-100 p-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5 text-indigo-600"}),"إضافة عميل جديد"]}),e.jsx("p",{className:"text-slate-500 text-sm",children:"أدخل بيانات العميل"})]}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-slate-200 rounded-full transition-colors text-slate-500",children:e.jsx(D,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:h,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"اسم العميل"}),e.jsxs("div",{className:"relative",children:[e.jsx(v,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("input",{type:"text",name:"name",value:a.name,onChange:x,placeholder:"الاسم الكامل",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"رقم الهاتف"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("input",{type:"text",name:"phone",value:a.phone,onChange:x,placeholder:"05xxxxxxxx",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"العنوان"}),e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("input",{type:"text",name:"address",value:a.address,onChange:x,placeholder:"المدينة، الحي...",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"ملاحظات"}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute right-3 top-3 text-slate-400 w-5 h-5"}),e.jsx("textarea",{name:"notes",value:a.notes,onChange:x,placeholder:"ملاحظات إضافية...",className:"w-full pr-10 pl-4 py-2 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all min-h-[80px]"})]})]}),e.jsxs("div",{className:"flex justify-end pt-4",children:[e.jsx("button",{type:"button",onClick:c,className:"px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-50 rounded-lg transition-colors ml-2",children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:f,className:"px-6 py-2 text-sm font-bold text-white bg-navy-900 hover:bg-navy-800 rounded-lg shadow-lg hover:shadow-xl transition-all flex items-center gap-2",children:f?"جاري الحفظ...":e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4"}),"حفظ"]})})]})]})]})})}function Z({suppliers:m=[]}){const[c,i]=o.useState(Array.isArray(m)?m:[]);q.useEffect(()=>{i(Array.isArray(m)?m:[])},[m]);const[a,n]=o.useState(!1),[f,p]=o.useState(!1),[x,h]=o.useState(!1),[b,r]=o.useState(null),[d,l]=o.useState(!1),[t,j]=o.useState(null),[P,S]=o.useState(!1),T=s=>{r(s),h(!0)},I=s=>{i(N=>N.map(g=>g.id==s.id?{...g,...s}:g)),h(!1)},F=s=>{j(s),l(!0)},k=async()=>{if(!t)return;S(!0);const s=new FormData;s.append("id",t.id);try{const g=await(await fetch("/PETRODIESEL2/public/suppliers/delete_ajax",{method:"POST",body:s})).json();g.success?(u.success("تم حذف المورد بنجاح"),i(z=>z.filter(U=>U.id!==t.id))):u.error(g.message||"فشل الحذف")}catch{u.error("خطأ في الاتصال")}finally{S(!1),l(!1),j(null)}},L=[{header:"اسم المنشأة / المورد",accessor:"name",render:s=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-slate-100 rounded-lg text-slate-500",children:e.jsx(w,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-bold text-navy-900",children:s.name})]})},{header:"رقم الهاتف",accessor:"phone",className:"font-mono text-slate-600",render:s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-3 h-3 text-slate-400"})," ",s.phone]})},{header:"العنوان",accessor:"address",className:"text-sm text-slate-500",render:s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-3 h-3 text-slate-400"})," ",s.address]})},{header:"نوع الخدمة",accessor:"type",render:s=>e.jsx(E,{size:"xs",color:"blue",icon:B,children:s.type})},{header:"الحالة",accessor:"status",render:s=>e.jsx(E,{size:"xs",color:s.status==="Active"?"emerald":"gray",children:s.status==="Active"?"نشط":"غير نشط"})}],R=s=>e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>T(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>F(s),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(Q,{className:"w-4 h-4"})})]}),_=e.jsx("div",{className:"flex items-center",children:e.jsx(G,{icon:V,onClick:()=>p(!0),className:"rounded-xl font-bold bg-indigo-600 hover:bg-indigo-700 border-none",children:"إضافة زبون"})});return e.jsxs("div",{className:"p-6 max-w-[1800px] mx-auto space-y-6",children:[e.jsx(X,{isOpen:d,onClose:()=>l(!1),onConfirm:k,title:"تحذير: حذف مورد",message:`سيتم حذف المورد "${t==null?void 0:t.name}". هل أنت متأكد؟`,isDeleting:P}),e.jsx(J,{title:"الموردين والشركات",subtitle:"قائمة شركات التوريد والخدمات اللوجستية",data:c,columns:L,actions:R,onAdd:()=>n(!0),addButtonLabel:"إضافة مورد",searchPlaceholder:"بحث عن مورد...",filters:_,exportName:"suppliers"}),e.jsx($,{isOpen:a,onClose:()=>n(!1),onSuccess:()=>window.location.reload()}),e.jsx(Y,{isOpen:f,onClose:()=>p(!1),onSuccess:()=>{}}),e.jsx(W,{isOpen:x,onClose:()=>h(!1),supplier:b,onSuccess:I})]})}const pe=Object.freeze(Object.defineProperty({__proto__:null,default:Z},Symbol.toStringTag,{value:"Module"}));export{Y as A,Z as S,pe as a};
